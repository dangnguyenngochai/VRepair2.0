void //<S2SV> init_rc ( void ) //<S2SV> { //<S2SV> int i ; //<S2SV> struct stat st ; //<S2SV> FILE * f ; //<S2SV> if ( rc_dir != NULL ) //<S2SV> goto open_rc ; //<S2SV> rc_dir = expandPath ( RC_DIR ) ; //<S2SV> i = strlen ( rc_dir ) ; //<S2SV> if ( i > 1 && rc_dir [ i - 1 ] == '/' ) //<S2SV> rc_dir [ i - 1 ] = '\\0' ; //<S2SV> # ifdef USE_M17N //<S2SV> display_charset_str = wc_get_ces_list ( ) ; //<S2SV> document_charset_str = display_charset_str ; //<S2SV> system_charset_str = display_charset_str ; //<S2SV> # endif //<S2SV> if ( stat ( rc_dir , & st ) < 0 ) { //<S2SV> if ( errno == ENOENT ) { //<S2SV> if ( do_mkdir ( rc_dir , 0700 ) < 0 ) { //<S2SV> goto rc_dir_err ; //<S2SV> } //<S2SV> else { //<S2SV> stat ( rc_dir , & st ) ; //<S2SV> } //<S2SV> } //<S2SV> else { //<S2SV> goto rc_dir_err ; //<S2SV> } //<S2SV> } //<S2SV> if ( ! S_ISDIR ( st . st_mode ) ) { //<S2SV> goto rc_dir_err ; //<S2SV> } //<S2SV> if ( ! ( st . st_mode & S_IWUSR ) ) { //<S2SV> goto rc_dir_err ; //<S2SV> } //<S2SV> no_rc_dir = FALSE ; //<S2SV> tmp_dir = rc_dir ; //<S2SV> if ( config_file == NULL ) //<S2SV> config_file = rcFile ( CONFIG_FILE ) ; //<S2SV> create_option_search_table ( ) ; //<S2SV> open_rc : //<S2SV> if ( ( f = fopen ( etcFile ( W3MCONFIG ) , "rt" ) ) != NULL ) { //<S2SV> interpret_rc ( f ) ; //<S2SV> fclose ( f ) ; //<S2SV> } //<S2SV> if ( ( f = fopen ( confFile ( CONFIG_FILE ) , "rt" ) ) != NULL ) { //<S2SV> interpret_rc ( f ) ; //<S2SV> fclose ( f ) ; //<S2SV> } //<S2SV> if ( config_file && ( f = fopen ( config_file , "rt" ) ) != NULL ) { //<S2SV> interpret_rc ( f ) ; //<S2SV> fclose ( f ) ; //<S2SV> } //<S2SV> return ; //<S2SV> rc_dir_err : //<S2SV> no_rc_dir = TRUE ; //<S2SV> if ( ( ( tmp_dir = getenv ( "TMPDIR" ) ) == NULL || * tmp_dir == '\\0' ) && //<S2SV> ( ( tmp_dir = getenv ( "TMP" ) ) == NULL || * tmp_dir == '\\0' ) && //<S2SV> ( ( tmp_dir = getenv ( "TEMP" ) ) == NULL || * tmp_dir == '\\0' ) ) //<S2SV> tmp_dir = "/tmp" ; //<S2SV> create_option_search_table ( ) ; //<S2SV> goto open_rc ; //<S2SV> } //<S2SV> 