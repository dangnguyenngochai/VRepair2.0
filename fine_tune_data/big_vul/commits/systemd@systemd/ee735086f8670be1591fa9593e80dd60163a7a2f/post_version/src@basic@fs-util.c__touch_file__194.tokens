int touch_file ( const char * path , bool parents , usec_t stamp , uid_t uid , gid_t gid , mode_t mode ) { //<S2SV> _cleanup_close_ int fd ; //<S2SV> int r ; //<S2SV> assert ( path ) ; //<S2SV> if ( parents ) //<S2SV> mkdir_parents ( path , 0755 ) ; //<S2SV> fd = open ( path , O_WRONLY | O_CREAT | O_CLOEXEC | O_NOCTTY , mode > 0 ? mode : 0644 ) ; //<S2SV> if ( fd < 0 ) //<S2SV> return - errno ; //<S2SV> if ( mode != MODE_INVALID ) { //<S2SV> r = fchmod ( fd , mode ) ; //<S2SV> if ( r < 0 ) //<S2SV> return - errno ; //<S2SV> } //<S2SV> if ( uid != UID_INVALID || gid != GID_INVALID ) { //<S2SV> r = fchown ( fd , uid , gid ) ; //<S2SV> if ( r < 0 ) //<S2SV> return - errno ; //<S2SV> } //<S2SV> if ( stamp != USEC_INFINITY ) { //<S2SV> struct timespec ts [ 2 ] ; //<S2SV> timespec_store ( & ts [ 0 ] , stamp ) ; //<S2SV> ts [ 1 ] = ts [ 0 ] ; //<S2SV> r = futimens ( fd , ts ) ; //<S2SV> } else //<S2SV> r = futimens ( fd , NULL ) ; //<S2SV> if ( r < 0 ) //<S2SV> return - errno ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 