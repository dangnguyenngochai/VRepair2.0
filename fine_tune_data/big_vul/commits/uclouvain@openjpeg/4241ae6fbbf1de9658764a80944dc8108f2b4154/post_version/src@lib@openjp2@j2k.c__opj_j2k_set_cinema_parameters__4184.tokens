static void opj_j2k_set_cinema_parameters ( opj_cparameters_t * parameters , //<S2SV> opj_image_t * image , opj_event_mgr_t * p_manager ) //<S2SV> { //<S2SV> int i ; //<S2SV> parameters -> tile_size_on = OPJ_FALSE ; //<S2SV> parameters -> cp_tdx = 1 ; //<S2SV> parameters -> cp_tdy = 1 ; //<S2SV> parameters -> tp_flag = 'C' ; //<S2SV> parameters -> tp_on = 1 ; //<S2SV> parameters -> cp_tx0 = 0 ; //<S2SV> parameters -> cp_ty0 = 0 ; //<S2SV> parameters -> image_offset_x0 = 0 ; //<S2SV> parameters -> image_offset_y0 = 0 ; //<S2SV> parameters -> cblockw_init = 32 ; //<S2SV> parameters -> cblockh_init = 32 ; //<S2SV> parameters -> mode = 0 ; //<S2SV> parameters -> roi_compno = - 1 ; //<S2SV> parameters -> subsampling_dx = 1 ; //<S2SV> parameters -> subsampling_dy = 1 ; //<S2SV> parameters -> irreversible = 1 ; //<S2SV> if ( parameters -> tcp_numlayers > 1 ) { //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-3<S2SV_blank>and<S2SV_blank>4<S2SV_blank>(2k/4k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "1<S2SV_blank>single<S2SV_blank>quality<S2SV_blank>layer" //<S2SV> "-><S2SV_blank>Number<S2SV_blank>of<S2SV_blank>layers<S2SV_blank>forced<S2SV_blank>to<S2SV_blank>1<S2SV_blank>(rather<S2SV_blank>than<S2SV_blank>%d)\\n" //<S2SV> "-><S2SV_blank>Rate<S2SV_blank>of<S2SV_blank>the<S2SV_blank>last<S2SV_blank>layer<S2SV_blank>(%3.1f)<S2SV_blank>will<S2SV_blank>be<S2SV_blank>used" , //<S2SV> parameters -> tcp_numlayers , //<S2SV> parameters -> tcp_rates [ parameters -> tcp_numlayers - 1 ] ) ; //<S2SV> parameters -> tcp_rates [ 0 ] = parameters -> tcp_rates [ parameters -> tcp_numlayers - 1 ] ; //<S2SV> parameters -> tcp_numlayers = 1 ; //<S2SV> } //<S2SV> switch ( parameters -> rsiz ) { //<S2SV> case OPJ_PROFILE_CINEMA_2K : //<S2SV> if ( parameters -> numresolution > 6 ) { //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-3<S2SV_blank>(2k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "Number<S2SV_blank>of<S2SV_blank>decomposition<S2SV_blank>levels<S2SV_blank><=<S2SV_blank>5\\n" //<S2SV> "-><S2SV_blank>Number<S2SV_blank>of<S2SV_blank>decomposition<S2SV_blank>levels<S2SV_blank>forced<S2SV_blank>to<S2SV_blank>5<S2SV_blank>(rather<S2SV_blank>than<S2SV_blank>%d)\\n" , //<S2SV> parameters -> numresolution + 1 ) ; //<S2SV> parameters -> numresolution = 6 ; //<S2SV> } //<S2SV> break ; //<S2SV> case OPJ_PROFILE_CINEMA_4K : //<S2SV> if ( parameters -> numresolution < 2 ) { //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-4<S2SV_blank>(4k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "Number<S2SV_blank>of<S2SV_blank>decomposition<S2SV_blank>levels<S2SV_blank>>=<S2SV_blank>1<S2SV_blank>&&<S2SV_blank><=<S2SV_blank>6\\n" //<S2SV> "-><S2SV_blank>Number<S2SV_blank>of<S2SV_blank>decomposition<S2SV_blank>levels<S2SV_blank>forced<S2SV_blank>to<S2SV_blank>1<S2SV_blank>(rather<S2SV_blank>than<S2SV_blank>%d)\\n" , //<S2SV> parameters -> numresolution + 1 ) ; //<S2SV> parameters -> numresolution = 1 ; //<S2SV> } else if ( parameters -> numresolution > 7 ) { //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-4<S2SV_blank>(4k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "Number<S2SV_blank>of<S2SV_blank>decomposition<S2SV_blank>levels<S2SV_blank>>=<S2SV_blank>1<S2SV_blank>&&<S2SV_blank><=<S2SV_blank>6\\n" //<S2SV> "-><S2SV_blank>Number<S2SV_blank>of<S2SV_blank>decomposition<S2SV_blank>levels<S2SV_blank>forced<S2SV_blank>to<S2SV_blank>6<S2SV_blank>(rather<S2SV_blank>than<S2SV_blank>%d)\\n" , //<S2SV> parameters -> numresolution + 1 ) ; //<S2SV> parameters -> numresolution = 7 ; //<S2SV> } //<S2SV> break ; //<S2SV> default : //<S2SV> break ; //<S2SV> } //<S2SV> parameters -> csty |= 0x01 ; //<S2SV> if ( parameters -> numresolution == 1 ) { //<S2SV> parameters -> res_spec = 1 ; //<S2SV> parameters -> prcw_init [ 0 ] = 128 ; //<S2SV> parameters -> prch_init [ 0 ] = 128 ; //<S2SV> } else { //<S2SV> parameters -> res_spec = parameters -> numresolution - 1 ; //<S2SV> for ( i = 0 ; i < parameters -> res_spec ; i ++ ) { //<S2SV> parameters -> prcw_init [ i ] = 256 ; //<S2SV> parameters -> prch_init [ i ] = 256 ; //<S2SV> } //<S2SV> } //<S2SV> parameters -> prog_order = OPJ_CPRL ; //<S2SV> if ( parameters -> rsiz == OPJ_PROFILE_CINEMA_4K ) { //<S2SV> parameters -> numpocs = ( OPJ_UINT32 ) opj_j2k_initialise_4K_poc ( parameters -> POC , //<S2SV> parameters -> numresolution ) ; //<S2SV> } else { //<S2SV> parameters -> numpocs = 0 ; //<S2SV> } //<S2SV> parameters -> cp_disto_alloc = 1 ; //<S2SV> if ( parameters -> max_cs_size <= 0 ) { //<S2SV> parameters -> max_cs_size = OPJ_CINEMA_24_CS ; //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-3<S2SV_blank>and<S2SV_blank>4<S2SV_blank>(2k/4k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "Maximum<S2SV_blank>1302083<S2SV_blank>compressed<S2SV_blank>bytes<S2SV_blank>@<S2SV_blank>24fps\\n" //<S2SV> "As<S2SV_blank>no<S2SV_blank>rate<S2SV_blank>has<S2SV_blank>been<S2SV_blank>given,<S2SV_blank>this<S2SV_blank>limit<S2SV_blank>will<S2SV_blank>be<S2SV_blank>used.\\n" ) ; //<S2SV> } else if ( parameters -> max_cs_size > OPJ_CINEMA_24_CS ) { //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-3<S2SV_blank>and<S2SV_blank>4<S2SV_blank>(2k/4k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "Maximum<S2SV_blank>1302083<S2SV_blank>compressed<S2SV_blank>bytes<S2SV_blank>@<S2SV_blank>24fps\\n" //<S2SV> "-><S2SV_blank>Specified<S2SV_blank>rate<S2SV_blank>exceeds<S2SV_blank>this<S2SV_blank>limit.<S2SV_blank>Rate<S2SV_blank>will<S2SV_blank>be<S2SV_blank>forced<S2SV_blank>to<S2SV_blank>1302083<S2SV_blank>bytes.\\n" ) ; //<S2SV> parameters -> max_cs_size = OPJ_CINEMA_24_CS ; //<S2SV> } //<S2SV> if ( parameters -> max_comp_size <= 0 ) { //<S2SV> parameters -> max_comp_size = OPJ_CINEMA_24_COMP ; //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-3<S2SV_blank>and<S2SV_blank>4<S2SV_blank>(2k/4k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "Maximum<S2SV_blank>1041666<S2SV_blank>compressed<S2SV_blank>bytes<S2SV_blank>@<S2SV_blank>24fps\\n" //<S2SV> "As<S2SV_blank>no<S2SV_blank>rate<S2SV_blank>has<S2SV_blank>been<S2SV_blank>given,<S2SV_blank>this<S2SV_blank>limit<S2SV_blank>will<S2SV_blank>be<S2SV_blank>used.\\n" ) ; //<S2SV> } else if ( parameters -> max_comp_size > OPJ_CINEMA_24_COMP ) { //<S2SV> opj_event_msg ( p_manager , EVT_WARNING , //<S2SV> "JPEG<S2SV_blank>2000<S2SV_blank>Profile-3<S2SV_blank>and<S2SV_blank>4<S2SV_blank>(2k/4k<S2SV_blank>dc<S2SV_blank>profile)<S2SV_blank>requires:\\n" //<S2SV> "Maximum<S2SV_blank>1041666<S2SV_blank>compressed<S2SV_blank>bytes<S2SV_blank>@<S2SV_blank>24fps\\n" //<S2SV> "-><S2SV_blank>Specified<S2SV_blank>rate<S2SV_blank>exceeds<S2SV_blank>this<S2SV_blank>limit.<S2SV_blank>Rate<S2SV_blank>will<S2SV_blank>be<S2SV_blank>forced<S2SV_blank>to<S2SV_blank>1041666<S2SV_blank>bytes.\\n" ) ; //<S2SV> parameters -> max_comp_size = OPJ_CINEMA_24_COMP ; //<S2SV> } //<S2SV> parameters -> tcp_rates [ 0 ] = ( OPJ_FLOAT32 ) ( image -> numcomps * image -> comps [ 0 ] . w * //<S2SV> image -> comps [ 0 ] . h * image -> comps [ 0 ] . prec ) / //<S2SV> ( OPJ_FLOAT32 ) ( ( ( OPJ_UINT32 ) parameters -> max_cs_size ) * 8 * image -> comps [ 0 ] . dx * //<S2SV> image -> comps [ 0 ] . dy ) ; //<S2SV> } //<S2SV> 