int read_file ( struct sc_card * card , char * str_path , unsigned char * * data , size_t * data_len ) //<S2SV> { //<S2SV> struct sc_path path ; //<S2SV> struct sc_file * file ; //<S2SV> unsigned char * p ; //<S2SV> int ok = 0 ; //<S2SV> int r ; //<S2SV> size_t len ; //<S2SV> sc_format_path ( str_path , & path ) ; //<S2SV> if ( SC_SUCCESS != sc_select_file ( card , & path , & file ) ) { //<S2SV> goto err ; //<S2SV> } //<S2SV> len = file && file -> size > 0 ? file -> size : 4096 ; //<S2SV> p = realloc ( * data , len ) ; //<S2SV> if ( ! p ) { //<S2SV> goto err ; //<S2SV> } //<S2SV> * data = p ; //<S2SV> * data_len = len ; //<S2SV> r = sc_read_binary ( card , 0 , p , len , 0 ) ; //<S2SV> if ( r < 0 ) //<S2SV> goto err ; //<S2SV> * data_len = r ; //<S2SV> ok = 1 ; //<S2SV> err : //<S2SV> sc_file_free ( file ) ; //<S2SV> return ok ; //<S2SV> } //<S2SV> 