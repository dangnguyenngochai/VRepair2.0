static int muscle_list_files ( sc_card_t * card , u8 * buf , size_t bufLen ) //<S2SV> { //<S2SV> muscle_private_t * priv = MUSCLE_DATA ( card ) ; //<S2SV> mscfs_t * fs = priv -> fs ; //<S2SV> int x ; //<S2SV> int count = 0 ; //<S2SV> mscfs_check_cache ( priv -> fs ) ; //<S2SV> for ( x = 0 ; x < fs -> cache . size ; x ++ ) { //<S2SV> u8 * oid = fs -> cache . array [ x ] . objectId . id ; //<S2SV> if ( bufLen < 2 ) //<S2SV> break ; //<S2SV> sc_debug ( card -> ctx , SC_LOG_DEBUG_NORMAL , //<S2SV> "FILE:<S2SV_blank>%02X%02X%02X%02X\\n" , //<S2SV> oid [ 0 ] , oid [ 1 ] , oid [ 2 ] , oid [ 3 ] ) ; //<S2SV> if ( 0 == memcmp ( fs -> currentPath , oid , 2 ) ) { //<S2SV> buf [ 0 ] = oid [ 2 ] ; //<S2SV> buf [ 1 ] = oid [ 3 ] ; //<S2SV> if ( buf [ 0 ] == 0x00 && buf [ 1 ] == 0x00 ) continue ; //<S2SV> buf += 2 ; //<S2SV> count += 2 ; //<S2SV> bufLen -= 2 ; //<S2SV> } //<S2SV> } //<S2SV> return count ; //<S2SV> } //<S2SV> 