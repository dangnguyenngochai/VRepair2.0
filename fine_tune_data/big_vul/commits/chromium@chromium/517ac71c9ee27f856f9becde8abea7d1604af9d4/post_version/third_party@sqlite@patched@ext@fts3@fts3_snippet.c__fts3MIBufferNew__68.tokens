static MatchinfoBuffer * fts3MIBufferNew ( int nElem , const char * zMatchinfo ) { //<S2SV> MatchinfoBuffer * pRet ; //<S2SV> sqlite3_int64 nByte = sizeof ( u32 ) * ( 2 * ( sqlite3_int64 ) nElem + 1 ) //<S2SV> + sizeof ( MatchinfoBuffer ) ; //<S2SV> sqlite3_int64 nStr = strlen ( zMatchinfo ) ; //<S2SV> pRet = sqlite3_malloc64 ( nByte + nStr + 1 ) ; //<S2SV> if ( pRet ) { //<S2SV> memset ( pRet , 0 , nByte ) ; //<S2SV> pRet -> aMatchinfo [ 0 ] = ( u8 * ) ( & pRet -> aMatchinfo [ 1 ] ) - ( u8 * ) pRet ; //<S2SV> pRet -> aMatchinfo [ 1 + nElem ] = pRet -> aMatchinfo [ 0 ] + sizeof ( u32 ) * ( nElem + 1 ) ; //<S2SV> pRet -> nElem = nElem ; //<S2SV> pRet -> zMatchinfo = ( ( char * ) pRet ) + nByte ; //<S2SV> memcpy ( pRet -> zMatchinfo , zMatchinfo , nStr + 1 ) ; //<S2SV> pRet -> aRef [ 0 ] = 1 ; //<S2SV> } //<S2SV> return pRet ; //<S2SV> } //<S2SV> 