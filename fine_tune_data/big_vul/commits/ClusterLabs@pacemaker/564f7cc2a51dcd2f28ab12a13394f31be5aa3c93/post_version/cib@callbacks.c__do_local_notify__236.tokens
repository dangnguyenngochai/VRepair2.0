static void //<S2SV> do_local_notify ( xmlNode * notify_src , const char * client_id , //<S2SV> gboolean sync_reply , gboolean from_peer ) //<S2SV> { //<S2SV> cib_client_t * client_obj = NULL ; //<S2SV> int local_rc = pcmk_ok ; //<S2SV> if ( client_id != NULL ) { //<S2SV> client_obj = g_hash_table_lookup ( client_list , client_id ) ; //<S2SV> } else { //<S2SV> crm_trace ( "No<S2SV_blank>client<S2SV_blank>to<S2SV_blank>sent<S2SV_blank>the<S2SV_blank>response<S2SV_blank>to.<S2SV_blank>F_CIB_CLIENTID<S2SV_blank>not<S2SV_blank>set." ) ; //<S2SV> } //<S2SV> if ( client_obj == NULL ) { //<S2SV> local_rc = - ECONNRESET ; //<S2SV> } else { //<S2SV> int rid = 0 ; //<S2SV> if ( sync_reply ) { //<S2SV> if ( client_obj -> ipc ) { //<S2SV> CRM_LOG_ASSERT ( client_obj -> request_id ) ; //<S2SV> rid = client_obj -> request_id ; //<S2SV> client_obj -> request_id = 0 ; //<S2SV> crm_trace ( "Sending<S2SV_blank>response<S2SV_blank>%d<S2SV_blank>to<S2SV_blank>%s<S2SV_blank>%s" , //<S2SV> rid , client_obj -> name , from_peer ? "(originator<S2SV_blank>of<S2SV_blank>delegated<S2SV_blank>request)" : "" ) ; //<S2SV> } else { //<S2SV> crm_trace ( "Sending<S2SV_blank>response<S2SV_blank>to<S2SV_blank>%s<S2SV_blank>%s" , //<S2SV> client_obj -> name , from_peer ? "(originator<S2SV_blank>of<S2SV_blank>delegated<S2SV_blank>request)" : "" ) ; //<S2SV> } //<S2SV> } else { //<S2SV> crm_trace ( "Sending<S2SV_blank>an<S2SV_blank>event<S2SV_blank>to<S2SV_blank>%s<S2SV_blank>%s" , //<S2SV> client_obj -> name , from_peer ? "(originator<S2SV_blank>of<S2SV_blank>delegated<S2SV_blank>request)" : "" ) ; //<S2SV> } //<S2SV> if ( client_obj -> ipc && crm_ipcs_send ( client_obj -> ipc , rid , notify_src , ! sync_reply ) < 0 ) { //<S2SV> local_rc = - ENOMSG ; //<S2SV> # ifdef HAVE_GNUTLS_GNUTLS_H //<S2SV> } else if ( client_obj -> session ) { //<S2SV> crm_send_remote_msg ( client_obj -> session , notify_src , client_obj -> encrypted ) ; //<S2SV> # endif //<S2SV> } else if ( client_obj -> ipc == NULL ) { //<S2SV> crm_err ( "Unknown<S2SV_blank>transport<S2SV_blank>for<S2SV_blank>%s" , client_obj -> name ) ; //<S2SV> } //<S2SV> } //<S2SV> if ( local_rc != pcmk_ok && client_obj != NULL ) { //<S2SV> crm_warn ( "%sSync<S2SV_blank>reply<S2SV_blank>to<S2SV_blank>%s<S2SV_blank>failed:<S2SV_blank>%s" , //<S2SV> sync_reply ? "" : "A-" , //<S2SV> client_obj ? client_obj -> name : "<unknown>" , pcmk_strerror ( local_rc ) ) ; //<S2SV> } //<S2SV> } //<S2SV> 