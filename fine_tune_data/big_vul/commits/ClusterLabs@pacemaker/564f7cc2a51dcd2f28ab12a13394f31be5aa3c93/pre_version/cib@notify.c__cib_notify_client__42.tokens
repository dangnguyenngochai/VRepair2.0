gboolean //<S2SV> cib_notify_client ( gpointer key , gpointer value , gpointer user_data ) //<S2SV> { //<S2SV> const char * type = NULL ; //<S2SV> gboolean do_send = FALSE ; //<S2SV> cib_client_t * client = value ; //<S2SV> xmlNode * update_msg = user_data ; //<S2SV> CRM_CHECK ( client != NULL , return TRUE ) ; //<S2SV> CRM_CHECK ( update_msg != NULL , return TRUE ) ; //<S2SV> if ( client -> ipc == NULL ) { //<S2SV> crm_warn ( "Skipping<S2SV_blank>client<S2SV_blank>with<S2SV_blank>NULL<S2SV_blank>channel" ) ; //<S2SV> return FALSE ; //<S2SV> } //<S2SV> type = crm_element_value ( update_msg , F_SUBTYPE ) ; //<S2SV> CRM_LOG_ASSERT ( type != NULL ) ; //<S2SV> if ( client -> diffs && safe_str_eq ( type , T_CIB_DIFF_NOTIFY ) ) { //<S2SV> do_send = TRUE ; //<S2SV> } else if ( client -> replace && safe_str_eq ( type , T_CIB_REPLACE_NOTIFY ) ) { //<S2SV> do_send = TRUE ; //<S2SV> } else if ( client -> confirmations && safe_str_eq ( type , T_CIB_UPDATE_CONFIRM ) ) { //<S2SV> do_send = TRUE ; //<S2SV> } else if ( client -> pre_notify && safe_str_eq ( type , T_CIB_PRE_NOTIFY ) ) { //<S2SV> do_send = TRUE ; //<S2SV> } else if ( client -> post_notify && safe_str_eq ( type , T_CIB_POST_NOTIFY ) ) { //<S2SV> do_send = TRUE ; //<S2SV> } //<S2SV> if ( do_send ) { //<S2SV> if ( client -> ipc ) { //<S2SV> if ( crm_ipcs_send ( client -> ipc , 0 , update_msg , TRUE ) == FALSE ) { //<S2SV> crm_warn ( "Notification<S2SV_blank>of<S2SV_blank>client<S2SV_blank>%s/%s<S2SV_blank>failed" , client -> name , client -> id ) ; //<S2SV> } //<S2SV> # ifdef HAVE_GNUTLS_GNUTLS_H //<S2SV> } else if ( client -> session ) { //<S2SV> crm_debug ( "Sent<S2SV_blank>%s<S2SV_blank>notification<S2SV_blank>to<S2SV_blank>client<S2SV_blank>%s/%s" , type , client -> name , client -> id ) ; //<S2SV> crm_send_remote_msg ( client -> session , update_msg , client -> encrypted ) ; //<S2SV> # endif //<S2SV> } else { //<S2SV> crm_err ( "Unknown<S2SV_blank>transport<S2SV_blank>for<S2SV_blank>%s" , client -> name ) ; //<S2SV> } //<S2SV> } //<S2SV> return FALSE ; //<S2SV> } //<S2SV> 