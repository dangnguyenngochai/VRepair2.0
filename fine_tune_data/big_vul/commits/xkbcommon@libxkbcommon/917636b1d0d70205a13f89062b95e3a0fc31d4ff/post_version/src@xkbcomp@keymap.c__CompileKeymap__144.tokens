bool //<S2SV> CompileKeymap ( XkbFile * file , struct xkb_keymap * keymap , enum merge_mode merge ) //<S2SV> { //<S2SV> bool ok ; //<S2SV> XkbFile * files [ LAST_KEYMAP_FILE_TYPE + 1 ] = { NULL } ; //<S2SV> enum xkb_file_type type ; //<S2SV> struct xkb_context * ctx = keymap -> ctx ; //<S2SV> for ( file = ( XkbFile * ) file -> defs ; file ; //<S2SV> file = ( XkbFile * ) file -> common . next ) { //<S2SV> if ( file -> file_type < FIRST_KEYMAP_FILE_TYPE || //<S2SV> file -> file_type > LAST_KEYMAP_FILE_TYPE ) { //<S2SV> if ( file -> file_type == FILE_TYPE_GEOMETRY ) { //<S2SV> log_vrb ( ctx , 1 , //<S2SV> "Geometry<S2SV_blank>sections<S2SV_blank>are<S2SV_blank>not<S2SV_blank>supported;<S2SV_blank>ignoring\\n" ) ; //<S2SV> } else { //<S2SV> log_err ( ctx , "Cannot<S2SV_blank>define<S2SV_blank>%s<S2SV_blank>in<S2SV_blank>a<S2SV_blank>keymap<S2SV_blank>file\\n" , //<S2SV> xkb_file_type_to_string ( file -> file_type ) ) ; //<S2SV> } //<S2SV> continue ; //<S2SV> } //<S2SV> if ( files [ file -> file_type ] ) { //<S2SV> log_err ( ctx , //<S2SV> "More<S2SV_blank>than<S2SV_blank>one<S2SV_blank>%s<S2SV_blank>section<S2SV_blank>in<S2SV_blank>keymap<S2SV_blank>file;<S2SV_blank>" //<S2SV> "All<S2SV_blank>sections<S2SV_blank>after<S2SV_blank>the<S2SV_blank>first<S2SV_blank>ignored\\n" , //<S2SV> xkb_file_type_to_string ( file -> file_type ) ) ; //<S2SV> continue ; //<S2SV> } //<S2SV> files [ file -> file_type ] = file ; //<S2SV> } //<S2SV> ok = true ; //<S2SV> for ( type = FIRST_KEYMAP_FILE_TYPE ; //<S2SV> type <= LAST_KEYMAP_FILE_TYPE ; //<S2SV> type ++ ) { //<S2SV> if ( files [ type ] == NULL ) { //<S2SV> log_err ( ctx , "Required<S2SV_blank>section<S2SV_blank>%s<S2SV_blank>missing<S2SV_blank>from<S2SV_blank>keymap\\n" , //<S2SV> xkb_file_type_to_string ( type ) ) ; //<S2SV> ok = false ; //<S2SV> } //<S2SV> } //<S2SV> if ( ! ok ) //<S2SV> return false ; //<S2SV> for ( type = FIRST_KEYMAP_FILE_TYPE ; //<S2SV> type <= LAST_KEYMAP_FILE_TYPE ; //<S2SV> type ++ ) { //<S2SV> log_dbg ( ctx , "Compiling<S2SV_blank>%s<S2SV_blank>\\"%s\\"\\n" , //<S2SV> xkb_file_type_to_string ( type ) , files [ type ] -> name ) ; //<S2SV> ok = compile_file_fns [ type ] ( files [ type ] , keymap , merge ) ; //<S2SV> if ( ! ok ) { //<S2SV> log_err ( ctx , "Failed<S2SV_blank>to<S2SV_blank>compile<S2SV_blank>%s\\n" , //<S2SV> xkb_file_type_to_string ( type ) ) ; //<S2SV> return false ; //<S2SV> } //<S2SV> } //<S2SV> return UpdateDerivedKeymapFields ( keymap ) ; //<S2SV> } //<S2SV> 