static int readContigStripsIntoBuffer ( TIFF * in , uint8 * buf ) //<S2SV> { //<S2SV> uint8 * bufp = buf ; //<S2SV> int32 bytes_read = 0 ; //<S2SV> uint16 strip , nstrips = TIFFNumberOfStrips ( in ) ; //<S2SV> uint32 stripsize = TIFFStripSize ( in ) ; //<S2SV> uint32 rows = 0 ; //<S2SV> uint32 rps = TIFFGetFieldDefaulted ( in , TIFFTAG_ROWSPERSTRIP , & rps ) ; //<S2SV> tsize_t scanline_size = TIFFScanlineSize ( in ) ; //<S2SV> if ( scanline_size == 0 ) { //<S2SV> TIFFError ( "" , "TIFF<S2SV_blank>scanline<S2SV_blank>size<S2SV_blank>is<S2SV_blank>zero!" ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> for ( strip = 0 ; strip < nstrips ; strip ++ ) { //<S2SV> bytes_read = TIFFReadEncodedStrip ( in , strip , bufp , - 1 ) ; //<S2SV> rows = bytes_read / scanline_size ; //<S2SV> if ( ( strip < ( nstrips - 1 ) ) && ( bytes_read != ( int32 ) stripsize ) ) //<S2SV> TIFFError ( "" , "Strip<S2SV_blank>%d:<S2SV_blank>read<S2SV_blank>%lu<S2SV_blank>bytes,<S2SV_blank>strip<S2SV_blank>size<S2SV_blank>%lu" , //<S2SV> ( int ) strip + 1 , ( unsigned long ) bytes_read , //<S2SV> ( unsigned long ) stripsize ) ; //<S2SV> if ( bytes_read < 0 && ! ignore ) { //<S2SV> TIFFError ( "" , "Error<S2SV_blank>reading<S2SV_blank>strip<S2SV_blank>%lu<S2SV_blank>after<S2SV_blank>%lu<S2SV_blank>rows" , //<S2SV> ( unsigned long ) strip , ( unsigned long ) rows ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> bufp += bytes_read ; //<S2SV> } //<S2SV> return 1 ; //<S2SV> } //<S2SV> 