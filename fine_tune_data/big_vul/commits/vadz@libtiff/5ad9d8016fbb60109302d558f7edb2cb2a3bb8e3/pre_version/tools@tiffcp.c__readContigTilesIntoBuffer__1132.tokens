DECLAREreadFunc ( readContigTilesIntoBuffer ) //<S2SV> { //<S2SV> int status = 1 ; //<S2SV> tsize_t tilesize = TIFFTileSize ( in ) ; //<S2SV> tdata_t tilebuf ; //<S2SV> uint32 imagew = TIFFScanlineSize ( in ) ; //<S2SV> uint32 tilew = TIFFTileRowSize ( in ) ; //<S2SV> int iskew = imagew - tilew ; //<S2SV> uint8 * bufp = ( uint8 * ) buf ; //<S2SV> uint32 tw , tl ; //<S2SV> uint32 row ; //<S2SV> ( void ) spp ; //<S2SV> tilebuf = _TIFFmalloc ( tilesize ) ; //<S2SV> if ( tilebuf == 0 ) //<S2SV> return 0 ; //<S2SV> _TIFFmemset ( tilebuf , 0 , tilesize ) ; //<S2SV> ( void ) TIFFGetField ( in , TIFFTAG_TILEWIDTH , & tw ) ; //<S2SV> ( void ) TIFFGetField ( in , TIFFTAG_TILELENGTH , & tl ) ; //<S2SV> for ( row = 0 ; row < imagelength ; row += tl ) { //<S2SV> uint32 nrow = ( row + tl > imagelength ) ? imagelength - row : tl ; //<S2SV> uint32 colb = 0 ; //<S2SV> uint32 col ; //<S2SV> for ( col = 0 ; col < imagewidth ; col += tw ) { //<S2SV> if ( TIFFReadTile ( in , tilebuf , col , row , 0 , 0 ) < 0 //<S2SV> && ! ignore ) { //<S2SV> TIFFError ( TIFFFileName ( in ) , //<S2SV> "Error,<S2SV_blank>can\'t<S2SV_blank>read<S2SV_blank>tile<S2SV_blank>at<S2SV_blank>%lu<S2SV_blank>%lu" , //<S2SV> ( unsigned long ) col , //<S2SV> ( unsigned long ) row ) ; //<S2SV> status = 0 ; //<S2SV> goto done ; //<S2SV> } //<S2SV> if ( colb + tilew > imagew ) { //<S2SV> uint32 width = imagew - colb ; //<S2SV> uint32 oskew = tilew - width ; //<S2SV> cpStripToTile ( bufp + colb , //<S2SV> tilebuf , nrow , width , //<S2SV> oskew + iskew , oskew ) ; //<S2SV> } else //<S2SV> cpStripToTile ( bufp + colb , //<S2SV> tilebuf , nrow , tilew , //<S2SV> iskew , 0 ) ; //<S2SV> colb += tilew ; //<S2SV> } //<S2SV> bufp += imagew * nrow ; //<S2SV> } //<S2SV> done : //<S2SV> _TIFFfree ( tilebuf ) ; //<S2SV> return status ; //<S2SV> } //<S2SV> 