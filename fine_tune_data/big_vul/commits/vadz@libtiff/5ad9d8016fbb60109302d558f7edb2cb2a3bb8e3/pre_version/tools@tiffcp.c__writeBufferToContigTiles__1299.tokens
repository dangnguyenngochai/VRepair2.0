DECLAREwriteFunc ( writeBufferToContigTiles ) //<S2SV> { //<S2SV> uint32 imagew = TIFFScanlineSize ( out ) ; //<S2SV> uint32 tilew = TIFFTileRowSize ( out ) ; //<S2SV> int iskew = imagew - tilew ; //<S2SV> tsize_t tilesize = TIFFTileSize ( out ) ; //<S2SV> tdata_t obuf ; //<S2SV> uint8 * bufp = ( uint8 * ) buf ; //<S2SV> uint32 tl , tw ; //<S2SV> uint32 row ; //<S2SV> ( void ) spp ; //<S2SV> obuf = _TIFFmalloc ( TIFFTileSize ( out ) ) ; //<S2SV> if ( obuf == NULL ) //<S2SV> return 0 ; //<S2SV> _TIFFmemset ( obuf , 0 , tilesize ) ; //<S2SV> ( void ) TIFFGetField ( out , TIFFTAG_TILELENGTH , & tl ) ; //<S2SV> ( void ) TIFFGetField ( out , TIFFTAG_TILEWIDTH , & tw ) ; //<S2SV> for ( row = 0 ; row < imagelength ; row += tilelength ) { //<S2SV> uint32 nrow = ( row + tl > imagelength ) ? imagelength - row : tl ; //<S2SV> uint32 colb = 0 ; //<S2SV> uint32 col ; //<S2SV> for ( col = 0 ; col < imagewidth ; col += tw ) { //<S2SV> if ( colb + tilew > imagew ) { //<S2SV> uint32 width = imagew - colb ; //<S2SV> int oskew = tilew - width ; //<S2SV> cpStripToTile ( obuf , bufp + colb , nrow , width , //<S2SV> oskew , oskew + iskew ) ; //<S2SV> } else //<S2SV> cpStripToTile ( obuf , bufp + colb , nrow , tilew , //<S2SV> 0 , iskew ) ; //<S2SV> if ( TIFFWriteTile ( out , obuf , col , row , 0 , 0 ) < 0 ) { //<S2SV> TIFFError ( TIFFFileName ( out ) , //<S2SV> "Error,<S2SV_blank>can\'t<S2SV_blank>write<S2SV_blank>tile<S2SV_blank>at<S2SV_blank>%lu<S2SV_blank>%lu" , //<S2SV> ( unsigned long ) col , //<S2SV> ( unsigned long ) row ) ; //<S2SV> _TIFFfree ( obuf ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> colb += tilew ; //<S2SV> } //<S2SV> bufp += nrow * imagew ; //<S2SV> } //<S2SV> _TIFFfree ( obuf ) ; //<S2SV> return 1 ; //<S2SV> } //<S2SV> 