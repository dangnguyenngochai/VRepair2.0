DECLAREcpFunc ( cpDecodedStrips ) //<S2SV> { //<S2SV> tsize_t stripsize = TIFFStripSize ( in ) ; //<S2SV> tdata_t buf = _TIFFmalloc ( stripsize ) ; //<S2SV> ( void ) imagewidth ; ( void ) spp ; //<S2SV> if ( buf ) { //<S2SV> tstrip_t s , ns = TIFFNumberOfStrips ( in ) ; //<S2SV> uint32 row = 0 ; //<S2SV> _TIFFmemset ( buf , 0 , stripsize ) ; //<S2SV> for ( s = 0 ; s < ns ; s ++ ) { //<S2SV> tsize_t cc = ( row + rowsperstrip > imagelength ) ? //<S2SV> TIFFVStripSize ( in , imagelength - row ) : stripsize ; //<S2SV> if ( TIFFReadEncodedStrip ( in , s , buf , cc ) < 0 //<S2SV> && ! ignore ) { //<S2SV> TIFFError ( TIFFFileName ( in ) , //<S2SV> "Error,<S2SV_blank>can\'t<S2SV_blank>read<S2SV_blank>strip<S2SV_blank>%lu" , //<S2SV> ( unsigned long ) s ) ; //<S2SV> goto bad ; //<S2SV> } //<S2SV> if ( TIFFWriteEncodedStrip ( out , s , buf , cc ) < 0 ) { //<S2SV> TIFFError ( TIFFFileName ( out ) , //<S2SV> "Error,<S2SV_blank>can\'t<S2SV_blank>write<S2SV_blank>strip<S2SV_blank>%lu" , //<S2SV> ( unsigned long ) s ) ; //<S2SV> goto bad ; //<S2SV> } //<S2SV> row += rowsperstrip ; //<S2SV> } //<S2SV> _TIFFfree ( buf ) ; //<S2SV> return 1 ; //<S2SV> } else { //<S2SV> TIFFError ( TIFFFileName ( in ) , //<S2SV> "Error,<S2SV_blank>can\'t<S2SV_blank>allocate<S2SV_blank>memory<S2SV_blank>buffer<S2SV_blank>of<S2SV_blank>size<S2SV_blank>%lu<S2SV_blank>" //<S2SV> "to<S2SV_blank>read<S2SV_blank>strips" , ( unsigned long ) stripsize ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> bad : //<S2SV> _TIFFfree ( buf ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 