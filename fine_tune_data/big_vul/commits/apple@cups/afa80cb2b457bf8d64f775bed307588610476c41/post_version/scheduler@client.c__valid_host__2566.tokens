static int //<S2SV> valid_host ( cupsd_client_t * con ) //<S2SV> { //<S2SV> cupsd_alias_t * a ; //<S2SV> cupsd_netif_t * netif ; //<S2SV> const char * end ; //<S2SV> char * ptr ; //<S2SV> strlcpy ( con -> clientname , httpGetField ( con -> http , HTTP_FIELD_HOST ) , //<S2SV> sizeof ( con -> clientname ) ) ; //<S2SV> if ( ( ptr = strrchr ( con -> clientname , ':' ) ) != NULL && ! strchr ( ptr , ']' ) ) //<S2SV> { //<S2SV> * ptr ++ = '\\0' ; //<S2SV> con -> clientport = atoi ( ptr ) ; //<S2SV> } //<S2SV> else //<S2SV> con -> clientport = con -> serverport ; //<S2SV> if ( httpAddrLocalhost ( httpGetAddress ( con -> http ) ) ) //<S2SV> { //<S2SV> return ( ! _cups_strcasecmp ( con -> clientname , "localhost" ) || //<S2SV> ! _cups_strcasecmp ( con -> clientname , "localhost." ) || //<S2SV> ! strcmp ( con -> clientname , "127.0.0.1" ) || //<S2SV> ! strcmp ( con -> clientname , "[::1]" ) ) ; //<S2SV> } //<S2SV> # if defined ( HAVE_DNSSD ) || defined ( HAVE_AVAHI ) //<S2SV> if ( ( end = strrchr ( con -> clientname , '.' ) ) != NULL && end > con -> clientname && //<S2SV> ! end [ 1 ] ) //<S2SV> { //<S2SV> for ( end -- ; end > con -> clientname && * end != '.' ; end -- ) ; //<S2SV> } //<S2SV> if ( end && ( ! _cups_strcasecmp ( end , ".local" ) || //<S2SV> ! _cups_strcasecmp ( end , ".local." ) ) ) //<S2SV> return ( 1 ) ; //<S2SV> # endif //<S2SV> if ( isdigit ( con -> clientname [ 0 ] & 255 ) || con -> clientname [ 0 ] == '[' ) //<S2SV> { //<S2SV> http_addrlist_t * addrlist ; //<S2SV> if ( ( addrlist = httpAddrGetList ( con -> clientname , AF_UNSPEC , NULL ) ) != NULL ) //<S2SV> { //<S2SV> httpAddrFreeList ( addrlist ) ; //<S2SV> return ( 1 ) ; //<S2SV> } //<S2SV> } //<S2SV> for ( a = ( cupsd_alias_t * ) cupsArrayFirst ( ServerAlias ) ; //<S2SV> a ; //<S2SV> a = ( cupsd_alias_t * ) cupsArrayNext ( ServerAlias ) ) //<S2SV> { //<S2SV> if ( ! strcmp ( a -> name , "*" ) ) //<S2SV> return ( 1 ) ; //<S2SV> if ( ! _cups_strncasecmp ( con -> clientname , a -> name , a -> namelen ) ) //<S2SV> { //<S2SV> end = con -> clientname + a -> namelen ; //<S2SV> if ( ! * end || ( * end == '.' && ! end [ 1 ] ) ) //<S2SV> return ( 1 ) ; //<S2SV> } //<S2SV> } //<S2SV> # if defined ( HAVE_DNSSD ) || defined ( HAVE_AVAHI ) //<S2SV> for ( a = ( cupsd_alias_t * ) cupsArrayFirst ( DNSSDAlias ) ; //<S2SV> a ; //<S2SV> a = ( cupsd_alias_t * ) cupsArrayNext ( DNSSDAlias ) ) //<S2SV> { //<S2SV> if ( ! strcmp ( a -> name , "*" ) ) //<S2SV> return ( 1 ) ; //<S2SV> if ( ! _cups_strncasecmp ( con -> clientname , a -> name , a -> namelen ) ) //<S2SV> { //<S2SV> end = con -> clientname + a -> namelen ; //<S2SV> if ( ! * end || ( * end == '.' && ! end [ 1 ] ) ) //<S2SV> return ( 1 ) ; //<S2SV> } //<S2SV> } //<S2SV> # endif //<S2SV> for ( netif = ( cupsd_netif_t * ) cupsArrayFirst ( NetIFList ) ; //<S2SV> netif ; //<S2SV> netif = ( cupsd_netif_t * ) cupsArrayNext ( NetIFList ) ) //<S2SV> { //<S2SV> if ( ! _cups_strncasecmp ( con -> clientname , netif -> hostname , netif -> hostlen ) ) //<S2SV> { //<S2SV> end = con -> clientname + netif -> hostlen ; //<S2SV> if ( ! * end || ( * end == '.' && ! end [ 1 ] ) ) //<S2SV> return ( 1 ) ; //<S2SV> } //<S2SV> } //<S2SV> return ( 0 ) ; //<S2SV> } //<S2SV> 