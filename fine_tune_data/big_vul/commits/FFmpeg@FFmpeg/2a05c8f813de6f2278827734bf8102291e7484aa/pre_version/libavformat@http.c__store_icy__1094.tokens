static int store_icy ( URLContext * h , int size ) //<S2SV> { //<S2SV> HTTPContext * s = h -> priv_data ; //<S2SV> int remaining = s -> icy_metaint - s -> icy_data_read ; //<S2SV> if ( remaining < 0 ) //<S2SV> return AVERROR_INVALIDDATA ; //<S2SV> if ( ! remaining ) { //<S2SV> uint8_t ch ; //<S2SV> int len = http_read_stream_all ( h , & ch , 1 ) ; //<S2SV> if ( len < 0 ) //<S2SV> return len ; //<S2SV> if ( ch > 0 ) { //<S2SV> char data [ 255 * 16 + 1 ] ; //<S2SV> int ret ; //<S2SV> len = ch * 16 ; //<S2SV> ret = http_read_stream_all ( h , data , len ) ; //<S2SV> if ( ret < 0 ) //<S2SV> return ret ; //<S2SV> data [ len + 1 ] = 0 ; //<S2SV> if ( ( ret = av_opt_set ( s , "icy_metadata_packet" , data , 0 ) ) < 0 ) //<S2SV> return ret ; //<S2SV> update_metadata ( s , data ) ; //<S2SV> } //<S2SV> s -> icy_data_read = 0 ; //<S2SV> remaining = s -> icy_metaint ; //<S2SV> } //<S2SV> return FFMIN ( size , remaining ) ; //<S2SV> } //<S2SV> 