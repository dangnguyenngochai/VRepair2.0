static int g2m_init_buffers ( G2MContext * c ) //<S2SV> { //<S2SV> int aligned_height ; //<S2SV> if ( ! c -> framebuf || c -> old_width < c -> width || c -> old_height < c -> height ) { //<S2SV> c -> framebuf_stride = FFALIGN ( c -> width + 15 , 16 ) * 3 ; //<S2SV> aligned_height = c -> height + 15 ; //<S2SV> av_free ( c -> framebuf ) ; //<S2SV> c -> framebuf = av_mallocz ( c -> framebuf_stride * aligned_height ) ; //<S2SV> if ( ! c -> framebuf ) //<S2SV> return AVERROR ( ENOMEM ) ; //<S2SV> } //<S2SV> if ( ! c -> synth_tile || ! c -> jpeg_tile || //<S2SV> c -> old_tile_w < c -> tile_width || //<S2SV> c -> old_tile_h < c -> tile_height ) { //<S2SV> c -> tile_stride = FFALIGN ( c -> tile_width , 16 ) * 3 ; //<S2SV> aligned_height = FFALIGN ( c -> tile_height , 16 ) ; //<S2SV> av_free ( c -> synth_tile ) ; //<S2SV> av_free ( c -> jpeg_tile ) ; //<S2SV> av_free ( c -> kempf_buf ) ; //<S2SV> av_free ( c -> kempf_flags ) ; //<S2SV> c -> synth_tile = av_mallocz ( c -> tile_stride * aligned_height ) ; //<S2SV> c -> jpeg_tile = av_mallocz ( c -> tile_stride * aligned_height ) ; //<S2SV> c -> kempf_buf = av_mallocz ( ( c -> tile_width + 1 ) * aligned_height //<S2SV> + FF_INPUT_BUFFER_PADDING_SIZE ) ; //<S2SV> c -> kempf_flags = av_mallocz ( c -> tile_width * aligned_height ) ; //<S2SV> if ( ! c -> synth_tile || ! c -> jpeg_tile || //<S2SV> ! c -> kempf_buf || ! c -> kempf_flags ) //<S2SV> return AVERROR ( ENOMEM ) ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 