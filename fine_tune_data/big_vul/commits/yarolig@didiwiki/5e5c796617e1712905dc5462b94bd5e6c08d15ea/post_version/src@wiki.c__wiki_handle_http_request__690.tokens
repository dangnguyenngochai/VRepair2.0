void //<S2SV> wiki_handle_http_request ( HttpRequest * req ) //<S2SV> { //<S2SV> HttpResponse * res = http_response_new ( req ) ; //<S2SV> char * page = http_request_get_path_info ( req ) ; //<S2SV> char * command = http_request_get_query_string ( req ) ; //<S2SV> char * wikitext = "" ; //<S2SV> util_dehttpize ( page ) ; //<S2SV> if ( ! strcmp ( page , "/" ) ) //<S2SV> { //<S2SV> if ( access ( "WikiHome" , R_OK ) != 0 ) //<S2SV> wiki_redirect ( res , "/WikiHome?create" ) ; //<S2SV> page = "/WikiHome" ; //<S2SV> } //<S2SV> if ( ! strcmp ( page , "/styles.css" ) ) //<S2SV> { //<S2SV> http_response_set_content_type ( res , "text/css" ) ; //<S2SV> http_response_printf ( res , "%s" , CssData ) ; //<S2SV> http_response_send ( res ) ; //<S2SV> exit ( 0 ) ; //<S2SV> } //<S2SV> if ( ! strcmp ( page , "/favicon.ico" ) ) //<S2SV> { //<S2SV> http_response_set_content_type ( res , "image/ico" ) ; //<S2SV> http_response_set_data ( res , FaviconData , FaviconDataLen ) ; //<S2SV> http_response_send ( res ) ; //<S2SV> exit ( 0 ) ; //<S2SV> } //<S2SV> page = page + 1 ; //<S2SV> if ( ! strncmp ( page , "api/" , 4 ) ) //<S2SV> { //<S2SV> char * p ; //<S2SV> page += 4 ; //<S2SV> for ( p = page ; * p != '\\0' ; p ++ ) //<S2SV> if ( * p == '?' ) { * p = '\\0' ; break ; } //<S2SV> wiki_handle_rest_call ( req , res , page ) ; //<S2SV> exit ( 0 ) ; //<S2SV> } //<S2SV> if ( ! page_name_is_good ( page ) ) //<S2SV> { //<S2SV> http_response_set_status ( res , 404 , "Not<S2SV_blank>Found" ) ; //<S2SV> http_response_printf ( res , "<html><body>404<S2SV_blank>Not<S2SV_blank>Found</body></html>\\n" ) ; //<S2SV> http_response_send ( res ) ; //<S2SV> exit ( 0 ) ; //<S2SV> } //<S2SV> if ( ! strcmp ( page , "Changes" ) ) //<S2SV> { //<S2SV> wiki_show_changes_page ( res ) ; //<S2SV> } //<S2SV> else if ( ! strcmp ( page , "ChangesRss" ) ) //<S2SV> { //<S2SV> wiki_show_changes_page_rss ( res ) ; //<S2SV> } //<S2SV> else if ( ! strcmp ( page , "Search" ) ) //<S2SV> { //<S2SV> wiki_show_search_results_page ( res , http_request_param_get ( req , "expr" ) ) ; //<S2SV> } //<S2SV> else if ( ! strcmp ( page , "Create" ) ) //<S2SV> { //<S2SV> if ( ( wikitext = http_request_param_get ( req , "title" ) ) != NULL ) //<S2SV> { //<S2SV> wiki_redirect ( res , http_request_param_get ( req , "title" ) ) ; //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> wiki_show_create_page ( res ) ; //<S2SV> } //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> if ( ( wikitext = http_request_param_get ( req , "wikitext" ) ) != NULL ) //<S2SV> { //<S2SV> file_write ( page , wikitext ) ; //<S2SV> } //<S2SV> if ( access ( page , R_OK ) == 0 ) //<S2SV> { //<S2SV> wikitext = file_read ( page ) ; //<S2SV> if ( ! strcmp ( command , "edit" ) ) //<S2SV> { //<S2SV> wiki_show_edit_page ( res , wikitext , page ) ; //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> wiki_show_page ( res , wikitext , page ) ; //<S2SV> } //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> if ( ! strcmp ( command , "create" ) ) //<S2SV> { //<S2SV> wiki_show_edit_page ( res , NULL , page ) ; //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> char buf [ 1024 ] ; //<S2SV> snprintf ( buf , 1024 , "%s?create" , page ) ; //<S2SV> wiki_redirect ( res , buf ) ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> 