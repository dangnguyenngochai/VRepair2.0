char * //<S2SV> logger_get_mask_expanded ( struct t_gui_buffer * buffer , const char * mask ) //<S2SV> { //<S2SV> char * mask2 , * mask_decoded , * mask_decoded2 , * mask_decoded3 , * mask_decoded4 ; //<S2SV> char * mask_decoded5 ; //<S2SV> const char * dir_separator ; //<S2SV> int length ; //<S2SV> time_t seconds ; //<S2SV> struct tm * date_tmp ; //<S2SV> mask2 = NULL ; //<S2SV> mask_decoded = NULL ; //<S2SV> mask_decoded2 = NULL ; //<S2SV> mask_decoded3 = NULL ; //<S2SV> mask_decoded4 = NULL ; //<S2SV> mask_decoded5 = NULL ; //<S2SV> dir_separator = weechat_info_get ( "dir_separator" , "" ) ; //<S2SV> if ( ! dir_separator ) //<S2SV> return NULL ; //<S2SV> mask2 = weechat_string_replace ( mask , dir_separator , "\\01" ) ; //<S2SV> if ( ! mask2 ) //<S2SV> goto end ; //<S2SV> mask_decoded = weechat_buffer_string_replace_local_var ( buffer , mask2 ) ; //<S2SV> if ( ! mask_decoded ) //<S2SV> goto end ; //<S2SV> mask_decoded2 = weechat_string_replace ( mask_decoded , //<S2SV> dir_separator , //<S2SV> weechat_config_string ( logger_config_file_replacement_char ) ) ; //<S2SV> if ( ! mask_decoded2 ) //<S2SV> goto end ; //<S2SV> # ifdef __CYGWIN__ //<S2SV> mask_decoded3 = weechat_string_replace ( mask_decoded2 , "\\\\" , //<S2SV> weechat_config_string ( logger_config_file_replacement_char ) ) ; //<S2SV> # else //<S2SV> mask_decoded3 = strdup ( mask_decoded2 ) ; //<S2SV> # endif //<S2SV> if ( ! mask_decoded3 ) //<S2SV> goto end ; //<S2SV> mask_decoded4 = weechat_string_replace ( mask_decoded3 , //<S2SV> "\\01" , dir_separator ) ; //<S2SV> if ( ! mask_decoded4 ) //<S2SV> goto end ; //<S2SV> length = strlen ( mask_decoded4 ) + 256 + 1 ; //<S2SV> mask_decoded5 = malloc ( length ) ; //<S2SV> if ( ! mask_decoded5 ) //<S2SV> goto end ; //<S2SV> seconds = time ( NULL ) ; //<S2SV> date_tmp = localtime ( & seconds ) ; //<S2SV> mask_decoded5 [ 0 ] = '\\0' ; //<S2SV> strftime ( mask_decoded5 , length - 1 , mask_decoded4 , date_tmp ) ; //<S2SV> if ( weechat_config_boolean ( logger_config_file_name_lower_case ) ) //<S2SV> weechat_string_tolower ( mask_decoded5 ) ; //<S2SV> if ( weechat_logger_plugin -> debug ) //<S2SV> { //<S2SV> weechat_printf_date_tags ( NULL , 0 , "no_log" , //<S2SV> "%s:<S2SV_blank>buffer<S2SV_blank>=<S2SV_blank>\\"%s\\",<S2SV_blank>mask<S2SV_blank>=<S2SV_blank>\\"%s\\",<S2SV_blank>" //<S2SV> "decoded<S2SV_blank>mask<S2SV_blank>=<S2SV_blank>\\"%s\\"" , //<S2SV> LOGGER_PLUGIN_NAME , //<S2SV> weechat_buffer_get_string ( buffer , "name" ) , //<S2SV> mask , mask_decoded5 ) ; //<S2SV> } //<S2SV> end : //<S2SV> if ( mask2 ) //<S2SV> free ( mask2 ) ; //<S2SV> if ( mask_decoded ) //<S2SV> free ( mask_decoded ) ; //<S2SV> if ( mask_decoded2 ) //<S2SV> free ( mask_decoded2 ) ; //<S2SV> if ( mask_decoded3 ) //<S2SV> free ( mask_decoded3 ) ; //<S2SV> if ( mask_decoded4 ) //<S2SV> free ( mask_decoded4 ) ; //<S2SV> return mask_decoded5 ; //<S2SV> } //<S2SV> 