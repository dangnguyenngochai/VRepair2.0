char * //<S2SV> logger_get_mask_expanded ( struct t_gui_buffer * buffer , const char * mask ) //<S2SV> { //<S2SV> char * mask2 , * mask3 , * mask4 , * mask5 , * mask6 , * mask7 ; //<S2SV> const char * dir_separator ; //<S2SV> int length ; //<S2SV> time_t seconds ; //<S2SV> struct tm * date_tmp ; //<S2SV> mask2 = NULL ; //<S2SV> mask3 = NULL ; //<S2SV> mask4 = NULL ; //<S2SV> mask5 = NULL ; //<S2SV> mask6 = NULL ; //<S2SV> mask7 = NULL ; //<S2SV> dir_separator = weechat_info_get ( "dir_separator" , "" ) ; //<S2SV> if ( ! dir_separator ) //<S2SV> return NULL ; //<S2SV> length = strlen ( mask ) + 256 + 1 ; //<S2SV> mask2 = malloc ( length ) ; //<S2SV> if ( ! mask2 ) //<S2SV> goto end ; //<S2SV> seconds = time ( NULL ) ; //<S2SV> date_tmp = localtime ( & seconds ) ; //<S2SV> mask2 [ 0 ] = '\\0' ; //<S2SV> if ( strftime ( mask2 , length - 1 , mask , date_tmp ) == 0 ) //<S2SV> mask2 [ 0 ] = '\\0' ; //<S2SV> mask3 = weechat_string_replace ( mask2 , dir_separator , "\\01" ) ; //<S2SV> if ( ! mask3 ) //<S2SV> goto end ; //<S2SV> mask4 = weechat_buffer_string_replace_local_var ( buffer , mask3 ) ; //<S2SV> if ( ! mask4 ) //<S2SV> goto end ; //<S2SV> mask5 = weechat_string_replace ( mask4 , //<S2SV> dir_separator , //<S2SV> weechat_config_string ( logger_config_file_replacement_char ) ) ; //<S2SV> if ( ! mask5 ) //<S2SV> goto end ; //<S2SV> # ifdef __CYGWIN__ //<S2SV> mask6 = weechat_string_replace ( mask5 , "\\\\" , //<S2SV> weechat_config_string ( logger_config_file_replacement_char ) ) ; //<S2SV> # else //<S2SV> mask6 = strdup ( mask5 ) ; //<S2SV> # endif //<S2SV> if ( ! mask6 ) //<S2SV> goto end ; //<S2SV> mask7 = weechat_string_replace ( mask6 , //<S2SV> "\\01" , dir_separator ) ; //<S2SV> if ( ! mask7 ) //<S2SV> goto end ; //<S2SV> if ( weechat_config_boolean ( logger_config_file_name_lower_case ) ) //<S2SV> weechat_string_tolower ( mask7 ) ; //<S2SV> if ( weechat_logger_plugin -> debug ) //<S2SV> { //<S2SV> weechat_printf_date_tags ( NULL , 0 , "no_log" , //<S2SV> "%s:<S2SV_blank>buffer<S2SV_blank>=<S2SV_blank>\\"%s\\",<S2SV_blank>mask<S2SV_blank>=<S2SV_blank>\\"%s\\",<S2SV_blank>" //<S2SV> "decoded<S2SV_blank>mask<S2SV_blank>=<S2SV_blank>\\"%s\\"" , //<S2SV> LOGGER_PLUGIN_NAME , //<S2SV> weechat_buffer_get_string ( buffer , "name" ) , //<S2SV> mask , mask7 ) ; //<S2SV> } //<S2SV> end : //<S2SV> if ( mask2 ) //<S2SV> free ( mask2 ) ; //<S2SV> if ( mask3 ) //<S2SV> free ( mask3 ) ; //<S2SV> if ( mask4 ) //<S2SV> free ( mask4 ) ; //<S2SV> if ( mask5 ) //<S2SV> free ( mask5 ) ; //<S2SV> if ( mask6 ) //<S2SV> free ( mask6 ) ; //<S2SV> return mask7 ; //<S2SV> } //<S2SV> 