void mp_encode_lua_table_as_map ( lua_State * L , mp_buf * buf , int level ) { //<S2SV> size_t len = 0 ; //<S2SV> luaL_checkstack ( L , 3 , "in<S2SV_blank>function<S2SV_blank>mp_encode_lua_table_as_map" ) ; //<S2SV> lua_pushnil ( L ) ; //<S2SV> while ( lua_next ( L , - 2 ) ) { //<S2SV> lua_pop ( L , 1 ) ; //<S2SV> len ++ ; //<S2SV> } //<S2SV> mp_encode_map ( L , buf , len ) ; //<S2SV> lua_pushnil ( L ) ; //<S2SV> while ( lua_next ( L , - 2 ) ) { //<S2SV> lua_pushvalue ( L , - 2 ) ; //<S2SV> mp_encode_lua_type ( L , buf , level + 1 ) ; //<S2SV> mp_encode_lua_type ( L , buf , level + 1 ) ; //<S2SV> } //<S2SV> } //<S2SV> 