void //<S2SV> receive_carbon ( void * * state ) //<S2SV> { //<S2SV> prof_input ( "/carbons<S2SV_blank>on" ) ; //<S2SV> prof_connect ( ) ; //<S2SV> assert_true ( stbbr_received ( //<S2SV> "<iq<S2SV_blank>id=\'*\'<S2SV_blank>type=\'set\'><enable<S2SV_blank>xmlns=\'urn:xmpp:carbons:2\'/></iq>" //<S2SV> ) ) ; //<S2SV> stbbr_send ( //<S2SV> "<presence<S2SV_blank>to=\'stabber@localhost\'<S2SV_blank>from=\'buddy1@localhost/mobile\'>" //<S2SV> "<priority>10</priority>" //<S2SV> "<status>On<S2SV_blank>my<S2SV_blank>mobile</status>" //<S2SV> "</presence>" //<S2SV> ) ; //<S2SV> assert_true ( prof_output_exact ( "Buddy1<S2SV_blank>(mobile)<S2SV_blank>is<S2SV_blank>online,<S2SV_blank>\\"On<S2SV_blank>my<S2SV_blank>mobile\\"" ) ) ; //<S2SV> prof_input ( "/msg<S2SV_blank>Buddy1" ) ; //<S2SV> assert_true ( prof_output_exact ( "unencrypted" ) ) ; //<S2SV> stbbr_send ( //<S2SV> "<message<S2SV_blank>type=\'chat\'<S2SV_blank>to=\'stabber@localhost/profanity\'<S2SV_blank>from=\'buddy1@localhost\'>" //<S2SV> "<received<S2SV_blank>xmlns=\'urn:xmpp:carbons:2\'>" //<S2SV> "<forwarded<S2SV_blank>xmlns=\'urn:xmpp:forward:0\'>" //<S2SV> "<message<S2SV_blank>id=\'prof_msg_7\'<S2SV_blank>xmlns=\'jabber:client\'<S2SV_blank>type=\'chat\'<S2SV_blank>lang=\'en\'<S2SV_blank>to=\'stabber@localhost/profanity\'<S2SV_blank>from=\'buddy1@localhost/mobile\'>" //<S2SV> "<body>test<S2SV_blank>carbon<S2SV_blank>from<S2SV_blank>recipient</body>" //<S2SV> "</message>" //<S2SV> "</forwarded>" //<S2SV> "</received>" //<S2SV> "</message>" //<S2SV> ) ; //<S2SV> assert_true ( prof_output_regex ( "Buddy1/mobile:<S2SV_blank>.+test<S2SV_blank>carbon<S2SV_blank>from<S2SV_blank>recipient" ) ) ; //<S2SV> } //<S2SV> 