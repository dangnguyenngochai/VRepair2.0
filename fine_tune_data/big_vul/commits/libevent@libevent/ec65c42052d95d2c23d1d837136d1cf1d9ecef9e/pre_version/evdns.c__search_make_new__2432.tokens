static char * //<S2SV> search_make_new ( const struct search_state * const state , int n , const char * const base_name ) { //<S2SV> const size_t base_len = strlen ( base_name ) ; //<S2SV> const char need_to_append_dot = base_name [ base_len - 1 ] == '.' ? 0 : 1 ; //<S2SV> struct search_domain * dom ; //<S2SV> for ( dom = state -> head ; dom ; dom = dom -> next ) { //<S2SV> if ( ! n -- ) { //<S2SV> const u8 * const postfix = ( ( u8 * ) dom ) + sizeof ( struct search_domain ) ; //<S2SV> const int postfix_len = dom -> len ; //<S2SV> char * const newname = ( char * ) mm_malloc ( base_len + need_to_append_dot + postfix_len + 1 ) ; //<S2SV> if ( ! newname ) return NULL ; //<S2SV> memcpy ( newname , base_name , base_len ) ; //<S2SV> if ( need_to_append_dot ) newname [ base_len ] = '.' ; //<S2SV> memcpy ( newname + base_len + need_to_append_dot , postfix , postfix_len ) ; //<S2SV> newname [ base_len + need_to_append_dot + postfix_len ] = 0 ; //<S2SV> return newname ; //<S2SV> } //<S2SV> } //<S2SV> EVUTIL_ASSERT ( 0 ) ; //<S2SV> return NULL ; //<S2SV> } //<S2SV> 