static void update_logging ( ) { //<S2SV> bool should_log = module_started && //<S2SV> ( logging_enabled_via_api || stack_config -> get_btsnoop_turned_on ( ) ) ; //<S2SV> if ( should_log == is_logging ) //<S2SV> return ; //<S2SV> is_logging = should_log ; //<S2SV> if ( should_log ) { //<S2SV> btsnoop_net_open ( ) ; //<S2SV> const char * log_path = stack_config -> get_btsnoop_log_path ( ) ; //<S2SV> if ( stack_config -> get_btsnoop_should_save_last ( ) ) { //<S2SV> char last_log_path [ PATH_MAX ] ; //<S2SV> snprintf ( last_log_path , PATH_MAX , "%s.%llu" , log_path , btsnoop_timestamp ( ) ) ; //<S2SV> if ( ! rename ( log_path , last_log_path ) && errno != ENOENT ) //<S2SV> LOG_ERROR ( "%s<S2SV_blank>unable<S2SV_blank>to<S2SV_blank>rename<S2SV_blank>\'%s\'<S2SV_blank>to<S2SV_blank>\'%s\':<S2SV_blank>%s" , __func__ , log_path , last_log_path , strerror ( errno ) ) ; //<S2SV> } //<S2SV> logfile_fd = open ( log_path , O_WRONLY | O_CREAT | O_TRUNC , S_IRUSR | S_IWUSR | S_IRGRP | S_IWGRP | S_IROTH ) ; //<S2SV> if ( logfile_fd == INVALID_FD ) { //<S2SV> LOG_ERROR ( "%s<S2SV_blank>unable<S2SV_blank>to<S2SV_blank>open<S2SV_blank>\'%s\':<S2SV_blank>%s" , __func__ , log_path , strerror ( errno ) ) ; //<S2SV> is_logging = false ; //<S2SV> return ; //<S2SV> } //<S2SV> write ( logfile_fd , "btsnoop\\0\\0\\0\\0\\1\\0\\0\\x3\\xea" , 16 ) ; //<S2SV> } else { //<S2SV> if ( logfile_fd != INVALID_FD ) //<S2SV> close ( logfile_fd ) ; //<S2SV> logfile_fd = INVALID_FD ; //<S2SV> btsnoop_net_close ( ) ; //<S2SV> } //<S2SV> } //<S2SV> 