static bool write_hci_command ( hci_packet_t type , const void * packet , size_t length ) { //<S2SV> int sock = socket ( AF_INET , SOCK_STREAM , IPPROTO_TCP ) ; //<S2SV> if ( sock == INVALID_FD ) //<S2SV> goto error ; //<S2SV> struct sockaddr_in addr ; //<S2SV> addr . sin_family = AF_INET ; //<S2SV> addr . sin_addr . s_addr = htonl ( 0x7F000001 ) ; //<S2SV> addr . sin_port = htons ( 8873 ) ; //<S2SV> if ( TEMP_FAILURE_RETRY ( connect ( sock , ( const struct sockaddr * ) & addr , sizeof ( addr ) ) ) == - 1 ) //<S2SV> goto error ; //<S2SV> if ( TEMP_FAILURE_RETRY ( send ( sock , & type , 1 , 0 ) ) != 1 ) //<S2SV> goto error ; //<S2SV> if ( TEMP_FAILURE_RETRY ( send ( sock , & length , 2 , 0 ) ) != 2 ) //<S2SV> goto error ; //<S2SV> if ( TEMP_FAILURE_RETRY ( send ( sock , packet , length , 0 ) ) != ( ssize_t ) length ) //<S2SV> goto error ; //<S2SV> close ( sock ) ; //<S2SV> return true ; //<S2SV> error : ; //<S2SV> close ( sock ) ; //<S2SV> return false ; //<S2SV> } //<S2SV> 