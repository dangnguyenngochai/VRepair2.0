static int store_asoundrc ( void ) { //<S2SV> fs_build_mnt_dir ( ) ; //<S2SV> char * src ; //<S2SV> char * dest = RUN_ASOUNDRC_FILE ; //<S2SV> FILE * fp = fopen ( dest , "w" ) ; //<S2SV> if ( fp ) { //<S2SV> fprintf ( fp , "\\n" ) ; //<S2SV> SET_PERMS_STREAM ( fp , getuid ( ) , getgid ( ) , 0644 ) ; //<S2SV> fclose ( fp ) ; //<S2SV> } //<S2SV> if ( asprintf ( & src , "%s/.asoundrc" , cfg . homedir ) == - 1 ) //<S2SV> errExit ( "asprintf" ) ; //<S2SV> struct stat s ; //<S2SV> if ( stat ( src , & s ) == 0 ) { //<S2SV> if ( is_link ( src ) ) { //<S2SV> char * rp = realpath ( src , NULL ) ; //<S2SV> if ( ! rp ) { //<S2SV> fprintf ( stderr , "Error:<S2SV_blank>Cannot<S2SV_blank>access<S2SV_blank>%s\\n" , src ) ; //<S2SV> exit ( 1 ) ; //<S2SV> } //<S2SV> if ( strncmp ( rp , cfg . homedir , strlen ( cfg . homedir ) ) != 0 ) { //<S2SV> fprintf ( stderr , "Error:<S2SV_blank>.asoundrc<S2SV_blank>is<S2SV_blank>a<S2SV_blank>symbolic<S2SV_blank>link<S2SV_blank>pointing<S2SV_blank>to<S2SV_blank>a<S2SV_blank>file<S2SV_blank>outside<S2SV_blank>home<S2SV_blank>directory\\n" ) ; //<S2SV> exit ( 1 ) ; //<S2SV> } //<S2SV> free ( rp ) ; //<S2SV> } //<S2SV> copy_file_as_user ( src , dest , getuid ( ) , getgid ( ) , 0644 ) ; //<S2SV> fs_logger2 ( "clone" , dest ) ; //<S2SV> return 1 ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 