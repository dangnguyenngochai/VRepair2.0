static int store_xauthority ( void ) { //<S2SV> fs_build_mnt_dir ( ) ; //<S2SV> char * src ; //<S2SV> char * dest = RUN_XAUTHORITY_FILE ; //<S2SV> FILE * fp = fopen ( dest , "w" ) ; //<S2SV> if ( fp ) { //<S2SV> fprintf ( fp , "\\n" ) ; //<S2SV> SET_PERMS_STREAM ( fp , getuid ( ) , getgid ( ) , 0600 ) ; //<S2SV> fclose ( fp ) ; //<S2SV> } //<S2SV> if ( asprintf ( & src , "%s/.Xauthority" , cfg . homedir ) == - 1 ) //<S2SV> errExit ( "asprintf" ) ; //<S2SV> struct stat s ; //<S2SV> if ( stat ( src , & s ) == 0 ) { //<S2SV> if ( is_link ( src ) ) { //<S2SV> fprintf ( stderr , "Warning:<S2SV_blank>invalid<S2SV_blank>.Xauthority<S2SV_blank>file\\n" ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> pid_t child = fork ( ) ; //<S2SV> if ( child < 0 ) //<S2SV> errExit ( "fork" ) ; //<S2SV> if ( child == 0 ) { //<S2SV> drop_privs ( 0 ) ; //<S2SV> int rv = copy_file ( src , dest , getuid ( ) , getgid ( ) , 0600 ) ; //<S2SV> if ( rv ) //<S2SV> fprintf ( stderr , "Warning:<S2SV_blank>cannot<S2SV_blank>transfer<S2SV_blank>.Xauthority<S2SV_blank>in<S2SV_blank>private<S2SV_blank>home<S2SV_blank>directory\\n" ) ; //<S2SV> else { //<S2SV> fs_logger2 ( "clone" , dest ) ; //<S2SV> } //<S2SV> _exit ( 0 ) ; //<S2SV> } //<S2SV> waitpid ( child , NULL , 0 ) ; //<S2SV> return 1 ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 