static int //<S2SV> int_x509_param_set_hosts ( X509_VERIFY_PARAM_ID * id , int mode , //<S2SV> const char * name , size_t namelen ) //<S2SV> { //<S2SV> char * copy ; //<S2SV> if ( name && memchr ( name , '\\0' , namelen ) ) //<S2SV> return 0 ; //<S2SV> if ( mode == SET_HOST && id -> hosts ) { //<S2SV> string_stack_free ( id -> hosts ) ; //<S2SV> id -> hosts = NULL ; //<S2SV> } //<S2SV> if ( name == NULL || namelen == 0 ) //<S2SV> return 1 ; //<S2SV> copy = strndup ( name , namelen ) ; //<S2SV> if ( copy == NULL ) //<S2SV> return 0 ; //<S2SV> if ( id -> hosts == NULL && //<S2SV> ( id -> hosts = sk_OPENSSL_STRING_new_null ( ) ) == NULL ) { //<S2SV> free ( copy ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> if ( ! sk_OPENSSL_STRING_push ( id -> hosts , copy ) ) { //<S2SV> free ( copy ) ; //<S2SV> if ( sk_OPENSSL_STRING_num ( id -> hosts ) == 0 ) { //<S2SV> sk_OPENSSL_STRING_free ( id -> hosts ) ; //<S2SV> id -> hosts = NULL ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> return 1 ; //<S2SV> } //<S2SV> 