static const u_char * //<S2SV> ikev1_attrmap_print ( netdissect_options * ndo , //<S2SV> const u_char * p , const u_char * ep2 , //<S2SV> const struct attrmap * map , size_t nmap ) //<S2SV> { //<S2SV> int totlen ; //<S2SV> uint32_t t , v ; //<S2SV> ND_TCHECK ( p [ 0 ] ) ; //<S2SV> if ( p [ 0 ] & 0x80 ) //<S2SV> totlen = 4 ; //<S2SV> else { //<S2SV> ND_TCHECK_16BITS ( & p [ 2 ] ) ; //<S2SV> totlen = 4 + EXTRACT_16BITS ( & p [ 2 ] ) ; //<S2SV> } //<S2SV> if ( ep2 < p + totlen ) { //<S2SV> ND_PRINT ( ( ndo , "[|attr]" ) ) ; //<S2SV> return ep2 + 1 ; //<S2SV> } //<S2SV> ND_TCHECK_16BITS ( & p [ 0 ] ) ; //<S2SV> ND_PRINT ( ( ndo , "(" ) ) ; //<S2SV> t = EXTRACT_16BITS ( & p [ 0 ] ) & 0x7fff ; //<S2SV> if ( map && t < nmap && map [ t ] . type ) //<S2SV> ND_PRINT ( ( ndo , "type=%s<S2SV_blank>" , map [ t ] . type ) ) ; //<S2SV> else //<S2SV> ND_PRINT ( ( ndo , "type=#%d<S2SV_blank>" , t ) ) ; //<S2SV> if ( p [ 0 ] & 0x80 ) { //<S2SV> ND_PRINT ( ( ndo , "value=" ) ) ; //<S2SV> ND_TCHECK_16BITS ( & p [ 2 ] ) ; //<S2SV> v = EXTRACT_16BITS ( & p [ 2 ] ) ; //<S2SV> if ( map && t < nmap && v < map [ t ] . nvalue && map [ t ] . value [ v ] ) //<S2SV> ND_PRINT ( ( ndo , "%s" , map [ t ] . value [ v ] ) ) ; //<S2SV> else { //<S2SV> if ( ! rawprint ( ndo , ( const uint8_t * ) & p [ 2 ] , 2 ) ) { //<S2SV> ND_PRINT ( ( ndo , ")" ) ) ; //<S2SV> goto trunc ; //<S2SV> } //<S2SV> } //<S2SV> } else { //<S2SV> ND_PRINT ( ( ndo , "len=%d<S2SV_blank>value=" , totlen - 4 ) ) ; //<S2SV> if ( ! rawprint ( ndo , ( const uint8_t * ) & p [ 4 ] , totlen - 4 ) ) { //<S2SV> ND_PRINT ( ( ndo , ")" ) ) ; //<S2SV> goto trunc ; //<S2SV> } //<S2SV> } //<S2SV> ND_PRINT ( ( ndo , ")" ) ) ; //<S2SV> return p + totlen ; //<S2SV> trunc : //<S2SV> return NULL ; //<S2SV> } //<S2SV> 