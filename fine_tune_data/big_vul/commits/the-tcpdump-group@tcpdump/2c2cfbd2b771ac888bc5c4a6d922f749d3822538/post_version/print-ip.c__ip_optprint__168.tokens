static void //<S2SV> ip_optprint ( netdissect_options * ndo , //<S2SV> register const u_char * cp , u_int length ) //<S2SV> { //<S2SV> register u_int option_len ; //<S2SV> const char * sep = "" ; //<S2SV> for ( ; length > 0 ; cp += option_len , length -= option_len ) { //<S2SV> u_int option_code ; //<S2SV> ND_PRINT ( ( ndo , "%s" , sep ) ) ; //<S2SV> sep = "," ; //<S2SV> ND_TCHECK ( * cp ) ; //<S2SV> option_code = * cp ; //<S2SV> ND_PRINT ( ( ndo , "%s" , //<S2SV> tok2str ( ip_option_values , "unknown<S2SV_blank>%u" , option_code ) ) ) ; //<S2SV> if ( option_code == IPOPT_NOP || //<S2SV> option_code == IPOPT_EOL ) //<S2SV> option_len = 1 ; //<S2SV> else { //<S2SV> ND_TCHECK ( cp [ 1 ] ) ; //<S2SV> option_len = cp [ 1 ] ; //<S2SV> if ( option_len < 2 ) { //<S2SV> ND_PRINT ( ( ndo , "<S2SV_blank>[bad<S2SV_blank>length<S2SV_blank>%u]" , option_len ) ) ; //<S2SV> return ; //<S2SV> } //<S2SV> } //<S2SV> if ( option_len > length ) { //<S2SV> ND_PRINT ( ( ndo , "<S2SV_blank>[bad<S2SV_blank>length<S2SV_blank>%u]" , option_len ) ) ; //<S2SV> return ; //<S2SV> } //<S2SV> ND_TCHECK2 ( * cp , option_len ) ; //<S2SV> switch ( option_code ) { //<S2SV> case IPOPT_EOL : //<S2SV> return ; //<S2SV> case IPOPT_TS : //<S2SV> if ( ip_printts ( ndo , cp , option_len ) == - 1 ) //<S2SV> goto trunc ; //<S2SV> break ; //<S2SV> case IPOPT_RR : //<S2SV> case IPOPT_SSRR : //<S2SV> case IPOPT_LSRR : //<S2SV> if ( ip_printroute ( ndo , cp , option_len ) == - 1 ) //<S2SV> goto trunc ; //<S2SV> break ; //<S2SV> case IPOPT_RA : //<S2SV> if ( option_len < 4 ) { //<S2SV> ND_PRINT ( ( ndo , "<S2SV_blank>[bad<S2SV_blank>length<S2SV_blank>%u]" , option_len ) ) ; //<S2SV> break ; //<S2SV> } //<S2SV> ND_TCHECK ( cp [ 3 ] ) ; //<S2SV> if ( EXTRACT_16BITS ( & cp [ 2 ] ) != 0 ) //<S2SV> ND_PRINT ( ( ndo , "<S2SV_blank>value<S2SV_blank>%u" , EXTRACT_16BITS ( & cp [ 2 ] ) ) ) ; //<S2SV> break ; //<S2SV> case IPOPT_NOP : //<S2SV> case IPOPT_SECURITY : //<S2SV> default : //<S2SV> break ; //<S2SV> } //<S2SV> } //<S2SV> return ; //<S2SV> trunc : //<S2SV> ND_PRINT ( ( ndo , "%s" , tstr ) ) ; //<S2SV> } //<S2SV> 