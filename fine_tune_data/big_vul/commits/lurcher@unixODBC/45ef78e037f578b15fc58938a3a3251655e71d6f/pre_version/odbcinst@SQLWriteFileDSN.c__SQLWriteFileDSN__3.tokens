BOOL SQLWriteFileDSN ( LPCSTR pszFileName , //<S2SV> LPCSTR pszAppName , //<S2SV> LPCSTR pszKeyName , //<S2SV> LPCSTR pszString ) //<S2SV> { //<S2SV> HINI hIni ; //<S2SV> char szFileName [ ODBC_FILENAME_MAX + 1 ] ; //<S2SV> if ( pszFileName [ 0 ] == '/' ) //<S2SV> { //<S2SV> strncpy ( szFileName , sizeof ( szFileName ) - 5 , pszFileName ) ; //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> char szPath [ ODBC_FILENAME_MAX + 1 ] ; //<S2SV> * szPath = '\\0' ; //<S2SV> _odbcinst_FileINI ( szPath ) ; //<S2SV> snprintf ( szFileName , sizeof ( szFileName ) - 5 , "%s/%s" , szPath , pszFileName ) ; //<S2SV> } //<S2SV> if ( strlen ( szFileName ) < 4 || strcmp ( szFileName + strlen ( szFileName ) - 4 , ".dsn" ) ) //<S2SV> { //<S2SV> strcat ( szFileName , ".dsn" ) ; //<S2SV> } //<S2SV> # ifdef __OS2__ //<S2SV> if ( iniOpen ( & hIni , szFileName , "#;" , '[' , ']' , '=' , TRUE , 0L ) != INI_SUCCESS ) //<S2SV> # else //<S2SV> if ( iniOpen ( & hIni , szFileName , "#;" , '[' , ']' , '=' , TRUE ) != INI_SUCCESS ) //<S2SV> # endif //<S2SV> { //<S2SV> inst_logPushMsg ( __FILE__ , __FILE__ , __LINE__ , LOG_CRITICAL , ODBC_ERROR_INVALID_PATH , "" ) ; //<S2SV> return FALSE ; //<S2SV> } //<S2SV> if ( pszString == NULL && pszKeyName == NULL ) //<S2SV> { //<S2SV> if ( iniObjectSeek ( hIni , ( char * ) pszAppName ) == INI_SUCCESS ) //<S2SV> { //<S2SV> iniObjectDelete ( hIni ) ; //<S2SV> } //<S2SV> } //<S2SV> else if ( pszString == NULL ) //<S2SV> { //<S2SV> if ( iniPropertySeek ( hIni , ( char * ) pszAppName , ( char * ) pszKeyName , "" ) == INI_SUCCESS ) //<S2SV> { //<S2SV> iniPropertyDelete ( hIni ) ; //<S2SV> } //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> if ( iniObjectSeek ( hIni , ( char * ) pszAppName ) != INI_SUCCESS ) //<S2SV> { //<S2SV> iniObjectInsert ( hIni , ( char * ) pszAppName ) ; //<S2SV> } //<S2SV> if ( iniPropertySeek ( hIni , ( char * ) pszAppName , ( char * ) pszKeyName , "" ) == INI_SUCCESS ) //<S2SV> { //<S2SV> iniObjectSeek ( hIni , ( char * ) pszAppName ) ; //<S2SV> iniPropertyUpdate ( hIni , ( char * ) pszKeyName , ( char * ) pszString ) ; //<S2SV> } //<S2SV> else //<S2SV> { //<S2SV> iniObjectSeek ( hIni , ( char * ) pszAppName ) ; //<S2SV> iniPropertyInsert ( hIni , ( char * ) pszKeyName , ( char * ) pszString ) ; //<S2SV> } //<S2SV> } //<S2SV> if ( iniCommit ( hIni ) != INI_SUCCESS ) //<S2SV> { //<S2SV> iniClose ( hIni ) ; //<S2SV> inst_logPushMsg ( __FILE__ , __FILE__ , __LINE__ , LOG_CRITICAL , ODBC_ERROR_REQUEST_FAILED , "" ) ; //<S2SV> return FALSE ; //<S2SV> } //<S2SV> iniClose ( hIni ) ; //<S2SV> return TRUE ; //<S2SV> } //<S2SV> 