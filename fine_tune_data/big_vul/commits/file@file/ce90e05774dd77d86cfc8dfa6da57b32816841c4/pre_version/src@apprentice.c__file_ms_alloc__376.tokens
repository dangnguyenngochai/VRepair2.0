protected struct magic_set * //<S2SV> file_ms_alloc ( int flags ) //<S2SV> { //<S2SV> struct magic_set * ms ; //<S2SV> size_t i , len ; //<S2SV> if ( ( ms = CAST ( struct magic_set * , calloc ( ( size_t ) 1 , //<S2SV> sizeof ( struct magic_set ) ) ) ) == NULL ) //<S2SV> return NULL ; //<S2SV> if ( magic_setflags ( ms , flags ) == - 1 ) { //<S2SV> errno = EINVAL ; //<S2SV> goto free ; //<S2SV> } //<S2SV> ms -> o . buf = ms -> o . pbuf = NULL ; //<S2SV> len = ( ms -> c . len = 10 ) * sizeof ( * ms -> c . li ) ; //<S2SV> if ( ( ms -> c . li = CAST ( struct level_info * , malloc ( len ) ) ) == NULL ) //<S2SV> goto free ; //<S2SV> ms -> event_flags = 0 ; //<S2SV> ms -> error = - 1 ; //<S2SV> for ( i = 0 ; i < MAGIC_SETS ; i ++ ) //<S2SV> ms -> mlist [ i ] = NULL ; //<S2SV> ms -> file = "unknown" ; //<S2SV> ms -> line = 0 ; //<S2SV> ms -> indir_max = FILE_INDIR_MAX ; //<S2SV> ms -> name_max = FILE_NAME_MAX ; //<S2SV> ms -> elf_shnum_max = FILE_ELF_SHNUM_MAX ; //<S2SV> ms -> elf_phnum_max = FILE_ELF_PHNUM_MAX ; //<S2SV> return ms ; //<S2SV> free : //<S2SV> free ( ms ) ; //<S2SV> return NULL ; //<S2SV> } //<S2SV> 