static uint32_t scsi_init_iovec ( SCSIDiskReq * r ) //<S2SV> { //<S2SV> SCSIDiskState * s = DO_UPCAST ( SCSIDiskState , qdev , r -> req . dev ) ; //<S2SV> if ( ! r -> iov . iov_base ) { //<S2SV> r -> buflen = SCSI_DMA_BUF_SIZE ; //<S2SV> r -> iov . iov_base = qemu_blockalign ( s -> bs , r -> buflen ) ; //<S2SV> } //<S2SV> r -> iov . iov_len = MIN ( r -> sector_count * 512 , r -> buflen ) ; //<S2SV> qemu_iovec_init_external ( & r -> qiov , & r -> iov , 1 ) ; //<S2SV> return r -> qiov . size / 512 ; //<S2SV> } //<S2SV> 