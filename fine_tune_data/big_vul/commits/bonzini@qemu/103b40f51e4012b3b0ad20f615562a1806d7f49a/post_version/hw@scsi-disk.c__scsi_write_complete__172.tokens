static void scsi_write_complete ( void * opaque , int ret ) //<S2SV> { //<S2SV> SCSIDiskReq * r = ( SCSIDiskReq * ) opaque ; //<S2SV> SCSIDiskState * s = DO_UPCAST ( SCSIDiskState , qdev , r -> req . dev ) ; //<S2SV> uint32_t n ; //<S2SV> if ( r -> req . aiocb != NULL ) { //<S2SV> r -> req . aiocb = NULL ; //<S2SV> bdrv_acct_done ( s -> bs , & r -> acct ) ; //<S2SV> } //<S2SV> if ( ret ) { //<S2SV> if ( scsi_handle_rw_error ( r , - ret , SCSI_REQ_STATUS_RETRY_WRITE ) ) { //<S2SV> return ; //<S2SV> } //<S2SV> } //<S2SV> n = r -> qiov . size / 512 ; //<S2SV> r -> sector += n ; //<S2SV> r -> sector_count -= n ; //<S2SV> if ( r -> sector_count == 0 ) { //<S2SV> scsi_req_complete ( & r -> req , GOOD ) ; //<S2SV> } else { //<S2SV> scsi_init_iovec ( r ) ; //<S2SV> DPRINTF ( "Write<S2SV_blank>complete<S2SV_blank>tag=0x%x<S2SV_blank>more=%d\\n" , r -> req . tag , r -> qiov . size ) ; //<S2SV> scsi_req_data ( & r -> req , r -> qiov . size ) ; //<S2SV> } //<S2SV> } //<S2SV> 