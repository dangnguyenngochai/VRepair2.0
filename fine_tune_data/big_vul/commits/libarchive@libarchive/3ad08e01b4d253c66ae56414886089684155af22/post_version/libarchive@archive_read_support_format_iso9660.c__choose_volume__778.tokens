static int //<S2SV> choose_volume ( struct archive_read * a , struct iso9660 * iso9660 ) //<S2SV> { //<S2SV> struct file_info * file ; //<S2SV> int64_t skipsize ; //<S2SV> struct vd * vd ; //<S2SV> const void * block ; //<S2SV> char seenJoliet ; //<S2SV> vd = & ( iso9660 -> primary ) ; //<S2SV> if ( ! iso9660 -> opt_support_joliet ) //<S2SV> iso9660 -> seenJoliet = 0 ; //<S2SV> if ( iso9660 -> seenJoliet && //<S2SV> vd -> location > iso9660 -> joliet . location ) //<S2SV> vd = & ( iso9660 -> joliet ) ; //<S2SV> skipsize = LOGICAL_BLOCK_SIZE * ( int64_t ) vd -> location ; //<S2SV> skipsize = __archive_read_consume ( a , skipsize ) ; //<S2SV> if ( skipsize < 0 ) //<S2SV> return ( ( int ) skipsize ) ; //<S2SV> iso9660 -> current_position = skipsize ; //<S2SV> block = __archive_read_ahead ( a , vd -> size , NULL ) ; //<S2SV> if ( block == NULL ) { //<S2SV> archive_set_error ( & a -> archive , ARCHIVE_ERRNO_MISC , //<S2SV> "Failed<S2SV_blank>to<S2SV_blank>read<S2SV_blank>full<S2SV_blank>block<S2SV_blank>when<S2SV_blank>scanning<S2SV_blank>" //<S2SV> "ISO9660<S2SV_blank>directory<S2SV_blank>list" ) ; //<S2SV> return ( ARCHIVE_FATAL ) ; //<S2SV> } //<S2SV> seenJoliet = iso9660 -> seenJoliet ; //<S2SV> iso9660 -> seenJoliet = 0 ; //<S2SV> file = parse_file_info ( a , NULL , block ) ; //<S2SV> if ( file == NULL ) //<S2SV> return ( ARCHIVE_FATAL ) ; //<S2SV> iso9660 -> seenJoliet = seenJoliet ; //<S2SV> if ( vd == & ( iso9660 -> primary ) && iso9660 -> seenRockridge //<S2SV> && iso9660 -> seenJoliet ) //<S2SV> iso9660 -> seenJoliet = 0 ; //<S2SV> if ( vd == & ( iso9660 -> primary ) && ! iso9660 -> seenRockridge //<S2SV> && iso9660 -> seenJoliet ) { //<S2SV> vd = & ( iso9660 -> joliet ) ; //<S2SV> skipsize = LOGICAL_BLOCK_SIZE * ( int64_t ) vd -> location ; //<S2SV> skipsize -= iso9660 -> current_position ; //<S2SV> skipsize = __archive_read_consume ( a , skipsize ) ; //<S2SV> if ( skipsize < 0 ) //<S2SV> return ( ( int ) skipsize ) ; //<S2SV> iso9660 -> current_position += skipsize ; //<S2SV> block = __archive_read_ahead ( a , vd -> size , NULL ) ; //<S2SV> if ( block == NULL ) { //<S2SV> archive_set_error ( & a -> archive , ARCHIVE_ERRNO_MISC , //<S2SV> "Failed<S2SV_blank>to<S2SV_blank>read<S2SV_blank>full<S2SV_blank>block<S2SV_blank>when<S2SV_blank>scanning<S2SV_blank>" //<S2SV> "ISO9660<S2SV_blank>directory<S2SV_blank>list" ) ; //<S2SV> return ( ARCHIVE_FATAL ) ; //<S2SV> } //<S2SV> iso9660 -> seenJoliet = 0 ; //<S2SV> file = parse_file_info ( a , NULL , block ) ; //<S2SV> if ( file == NULL ) //<S2SV> return ( ARCHIVE_FATAL ) ; //<S2SV> iso9660 -> seenJoliet = seenJoliet ; //<S2SV> } //<S2SV> if ( add_entry ( a , iso9660 , file ) != ARCHIVE_OK ) //<S2SV> return ( ARCHIVE_FATAL ) ; //<S2SV> if ( iso9660 -> seenRockridge ) { //<S2SV> a -> archive . archive_format = ARCHIVE_FORMAT_ISO9660_ROCKRIDGE ; //<S2SV> a -> archive . archive_format_name = //<S2SV> "ISO9660<S2SV_blank>with<S2SV_blank>Rockridge<S2SV_blank>extensions" ; //<S2SV> } //<S2SV> return ( ARCHIVE_OK ) ; //<S2SV> } //<S2SV> 