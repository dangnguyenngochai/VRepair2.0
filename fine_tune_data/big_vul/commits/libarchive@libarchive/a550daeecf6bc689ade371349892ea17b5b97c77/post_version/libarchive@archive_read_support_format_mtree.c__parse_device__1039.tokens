static int //<S2SV> parse_device ( dev_t * pdev , struct archive * a , char * val ) //<S2SV> { //<S2SV> # define MAX_PACK_ARGS 3 //<S2SV> unsigned long numbers [ MAX_PACK_ARGS ] ; //<S2SV> char * p , * dev ; //<S2SV> int argc ; //<S2SV> pack_t * pack ; //<S2SV> dev_t result ; //<S2SV> const char * error = NULL ; //<S2SV> memset ( pdev , 0 , sizeof ( * pdev ) ) ; //<S2SV> if ( ( dev = strchr ( val , ',' ) ) != NULL ) { //<S2SV> * dev ++ = '\\0' ; //<S2SV> if ( ( pack = pack_find ( val ) ) == NULL ) { //<S2SV> archive_set_error ( a , ARCHIVE_ERRNO_FILE_FORMAT , //<S2SV> "Unknown<S2SV_blank>format<S2SV_blank>`%s\'" , val ) ; //<S2SV> return ARCHIVE_WARN ; //<S2SV> } //<S2SV> argc = 0 ; //<S2SV> while ( ( p = la_strsep ( & dev , "," ) ) != NULL ) { //<S2SV> if ( * p == '\\0' ) { //<S2SV> archive_set_error ( a , ARCHIVE_ERRNO_FILE_FORMAT , //<S2SV> "Missing<S2SV_blank>number" ) ; //<S2SV> return ARCHIVE_WARN ; //<S2SV> } //<S2SV> if ( argc >= MAX_PACK_ARGS ) { //<S2SV> archive_set_error ( a , ARCHIVE_ERRNO_FILE_FORMAT , //<S2SV> "Too<S2SV_blank>many<S2SV_blank>arguments" ) ; //<S2SV> return ARCHIVE_WARN ; //<S2SV> } //<S2SV> numbers [ argc ++ ] = ( unsigned long ) mtree_atol ( & p ) ; //<S2SV> } //<S2SV> if ( argc < 2 ) { //<S2SV> archive_set_error ( a , ARCHIVE_ERRNO_FILE_FORMAT , //<S2SV> "Not<S2SV_blank>enough<S2SV_blank>arguments" ) ; //<S2SV> return ARCHIVE_WARN ; //<S2SV> } //<S2SV> result = ( * pack ) ( argc , numbers , & error ) ; //<S2SV> if ( error != NULL ) { //<S2SV> archive_set_error ( a , ARCHIVE_ERRNO_FILE_FORMAT , //<S2SV> "%s" , error ) ; //<S2SV> return ARCHIVE_WARN ; //<S2SV> } //<S2SV> } else { //<S2SV> result = ( dev_t ) mtree_atol ( & val ) ; //<S2SV> } //<S2SV> * pdev = result ; //<S2SV> return ARCHIVE_OK ; //<S2SV> # undef MAX_PACK_ARGS //<S2SV> } //<S2SV> 