static int create_problem_dir ( GHashTable * problem_info , unsigned pid ) //<S2SV> { //<S2SV> if ( g_settings_nMaxCrashReportsSize > 0 ) //<S2SV> { //<S2SV> if ( low_free_space ( g_settings_nMaxCrashReportsSize , g_settings_dump_location ) ) //<S2SV> exit ( 1 ) ; //<S2SV> } //<S2SV> gchar * dir_basename = g_hash_table_lookup ( problem_info , "basename" ) ; //<S2SV> if ( ! dir_basename ) //<S2SV> dir_basename = g_hash_table_lookup ( problem_info , FILENAME_TYPE ) ; //<S2SV> char * path = xasprintf ( "%s/%s-%s-%u.new" , //<S2SV> g_settings_dump_location , //<S2SV> dir_basename , //<S2SV> iso_date_string ( NULL ) , //<S2SV> pid ) ; //<S2SV> g_hash_table_remove ( problem_info , "basename" ) ; //<S2SV> struct dump_dir * dd = dd_create ( path , client_uid , DEFAULT_DUMP_DIR_MODE ) ; //<S2SV> if ( ! dd ) //<S2SV> { //<S2SV> error_msg_and_die ( "Error<S2SV_blank>creating<S2SV_blank>problem<S2SV_blank>directory<S2SV_blank>\'%s\'" , path ) ; //<S2SV> } //<S2SV> dd_create_basic_files ( dd , client_uid , NULL ) ; //<S2SV> dd_save_text ( dd , FILENAME_ABRT_VERSION , VERSION ) ; //<S2SV> gpointer gpkey = g_hash_table_lookup ( problem_info , FILENAME_CMDLINE ) ; //<S2SV> if ( ! gpkey ) //<S2SV> { //<S2SV> char * cmdline = get_cmdline ( pid ) ; //<S2SV> if ( cmdline ) //<S2SV> { //<S2SV> dd_save_text ( dd , FILENAME_CMDLINE , cmdline ) ; //<S2SV> free ( cmdline ) ; //<S2SV> } //<S2SV> } //<S2SV> char uid_str [ sizeof ( long ) * 3 + 2 ] ; //<S2SV> sprintf ( uid_str , "%lu" , ( long ) client_uid ) ; //<S2SV> dd_save_text ( dd , FILENAME_UID , uid_str ) ; //<S2SV> GHashTableIter iter ; //<S2SV> gpointer gpvalue ; //<S2SV> g_hash_table_iter_init ( & iter , problem_info ) ; //<S2SV> while ( g_hash_table_iter_next ( & iter , & gpkey , & gpvalue ) ) //<S2SV> { //<S2SV> dd_save_text ( dd , ( gchar * ) gpkey , ( gchar * ) gpvalue ) ; //<S2SV> } //<S2SV> dd_close ( dd ) ; //<S2SV> g_hash_table_destroy ( problem_info ) ; //<S2SV> char * newpath = xstrndup ( path , strlen ( path ) - strlen ( ".new" ) ) ; //<S2SV> if ( rename ( path , newpath ) == 0 ) //<S2SV> strcpy ( path , newpath ) ; //<S2SV> free ( newpath ) ; //<S2SV> log_notice ( "Saved<S2SV_blank>problem<S2SV_blank>directory<S2SV_blank>of<S2SV_blank>pid<S2SV_blank>%u<S2SV_blank>to<S2SV_blank>\'%s\'" , pid , path ) ; //<S2SV> printf ( "HTTP/1.1<S2SV_blank>201<S2SV_blank>Created\\r\\n\\r\\n" ) ; //<S2SV> fflush ( NULL ) ; //<S2SV> close ( STDOUT_FILENO ) ; //<S2SV> xdup2 ( STDERR_FILENO , STDOUT_FILENO ) ; //<S2SV> if ( g_settings_nMaxCrashReportsSize > 0 ) //<S2SV> { //<S2SV> trim_problem_dirs ( g_settings_dump_location , g_settings_nMaxCrashReportsSize * ( double ) ( 1024 * 1024 ) , path ) ; //<S2SV> } //<S2SV> run_post_create ( path ) ; //<S2SV> exit ( 0 ) ; //<S2SV> } //<S2SV> 