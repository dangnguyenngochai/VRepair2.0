static void init_encode_frame_mb_context ( VP8_COMP * cpi ) //<S2SV> { //<S2SV> MACROBLOCK * const x = & cpi -> mb ; //<S2SV> VP8_COMMON * const cm = & cpi -> common ; //<S2SV> MACROBLOCKD * const xd = & x -> e_mbd ; //<S2SV> x -> gf_active_ptr = ( signed char * ) cpi -> gf_active_flags ; //<S2SV> x -> mb_activity_ptr = cpi -> mb_activity_map ; //<S2SV> x -> act_zbin_adj = 0 ; //<S2SV> x -> partition_info = x -> pi ; //<S2SV> xd -> mode_info_context = cm -> mi ; //<S2SV> xd -> mode_info_stride = cm -> mode_info_stride ; //<S2SV> xd -> frame_type = cm -> frame_type ; //<S2SV> if ( cm -> frame_type == KEY_FRAME ) //<S2SV> vp8_init_mbmode_probs ( cm ) ; //<S2SV> x -> src = * cpi -> Source ; //<S2SV> xd -> pre = cm -> yv12_fb [ cm -> lst_fb_idx ] ; //<S2SV> xd -> dst = cm -> yv12_fb [ cm -> new_fb_idx ] ; //<S2SV> vp8_setup_intra_recon ( & cm -> yv12_fb [ cm -> new_fb_idx ] ) ; //<S2SV> vp8_build_block_offsets ( x ) ; //<S2SV> xd -> mode_info_context -> mbmi . mode = DC_PRED ; //<S2SV> xd -> mode_info_context -> mbmi . uv_mode = DC_PRED ; //<S2SV> xd -> left_context = & cm -> left_context ; //<S2SV> x -> mvc = cm -> fc . mvc ; //<S2SV> memset ( cm -> above_context , 0 , sizeof ( ENTROPY_CONTEXT_PLANES ) * cm -> mb_cols ) ; //<S2SV> if ( cpi -> ref_frame_flags == VP8_LAST_FRAME ) //<S2SV> vp8_calc_ref_frame_costs ( x -> ref_frame_cost , //<S2SV> cpi -> prob_intra_coded , 255 , 128 ) ; //<S2SV> else if ( ( cpi -> oxcf . number_of_layers > 1 ) && //<S2SV> ( cpi -> ref_frame_flags == VP8_GOLD_FRAME ) ) //<S2SV> vp8_calc_ref_frame_costs ( x -> ref_frame_cost , //<S2SV> cpi -> prob_intra_coded , 1 , 255 ) ; //<S2SV> else if ( ( cpi -> oxcf . number_of_layers > 1 ) && //<S2SV> ( cpi -> ref_frame_flags == VP8_ALTR_FRAME ) ) //<S2SV> vp8_calc_ref_frame_costs ( x -> ref_frame_cost , //<S2SV> cpi -> prob_intra_coded , 1 , 1 ) ; //<S2SV> else //<S2SV> vp8_calc_ref_frame_costs ( x -> ref_frame_cost , //<S2SV> cpi -> prob_intra_coded , //<S2SV> cpi -> prob_last_coded , //<S2SV> cpi -> prob_gf_coded ) ; //<S2SV> xd -> fullpixel_mask = 0xffffffff ; //<S2SV> if ( cm -> full_pixel ) //<S2SV> xd -> fullpixel_mask = 0xfffffff8 ; //<S2SV> vp8_zero ( x -> coef_counts ) ; //<S2SV> vp8_zero ( x -> ymode_count ) ; //<S2SV> vp8_zero ( x -> uv_mode_count ) //<S2SV> x -> prediction_error = 0 ; //<S2SV> x -> intra_error = 0 ; //<S2SV> vp8_zero ( x -> count_mb_ref_frame_usage ) ; //<S2SV> } //<S2SV> 