void vp9_rc_get_one_pass_vbr_params ( VP9_COMP * cpi ) { //<S2SV> VP9_COMMON * const cm = & cpi -> common ; //<S2SV> RATE_CONTROL * const rc = & cpi -> rc ; //<S2SV> int target ; //<S2SV> if ( ! cpi -> refresh_alt_ref_frame && //<S2SV> ( cm -> current_video_frame == 0 || //<S2SV> ( cpi -> frame_flags & FRAMEFLAGS_KEY ) || //<S2SV> rc -> frames_to_key == 0 || //<S2SV> ( cpi -> oxcf . auto_key && 0 ) ) ) { //<S2SV> cm -> frame_type = KEY_FRAME ; //<S2SV> rc -> this_key_frame_forced = cm -> current_video_frame != 0 && //<S2SV> rc -> frames_to_key == 0 ; //<S2SV> rc -> frames_to_key = cpi -> oxcf . key_freq ; //<S2SV> rc -> kf_boost = DEFAULT_KF_BOOST ; //<S2SV> rc -> source_alt_ref_active = 0 ; //<S2SV> } else { //<S2SV> cm -> frame_type = INTER_FRAME ; //<S2SV> } //<S2SV> if ( rc -> frames_till_gf_update_due == 0 ) { //<S2SV> rc -> baseline_gf_interval = ( rc -> min_gf_interval + rc -> max_gf_interval ) / 2 ; //<S2SV> rc -> frames_till_gf_update_due = rc -> baseline_gf_interval ; //<S2SV> if ( rc -> frames_till_gf_update_due > rc -> frames_to_key ) { //<S2SV> rc -> frames_till_gf_update_due = rc -> frames_to_key ; //<S2SV> rc -> constrained_gf_group = 1 ; //<S2SV> } else { //<S2SV> rc -> constrained_gf_group = 0 ; //<S2SV> } //<S2SV> cpi -> refresh_golden_frame = 1 ; //<S2SV> rc -> source_alt_ref_pending = USE_ALTREF_FOR_ONE_PASS ; //<S2SV> rc -> gfu_boost = DEFAULT_GF_BOOST ; //<S2SV> } //<S2SV> if ( cm -> frame_type == KEY_FRAME ) //<S2SV> target = calc_iframe_target_size_one_pass_vbr ( cpi ) ; //<S2SV> else //<S2SV> target = calc_pframe_target_size_one_pass_vbr ( cpi ) ; //<S2SV> vp9_rc_set_frame_target ( cpi , target ) ; //<S2SV> } //<S2SV> 