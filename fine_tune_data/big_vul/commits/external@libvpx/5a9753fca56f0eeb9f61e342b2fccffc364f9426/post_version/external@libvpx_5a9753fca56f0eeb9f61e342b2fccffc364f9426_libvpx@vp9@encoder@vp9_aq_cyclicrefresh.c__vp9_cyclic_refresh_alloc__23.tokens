CYCLIC_REFRESH * vp9_cyclic_refresh_alloc ( int mi_rows , int mi_cols ) { //<S2SV> size_t last_coded_q_map_size ; //<S2SV> CYCLIC_REFRESH * const cr = vpx_calloc ( 1 , sizeof ( * cr ) ) ; //<S2SV> if ( cr == NULL ) //<S2SV> return NULL ; //<S2SV> cr -> map = vpx_calloc ( mi_rows * mi_cols , sizeof ( * cr -> map ) ) ; //<S2SV> if ( cr -> map == NULL ) { //<S2SV> vpx_free ( cr ) ; //<S2SV> return NULL ; //<S2SV> } //<S2SV> last_coded_q_map_size = mi_rows * mi_cols * sizeof ( * cr -> last_coded_q_map ) ; //<S2SV> cr -> last_coded_q_map = vpx_malloc ( last_coded_q_map_size ) ; //<S2SV> if ( cr -> last_coded_q_map == NULL ) { //<S2SV> vpx_free ( cr ) ; //<S2SV> return NULL ; //<S2SV> } //<S2SV> assert ( MAXQ <= 255 ) ; //<S2SV> memset ( cr -> last_coded_q_map , MAXQ , last_coded_q_map_size ) ; //<S2SV> return cr ; //<S2SV> } //<S2SV> 