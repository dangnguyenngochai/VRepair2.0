static double get_rate_correction_factor ( const VP9_COMP * cpi ) { //<S2SV> const RATE_CONTROL * const rc = & cpi -> rc ; //<S2SV> double rcf ; //<S2SV> if ( cpi -> common . frame_type == KEY_FRAME ) { //<S2SV> rcf = rc -> rate_correction_factors [ KF_STD ] ; //<S2SV> } else if ( cpi -> oxcf . pass == 2 ) { //<S2SV> RATE_FACTOR_LEVEL rf_lvl = //<S2SV> cpi -> twopass . gf_group . rf_level [ cpi -> twopass . gf_group . index ] ; //<S2SV> rcf = rc -> rate_correction_factors [ rf_lvl ] ; //<S2SV> } else { //<S2SV> if ( ( cpi -> refresh_alt_ref_frame || cpi -> refresh_golden_frame ) && //<S2SV> ! rc -> is_src_frame_alt_ref && ! cpi -> use_svc && //<S2SV> ( cpi -> oxcf . rc_mode != VPX_CBR || cpi -> oxcf . gf_cbr_boost_pct > 20 ) ) //<S2SV> rcf = rc -> rate_correction_factors [ GF_ARF_STD ] ; //<S2SV> else //<S2SV> rcf = rc -> rate_correction_factors [ INTER_NORMAL ] ; //<S2SV> } //<S2SV> rcf *= rcf_mult [ rc -> frame_size_selector ] ; //<S2SV> return fclamp ( rcf , MIN_BPB_FACTOR , MAX_BPB_FACTOR ) ; //<S2SV> } //<S2SV> 