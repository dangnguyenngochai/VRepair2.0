static vpx_codec_err_t vp8e_init ( vpx_codec_ctx_t * ctx , //<S2SV> vpx_codec_priv_enc_mr_cfg_t * mr_cfg ) //<S2SV> { //<S2SV> vpx_codec_err_t res = VPX_CODEC_OK ; //<S2SV> vp8_rtcd ( ) ; //<S2SV> vpx_dsp_rtcd ( ) ; //<S2SV> vpx_scale_rtcd ( ) ; //<S2SV> if ( ! ctx -> priv ) //<S2SV> { //<S2SV> struct vpx_codec_alg_priv * priv = //<S2SV> ( struct vpx_codec_alg_priv * ) vpx_calloc ( 1 , sizeof ( * priv ) ) ; //<S2SV> if ( ! priv ) //<S2SV> { //<S2SV> return VPX_CODEC_MEM_ERROR ; //<S2SV> } //<S2SV> ctx -> priv = ( vpx_codec_priv_t * ) priv ; //<S2SV> ctx -> priv -> init_flags = ctx -> init_flags ; //<S2SV> if ( ctx -> config . enc ) //<S2SV> { //<S2SV> priv -> cfg = * ctx -> config . enc ; //<S2SV> ctx -> config . enc = & priv -> cfg ; //<S2SV> } //<S2SV> priv -> vp8_cfg = default_extracfg ; //<S2SV> priv -> vp8_cfg . pkt_list = & priv -> pkt_list . head ; //<S2SV> priv -> cx_data_sz = priv -> cfg . g_w * priv -> cfg . g_h * 3 / 2 * 2 ; //<S2SV> if ( priv -> cx_data_sz < 32768 ) priv -> cx_data_sz = 32768 ; //<S2SV> priv -> cx_data = malloc ( priv -> cx_data_sz ) ; //<S2SV> if ( ! priv -> cx_data ) //<S2SV> { //<S2SV> return VPX_CODEC_MEM_ERROR ; //<S2SV> } //<S2SV> if ( mr_cfg ) //<S2SV> ctx -> priv -> enc . total_encoders = mr_cfg -> mr_total_resolutions ; //<S2SV> else //<S2SV> ctx -> priv -> enc . total_encoders = 1 ; //<S2SV> res = validate_config ( priv , & priv -> cfg , & priv -> vp8_cfg , 0 ) ; //<S2SV> if ( ! res ) //<S2SV> { //<S2SV> set_vp8e_config ( & priv -> oxcf , priv -> cfg , priv -> vp8_cfg , mr_cfg ) ; //<S2SV> priv -> cpi = vp8_create_compressor ( & priv -> oxcf ) ; //<S2SV> if ( ! priv -> cpi ) //<S2SV> res = VPX_CODEC_MEM_ERROR ; //<S2SV> } //<S2SV> } //<S2SV> return res ; //<S2SV> } //<S2SV> 