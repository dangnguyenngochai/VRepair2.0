void vp9_vaq_frame_setup ( VP9_COMP * cpi ) { //<S2SV> VP9_COMMON * cm = & cpi -> common ; //<S2SV> struct segmentation * seg = & cm -> seg ; //<S2SV> int i ; //<S2SV> if ( cm -> frame_type == KEY_FRAME || //<S2SV> cpi -> refresh_alt_ref_frame || //<S2SV> ( cpi -> refresh_golden_frame && ! cpi -> rc . is_src_frame_alt_ref ) ) { //<S2SV> vp9_enable_segmentation ( seg ) ; //<S2SV> vp9_clearall_segfeatures ( seg ) ; //<S2SV> seg -> abs_delta = SEGMENT_DELTADATA ; //<S2SV> vpx_clear_system_state ( ) ; //<S2SV> for ( i = 0 ; i < MAX_SEGMENTS ; ++ i ) { //<S2SV> int qindex_delta = //<S2SV> vp9_compute_qdelta_by_rate ( & cpi -> rc , cm -> frame_type , cm -> base_qindex , //<S2SV> rate_ratio [ i ] , cm -> bit_depth ) ; //<S2SV> if ( ( cm -> base_qindex != 0 ) && ( ( cm -> base_qindex + qindex_delta ) == 0 ) ) { //<S2SV> qindex_delta = - cm -> base_qindex + 1 ; //<S2SV> } //<S2SV> if ( rate_ratio [ i ] == 1.0 ) { //<S2SV> continue ; //<S2SV> } //<S2SV> vp9_set_segdata ( seg , i , SEG_LVL_ALT_Q , qindex_delta ) ; //<S2SV> vp9_enable_segfeature ( seg , i , SEG_LVL_ALT_Q ) ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> 