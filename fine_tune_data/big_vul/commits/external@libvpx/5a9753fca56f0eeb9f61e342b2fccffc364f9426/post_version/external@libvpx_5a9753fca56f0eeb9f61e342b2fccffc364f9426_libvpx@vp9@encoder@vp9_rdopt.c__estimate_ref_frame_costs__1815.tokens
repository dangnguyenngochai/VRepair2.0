static void estimate_ref_frame_costs ( const VP9_COMMON * cm , //<S2SV> const MACROBLOCKD * xd , //<S2SV> int segment_id , //<S2SV> unsigned int * ref_costs_single , //<S2SV> unsigned int * ref_costs_comp , //<S2SV> vpx_prob * comp_mode_p ) { //<S2SV> int seg_ref_active = segfeature_active ( & cm -> seg , segment_id , //<S2SV> SEG_LVL_REF_FRAME ) ; //<S2SV> if ( seg_ref_active ) { //<S2SV> memset ( ref_costs_single , 0 , MAX_REF_FRAMES * sizeof ( * ref_costs_single ) ) ; //<S2SV> memset ( ref_costs_comp , 0 , MAX_REF_FRAMES * sizeof ( * ref_costs_comp ) ) ; //<S2SV> * comp_mode_p = 128 ; //<S2SV> } else { //<S2SV> vpx_prob intra_inter_p = vp9_get_intra_inter_prob ( cm , xd ) ; //<S2SV> vpx_prob comp_inter_p = 128 ; //<S2SV> if ( cm -> reference_mode == REFERENCE_MODE_SELECT ) { //<S2SV> comp_inter_p = vp9_get_reference_mode_prob ( cm , xd ) ; //<S2SV> * comp_mode_p = comp_inter_p ; //<S2SV> } else { //<S2SV> * comp_mode_p = 128 ; //<S2SV> } //<S2SV> ref_costs_single [ INTRA_FRAME ] = vp9_cost_bit ( intra_inter_p , 0 ) ; //<S2SV> if ( cm -> reference_mode != COMPOUND_REFERENCE ) { //<S2SV> vpx_prob ref_single_p1 = vp9_get_pred_prob_single_ref_p1 ( cm , xd ) ; //<S2SV> vpx_prob ref_single_p2 = vp9_get_pred_prob_single_ref_p2 ( cm , xd ) ; //<S2SV> unsigned int base_cost = vp9_cost_bit ( intra_inter_p , 1 ) ; //<S2SV> if ( cm -> reference_mode == REFERENCE_MODE_SELECT ) //<S2SV> base_cost += vp9_cost_bit ( comp_inter_p , 0 ) ; //<S2SV> ref_costs_single [ LAST_FRAME ] = ref_costs_single [ GOLDEN_FRAME ] = //<S2SV> ref_costs_single [ ALTREF_FRAME ] = base_cost ; //<S2SV> ref_costs_single [ LAST_FRAME ] += vp9_cost_bit ( ref_single_p1 , 0 ) ; //<S2SV> ref_costs_single [ GOLDEN_FRAME ] += vp9_cost_bit ( ref_single_p1 , 1 ) ; //<S2SV> ref_costs_single [ ALTREF_FRAME ] += vp9_cost_bit ( ref_single_p1 , 1 ) ; //<S2SV> ref_costs_single [ GOLDEN_FRAME ] += vp9_cost_bit ( ref_single_p2 , 0 ) ; //<S2SV> ref_costs_single [ ALTREF_FRAME ] += vp9_cost_bit ( ref_single_p2 , 1 ) ; //<S2SV> } else { //<S2SV> ref_costs_single [ LAST_FRAME ] = 512 ; //<S2SV> ref_costs_single [ GOLDEN_FRAME ] = 512 ; //<S2SV> ref_costs_single [ ALTREF_FRAME ] = 512 ; //<S2SV> } //<S2SV> if ( cm -> reference_mode != SINGLE_REFERENCE ) { //<S2SV> vpx_prob ref_comp_p = vp9_get_pred_prob_comp_ref_p ( cm , xd ) ; //<S2SV> unsigned int base_cost = vp9_cost_bit ( intra_inter_p , 1 ) ; //<S2SV> if ( cm -> reference_mode == REFERENCE_MODE_SELECT ) //<S2SV> base_cost += vp9_cost_bit ( comp_inter_p , 1 ) ; //<S2SV> ref_costs_comp [ LAST_FRAME ] = base_cost + vp9_cost_bit ( ref_comp_p , 0 ) ; //<S2SV> ref_costs_comp [ GOLDEN_FRAME ] = base_cost + vp9_cost_bit ( ref_comp_p , 1 ) ; //<S2SV> } else { //<S2SV> ref_costs_comp [ LAST_FRAME ] = 512 ; //<S2SV> ref_costs_comp [ GOLDEN_FRAME ] = 512 ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> 