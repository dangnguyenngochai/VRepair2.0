int main ( int argc , char * * argv ) { //<S2SV> int frame_cnt = 0 ; //<S2SV> FILE * outfile = NULL ; //<S2SV> vpx_codec_ctx_t codec ; //<S2SV> vpx_codec_err_t res ; //<S2SV> VpxVideoReader * reader = NULL ; //<S2SV> const VpxInterface * decoder = NULL ; //<S2SV> const VpxVideoInfo * info = NULL ; //<S2SV> exec_name = argv [ 0 ] ; //<S2SV> if ( argc != 3 ) //<S2SV> die ( "Invalid<S2SV_blank>number<S2SV_blank>of<S2SV_blank>arguments." ) ; //<S2SV> reader = vpx_video_reader_open ( argv [ 1 ] ) ; //<S2SV> if ( ! reader ) //<S2SV> die ( "Failed<S2SV_blank>to<S2SV_blank>open<S2SV_blank>%s<S2SV_blank>for<S2SV_blank>reading." , argv [ 1 ] ) ; //<S2SV> if ( ! ( outfile = fopen ( argv [ 2 ] , "wb" ) ) ) //<S2SV> die ( "Failed<S2SV_blank>to<S2SV_blank>open<S2SV_blank>%s<S2SV_blank>for<S2SV_blank>writing" , argv [ 2 ] ) ; //<S2SV> info = vpx_video_reader_get_info ( reader ) ; //<S2SV> decoder = get_vpx_decoder_by_fourcc ( info -> codec_fourcc ) ; //<S2SV> if ( ! decoder ) //<S2SV> die ( "Unknown<S2SV_blank>input<S2SV_blank>codec." ) ; //<S2SV> printf ( "Using<S2SV_blank>%s\\n" , vpx_codec_iface_name ( decoder -> codec_interface ( ) ) ) ; //<S2SV> res = vpx_codec_dec_init ( & codec , decoder -> codec_interface ( ) , NULL , //<S2SV> VPX_CODEC_USE_POSTPROC ) ; //<S2SV> if ( res == VPX_CODEC_INCAPABLE ) //<S2SV> die_codec ( & codec , "Postproc<S2SV_blank>not<S2SV_blank>supported<S2SV_blank>by<S2SV_blank>this<S2SV_blank>decoder." ) ; //<S2SV> if ( res ) //<S2SV> die_codec ( & codec , "Failed<S2SV_blank>to<S2SV_blank>initialize<S2SV_blank>decoder." ) ; //<S2SV> while ( vpx_video_reader_read_frame ( reader ) ) { //<S2SV> vpx_codec_iter_t iter = NULL ; //<S2SV> vpx_image_t * img = NULL ; //<S2SV> size_t frame_size = 0 ; //<S2SV> const unsigned char * frame = vpx_video_reader_get_frame ( reader , //<S2SV> & frame_size ) ; //<S2SV> ++ frame_cnt ; //<S2SV> if ( frame_cnt % 30 == 1 ) { //<S2SV> vp8_postproc_cfg_t pp = { 0 , 0 , 0 } ; //<S2SV> if ( vpx_codec_control ( & codec , VP8_SET_POSTPROC , & pp ) ) //<S2SV> die_codec ( & codec , "Failed<S2SV_blank>to<S2SV_blank>turn<S2SV_blank>off<S2SV_blank>postproc." ) ; //<S2SV> } else if ( frame_cnt % 30 == 16 ) { //<S2SV> vp8_postproc_cfg_t pp = { VP8_DEBLOCK | VP8_DEMACROBLOCK | VP8_MFQE , //<S2SV> 4 , 0 } ; //<S2SV> if ( vpx_codec_control ( & codec , VP8_SET_POSTPROC , & pp ) ) //<S2SV> die_codec ( & codec , "Failed<S2SV_blank>to<S2SV_blank>turn<S2SV_blank>on<S2SV_blank>postproc." ) ; //<S2SV> } ; //<S2SV> if ( vpx_codec_decode ( & codec , frame , ( unsigned int ) frame_size , NULL , 15000 ) ) //<S2SV> die_codec ( & codec , "Failed<S2SV_blank>to<S2SV_blank>decode<S2SV_blank>frame" ) ; //<S2SV> while ( ( img = vpx_codec_get_frame ( & codec , & iter ) ) != NULL ) { //<S2SV> vpx_img_write ( img , outfile ) ; //<S2SV> } //<S2SV> } //<S2SV> printf ( "Processed<S2SV_blank>%d<S2SV_blank>frames.\\n" , frame_cnt ) ; //<S2SV> if ( vpx_codec_destroy ( & codec ) ) //<S2SV> die_codec ( & codec , "Failed<S2SV_blank>to<S2SV_blank>destroy<S2SV_blank>codec" ) ; //<S2SV> printf ( "Play:<S2SV_blank>ffplay<S2SV_blank>-f<S2SV_blank>rawvideo<S2SV_blank>-pix_fmt<S2SV_blank>yuv420p<S2SV_blank>-s<S2SV_blank>%dx%d<S2SV_blank>%s\\n" , //<S2SV> info -> frame_width , info -> frame_height , argv [ 2 ] ) ; //<S2SV> vpx_video_reader_close ( reader ) ; //<S2SV> fclose ( outfile ) ; //<S2SV> return EXIT_SUCCESS ; //<S2SV> } //<S2SV> 