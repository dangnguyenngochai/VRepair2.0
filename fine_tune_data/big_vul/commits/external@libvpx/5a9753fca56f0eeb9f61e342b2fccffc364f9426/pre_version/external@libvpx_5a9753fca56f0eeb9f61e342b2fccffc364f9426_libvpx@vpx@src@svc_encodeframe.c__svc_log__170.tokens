static int svc_log ( SvcContext * svc_ctx , int level , const char * fmt , ... ) { //<S2SV> char buf [ 512 ] ; //<S2SV> int retval = 0 ; //<S2SV> va_list ap ; //<S2SV> SvcInternal * const si = get_svc_internal ( svc_ctx ) ; //<S2SV> if ( level > svc_ctx -> log_level ) { //<S2SV> return retval ; //<S2SV> } //<S2SV> va_start ( ap , fmt ) ; //<S2SV> retval = vsnprintf ( buf , sizeof ( buf ) , fmt , ap ) ; //<S2SV> va_end ( ap ) ; //<S2SV> if ( svc_ctx -> log_print ) { //<S2SV> printf ( "%s" , buf ) ; //<S2SV> } else { //<S2SV> strncat ( si -> message_buffer , buf , //<S2SV> sizeof ( si -> message_buffer ) - strlen ( si -> message_buffer ) - 1 ) ; //<S2SV> } //<S2SV> if ( level == SVC_LOG_ERROR ) { //<S2SV> si -> codec_ctx -> err_detail = si -> message_buffer ; //<S2SV> } //<S2SV> return retval ; //<S2SV> } //<S2SV> 