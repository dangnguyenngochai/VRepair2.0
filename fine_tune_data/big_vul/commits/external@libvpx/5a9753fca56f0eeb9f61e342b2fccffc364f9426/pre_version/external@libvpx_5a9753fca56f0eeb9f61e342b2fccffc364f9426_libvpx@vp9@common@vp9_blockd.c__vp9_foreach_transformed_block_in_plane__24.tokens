void vp9_foreach_transformed_block_in_plane ( //<S2SV> const MACROBLOCKD * const xd , BLOCK_SIZE bsize , int plane , //<S2SV> foreach_transformed_block_visitor visit , void * arg ) { //<S2SV> const struct macroblockd_plane * const pd = & xd -> plane [ plane ] ; //<S2SV> const MB_MODE_INFO * mbmi = & xd -> mi [ 0 ] -> mbmi ; //<S2SV> const TX_SIZE tx_size = plane ? get_uv_tx_size ( mbmi ) //<S2SV> : mbmi -> tx_size ; //<S2SV> const BLOCK_SIZE plane_bsize = get_plane_block_size ( bsize , pd ) ; //<S2SV> const int num_4x4_w = num_4x4_blocks_wide_lookup [ plane_bsize ] ; //<S2SV> const int num_4x4_h = num_4x4_blocks_high_lookup [ plane_bsize ] ; //<S2SV> const int step = 1 << ( tx_size << 1 ) ; //<S2SV> int i ; //<S2SV> if ( xd -> mb_to_right_edge < 0 || xd -> mb_to_bottom_edge < 0 ) { //<S2SV> int r , c ; //<S2SV> int max_blocks_wide = num_4x4_w ; //<S2SV> int max_blocks_high = num_4x4_h ; //<S2SV> if ( xd -> mb_to_right_edge < 0 ) //<S2SV> max_blocks_wide += ( xd -> mb_to_right_edge >> ( 5 + pd -> subsampling_x ) ) ; //<S2SV> if ( xd -> mb_to_bottom_edge < 0 ) //<S2SV> max_blocks_high += ( xd -> mb_to_bottom_edge >> ( 5 + pd -> subsampling_y ) ) ; //<S2SV> i = 0 ; //<S2SV> for ( r = 0 ; r < num_4x4_h ; r += ( 1 << tx_size ) ) { //<S2SV> for ( c = 0 ; c < num_4x4_w ; c += ( 1 << tx_size ) ) { //<S2SV> if ( r < max_blocks_high && c < max_blocks_wide ) //<S2SV> visit ( plane , i , plane_bsize , tx_size , arg ) ; //<S2SV> i += step ; //<S2SV> } //<S2SV> } //<S2SV> } else { //<S2SV> for ( i = 0 ; i < num_4x4_w * num_4x4_h ; i += step ) //<S2SV> visit ( plane , i , plane_bsize , tx_size , arg ) ; //<S2SV> } //<S2SV> } //<S2SV> 