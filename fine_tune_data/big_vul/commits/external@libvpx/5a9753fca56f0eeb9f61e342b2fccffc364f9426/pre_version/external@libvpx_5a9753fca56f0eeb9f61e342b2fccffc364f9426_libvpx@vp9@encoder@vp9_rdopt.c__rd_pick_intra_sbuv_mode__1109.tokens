static int64_t rd_pick_intra_sbuv_mode ( VP9_COMP * cpi , MACROBLOCK * x , //<S2SV> PICK_MODE_CONTEXT * ctx , //<S2SV> int * rate , int * rate_tokenonly , //<S2SV> int64_t * distortion , int * skippable , //<S2SV> BLOCK_SIZE bsize , TX_SIZE max_tx_size ) { //<S2SV> MACROBLOCKD * xd = & x -> e_mbd ; //<S2SV> MB_PREDICTION_MODE mode ; //<S2SV> MB_PREDICTION_MODE mode_selected = DC_PRED ; //<S2SV> int64_t best_rd = INT64_MAX , this_rd ; //<S2SV> int this_rate_tokenonly , this_rate , s ; //<S2SV> int64_t this_distortion , this_sse ; //<S2SV> for ( mode = DC_PRED ; mode <= TM_PRED ; ++ mode ) { //<S2SV> if ( ! ( cpi -> sf . intra_uv_mode_mask [ max_tx_size ] & ( 1 << mode ) ) ) //<S2SV> continue ; //<S2SV> xd -> mi [ 0 ] -> mbmi . uv_mode = mode ; //<S2SV> super_block_uvrd ( cpi , x , & this_rate_tokenonly , //<S2SV> & this_distortion , & s , & this_sse , bsize , best_rd ) ; //<S2SV> if ( this_rate_tokenonly == INT_MAX ) //<S2SV> continue ; //<S2SV> this_rate = this_rate_tokenonly + //<S2SV> x -> intra_uv_mode_cost [ cpi -> common . frame_type ] [ mode ] ; //<S2SV> this_rd = RDCOST ( x -> rdmult , x -> rddiv , this_rate , this_distortion ) ; //<S2SV> if ( this_rd < best_rd ) { //<S2SV> mode_selected = mode ; //<S2SV> best_rd = this_rd ; //<S2SV> * rate = this_rate ; //<S2SV> * rate_tokenonly = this_rate_tokenonly ; //<S2SV> * distortion = this_distortion ; //<S2SV> * skippable = s ; //<S2SV> if ( ! x -> select_txfm_size ) { //<S2SV> int i ; //<S2SV> struct macroblock_plane * const p = x -> plane ; //<S2SV> struct macroblockd_plane * const pd = xd -> plane ; //<S2SV> for ( i = 1 ; i < MAX_MB_PLANE ; ++ i ) { //<S2SV> p [ i ] . coeff = ctx -> coeff_pbuf [ i ] [ 2 ] ; //<S2SV> p [ i ] . qcoeff = ctx -> qcoeff_pbuf [ i ] [ 2 ] ; //<S2SV> pd [ i ] . dqcoeff = ctx -> dqcoeff_pbuf [ i ] [ 2 ] ; //<S2SV> p [ i ] . eobs = ctx -> eobs_pbuf [ i ] [ 2 ] ; //<S2SV> ctx -> coeff_pbuf [ i ] [ 2 ] = ctx -> coeff_pbuf [ i ] [ 0 ] ; //<S2SV> ctx -> qcoeff_pbuf [ i ] [ 2 ] = ctx -> qcoeff_pbuf [ i ] [ 0 ] ; //<S2SV> ctx -> dqcoeff_pbuf [ i ] [ 2 ] = ctx -> dqcoeff_pbuf [ i ] [ 0 ] ; //<S2SV> ctx -> eobs_pbuf [ i ] [ 2 ] = ctx -> eobs_pbuf [ i ] [ 0 ] ; //<S2SV> ctx -> coeff_pbuf [ i ] [ 0 ] = p [ i ] . coeff ; //<S2SV> ctx -> qcoeff_pbuf [ i ] [ 0 ] = p [ i ] . qcoeff ; //<S2SV> ctx -> dqcoeff_pbuf [ i ] [ 0 ] = pd [ i ] . dqcoeff ; //<S2SV> ctx -> eobs_pbuf [ i ] [ 0 ] = p [ i ] . eobs ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> xd -> mi [ 0 ] -> mbmi . uv_mode = mode_selected ; //<S2SV> return best_rd ; //<S2SV> } //<S2SV> 