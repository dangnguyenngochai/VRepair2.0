const char * vpx_svc_dump_statistics ( SvcContext * svc_ctx ) { //<S2SV> int number_of_frames , number_of_keyframes , encode_frame_count ; //<S2SV> int i , j ; //<S2SV> uint32_t bytes_total = 0 ; //<S2SV> double scale [ COMPONENTS ] ; //<S2SV> double psnr [ COMPONENTS ] ; //<S2SV> double mse [ COMPONENTS ] ; //<S2SV> double y_scale ; //<S2SV> SvcInternal * const si = get_svc_internal ( svc_ctx ) ; //<S2SV> if ( svc_ctx == NULL || si == NULL ) return NULL ; //<S2SV> svc_log_reset ( svc_ctx ) ; //<S2SV> encode_frame_count = si -> encode_frame_count ; //<S2SV> if ( si -> encode_frame_count <= 0 ) return vpx_svc_get_message ( svc_ctx ) ; //<S2SV> svc_log ( svc_ctx , SVC_LOG_INFO , "\\n" ) ; //<S2SV> number_of_keyframes = encode_frame_count / si -> kf_dist + 1 ; //<S2SV> for ( i = 0 ; i < si -> layers ; ++ i ) { //<S2SV> number_of_frames = encode_frame_count ; //<S2SV> if ( svc_ctx -> encoding_mode == ALT_INTER_LAYER_PREDICTION_IP && //<S2SV> ( i == 1 || i == 3 ) ) { //<S2SV> number_of_frames -= number_of_keyframes ; //<S2SV> } //<S2SV> svc_log ( svc_ctx , SVC_LOG_INFO , //<S2SV> "Layer<S2SV_blank>%d<S2SV_blank>Average<S2SV_blank>PSNR=[%2.3f,<S2SV_blank>%2.3f,<S2SV_blank>%2.3f,<S2SV_blank>%2.3f],<S2SV_blank>Bytes=[%u]\\n" , //<S2SV> i , ( double ) si -> psnr_sum [ i ] [ 0 ] / number_of_frames , //<S2SV> ( double ) si -> psnr_sum [ i ] [ 1 ] / number_of_frames , //<S2SV> ( double ) si -> psnr_sum [ i ] [ 2 ] / number_of_frames , //<S2SV> ( double ) si -> psnr_sum [ i ] [ 3 ] / number_of_frames , si -> bytes_sum [ i ] ) ; //<S2SV> y_scale = si -> width * si -> height * 255.0 * 255.0 * number_of_frames ; //<S2SV> scale [ 1 ] = y_scale ; //<S2SV> scale [ 2 ] = scale [ 3 ] = y_scale / 4 ; //<S2SV> scale [ 0 ] = y_scale * 1.5 ; //<S2SV> for ( j = 0 ; j < COMPONENTS ; j ++ ) { //<S2SV> psnr [ j ] = calc_psnr ( si -> sse_sum [ i ] [ j ] / scale [ j ] ) ; //<S2SV> mse [ j ] = si -> sse_sum [ i ] [ j ] * 255.0 * 255.0 / scale [ j ] ; //<S2SV> } //<S2SV> svc_log ( svc_ctx , SVC_LOG_INFO , //<S2SV> "Layer<S2SV_blank>%d<S2SV_blank>Overall<S2SV_blank>PSNR=[%2.3f,<S2SV_blank>%2.3f,<S2SV_blank>%2.3f,<S2SV_blank>%2.3f]\\n" , i , psnr [ 0 ] , //<S2SV> psnr [ 1 ] , psnr [ 2 ] , psnr [ 3 ] ) ; //<S2SV> svc_log ( svc_ctx , SVC_LOG_INFO , //<S2SV> "Layer<S2SV_blank>%d<S2SV_blank>Overall<S2SV_blank>MSE=[%2.3f,<S2SV_blank>%2.3f,<S2SV_blank>%2.3f,<S2SV_blank>%2.3f]\\n" , i , mse [ 0 ] , //<S2SV> mse [ 1 ] , mse [ 2 ] , mse [ 3 ] ) ; //<S2SV> bytes_total += si -> bytes_sum [ i ] ; //<S2SV> si -> bytes_sum [ i ] = 0 ; //<S2SV> for ( j = 0 ; j < COMPONENTS ; ++ j ) { //<S2SV> si -> psnr_sum [ i ] [ j ] = 0 ; //<S2SV> si -> sse_sum [ i ] [ j ] = 0 ; //<S2SV> } //<S2SV> } //<S2SV> si -> encode_frame_count = 0 ; //<S2SV> svc_log ( svc_ctx , SVC_LOG_INFO , "Total<S2SV_blank>Bytes=[%u]\\n" , bytes_total ) ; //<S2SV> return vpx_svc_get_message ( svc_ctx ) ; //<S2SV> } //<S2SV> 