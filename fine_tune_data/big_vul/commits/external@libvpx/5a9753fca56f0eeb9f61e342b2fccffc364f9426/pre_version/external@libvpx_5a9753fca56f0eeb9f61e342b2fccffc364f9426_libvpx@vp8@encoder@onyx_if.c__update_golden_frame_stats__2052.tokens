static void update_golden_frame_stats ( VP8_COMP * cpi ) //<S2SV> { //<S2SV> VP8_COMMON * cm = & cpi -> common ; //<S2SV> if ( cm -> refresh_golden_frame ) //<S2SV> { //<S2SV> if ( ! cpi -> auto_gold ) //<S2SV> cpi -> frames_till_gf_update_due = DEFAULT_GF_INTERVAL ; //<S2SV> if ( ( cpi -> pass != 2 ) && ( cpi -> frames_till_gf_update_due > 0 ) ) //<S2SV> { //<S2SV> cpi -> current_gf_interval = cpi -> frames_till_gf_update_due ; //<S2SV> if ( ( cm -> frame_type != KEY_FRAME ) && ! cpi -> source_alt_ref_active ) //<S2SV> { //<S2SV> cpi -> gf_overspend_bits += ( cpi -> projected_frame_size - cpi -> inter_frame_target ) ; //<S2SV> } //<S2SV> cpi -> non_gf_bitrate_adjustment = cpi -> gf_overspend_bits / cpi -> frames_till_gf_update_due ; //<S2SV> } //<S2SV> vpx_memset ( cpi -> gf_active_flags , 1 , ( cm -> mb_rows * cm -> mb_cols ) ) ; //<S2SV> cpi -> gf_active_count = cm -> mb_rows * cm -> mb_cols ; //<S2SV> cm -> refresh_golden_frame = 0 ; //<S2SV> cpi -> frames_since_golden = 0 ; //<S2SV> cpi -> recent_ref_frame_usage [ INTRA_FRAME ] = 1 ; //<S2SV> cpi -> recent_ref_frame_usage [ LAST_FRAME ] = 1 ; //<S2SV> cpi -> recent_ref_frame_usage [ GOLDEN_FRAME ] = 1 ; //<S2SV> cpi -> recent_ref_frame_usage [ ALTREF_FRAME ] = 1 ; //<S2SV> if ( cpi -> oxcf . fixed_q >= 0 && //<S2SV> cpi -> oxcf . play_alternate && ! cpi -> common . refresh_alt_ref_frame ) //<S2SV> { //<S2SV> cpi -> source_alt_ref_pending = 1 ; //<S2SV> cpi -> frames_till_gf_update_due = cpi -> baseline_gf_interval ; //<S2SV> } //<S2SV> if ( ! cpi -> source_alt_ref_pending ) //<S2SV> cpi -> source_alt_ref_active = 0 ; //<S2SV> if ( cpi -> frames_till_gf_update_due > 0 ) //<S2SV> cpi -> frames_till_gf_update_due -- ; //<S2SV> } //<S2SV> else if ( ! cpi -> common . refresh_alt_ref_frame ) //<S2SV> { //<S2SV> if ( cpi -> frames_till_gf_update_due > 0 ) //<S2SV> cpi -> frames_till_gf_update_due -- ; //<S2SV> if ( cpi -> frames_till_alt_ref_frame ) //<S2SV> cpi -> frames_till_alt_ref_frame -- ; //<S2SV> cpi -> frames_since_golden ++ ; //<S2SV> if ( cpi -> frames_since_golden > 1 ) //<S2SV> { //<S2SV> cpi -> recent_ref_frame_usage [ INTRA_FRAME ] += //<S2SV> cpi -> mb . count_mb_ref_frame_usage [ INTRA_FRAME ] ; //<S2SV> cpi -> recent_ref_frame_usage [ LAST_FRAME ] += //<S2SV> cpi -> mb . count_mb_ref_frame_usage [ LAST_FRAME ] ; //<S2SV> cpi -> recent_ref_frame_usage [ GOLDEN_FRAME ] += //<S2SV> cpi -> mb . count_mb_ref_frame_usage [ GOLDEN_FRAME ] ; //<S2SV> cpi -> recent_ref_frame_usage [ ALTREF_FRAME ] += //<S2SV> cpi -> mb . count_mb_ref_frame_usage [ ALTREF_FRAME ] ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> 