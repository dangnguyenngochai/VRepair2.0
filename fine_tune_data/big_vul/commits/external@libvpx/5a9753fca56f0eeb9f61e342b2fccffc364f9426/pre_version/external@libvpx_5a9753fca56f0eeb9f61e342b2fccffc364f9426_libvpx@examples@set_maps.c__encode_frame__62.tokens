static void encode_frame ( vpx_codec_ctx_t * codec , //<S2SV> vpx_image_t * img , //<S2SV> int frame_index , //<S2SV> VpxVideoWriter * writer ) { //<S2SV> vpx_codec_iter_t iter = NULL ; //<S2SV> const vpx_codec_cx_pkt_t * pkt = NULL ; //<S2SV> const vpx_codec_err_t res = vpx_codec_encode ( codec , img , frame_index , 1 , 0 , //<S2SV> VPX_DL_GOOD_QUALITY ) ; //<S2SV> if ( res != VPX_CODEC_OK ) //<S2SV> die_codec ( codec , "Failed<S2SV_blank>to<S2SV_blank>encode<S2SV_blank>frame" ) ; //<S2SV> while ( ( pkt = vpx_codec_get_cx_data ( codec , & iter ) ) != NULL ) { //<S2SV> if ( pkt -> kind == VPX_CODEC_CX_FRAME_PKT ) { //<S2SV> const int keyframe = ( pkt -> data . frame . flags & VPX_FRAME_IS_KEY ) != 0 ; //<S2SV> if ( ! vpx_video_writer_write_frame ( writer , //<S2SV> pkt -> data . frame . buf , //<S2SV> pkt -> data . frame . sz , //<S2SV> pkt -> data . frame . pts ) ) { //<S2SV> die_codec ( codec , "Failed<S2SV_blank>to<S2SV_blank>write<S2SV_blank>compressed<S2SV_blank>frame" ) ; //<S2SV> } //<S2SV> printf ( keyframe ? "K" : "." ) ; //<S2SV> fflush ( stdout ) ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> 