static void swap_frame_buffers ( VP9Decoder * pbi ) { //<S2SV> int ref_index = 0 , mask ; //<S2SV> VP9_COMMON * const cm = & pbi -> common ; //<S2SV> for ( mask = pbi -> refresh_frame_flags ; mask ; mask >>= 1 ) { //<S2SV> if ( mask & 1 ) { //<S2SV> const int old_idx = cm -> ref_frame_map [ ref_index ] ; //<S2SV> ref_cnt_fb ( cm -> frame_bufs , & cm -> ref_frame_map [ ref_index ] , //<S2SV> cm -> new_fb_idx ) ; //<S2SV> if ( old_idx >= 0 && cm -> frame_bufs [ old_idx ] . ref_count == 0 ) //<S2SV> cm -> release_fb_cb ( cm -> cb_priv , //<S2SV> & cm -> frame_bufs [ old_idx ] . raw_frame_buffer ) ; //<S2SV> } //<S2SV> ++ ref_index ; //<S2SV> } //<S2SV> cm -> frame_to_show = get_frame_new_buffer ( cm ) ; //<S2SV> cm -> frame_bufs [ cm -> new_fb_idx ] . ref_count -- ; //<S2SV> for ( ref_index = 0 ; ref_index < 3 ; ref_index ++ ) //<S2SV> cm -> frame_refs [ ref_index ] . idx = INT_MAX ; //<S2SV> } //<S2SV> 