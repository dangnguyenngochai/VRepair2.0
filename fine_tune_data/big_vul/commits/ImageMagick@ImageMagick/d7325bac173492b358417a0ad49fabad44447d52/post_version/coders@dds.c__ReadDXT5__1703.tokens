static MagickBooleanType ReadDXT5 ( Image * image , DDSInfo * dds_info , //<S2SV> ExceptionInfo * exception ) //<S2SV> { //<S2SV> DDSColors //<S2SV> colors ; //<S2SV> ssize_t //<S2SV> j , //<S2SV> y ; //<S2SV> MagickSizeType //<S2SV> alpha_bits ; //<S2SV> PixelPacket //<S2SV> * q ; //<S2SV> register ssize_t //<S2SV> i , //<S2SV> x ; //<S2SV> unsigned char //<S2SV> a0 , //<S2SV> a1 ; //<S2SV> size_t //<S2SV> alpha , //<S2SV> bits , //<S2SV> code , //<S2SV> alpha_code ; //<S2SV> unsigned short //<S2SV> c0 , //<S2SV> c1 ; //<S2SV> for ( y = 0 ; y < ( ssize_t ) dds_info -> height ; y += 4 ) //<S2SV> { //<S2SV> for ( x = 0 ; x < ( ssize_t ) dds_info -> width ; x += 4 ) //<S2SV> { //<S2SV> q = QueueAuthenticPixels ( image , x , y , MagickMin ( 4 , dds_info -> width - x ) , //<S2SV> MagickMin ( 4 , dds_info -> height - y ) , exception ) ; //<S2SV> if ( q == ( PixelPacket * ) NULL ) //<S2SV> return MagickFalse ; //<S2SV> a0 = ( unsigned char ) ReadBlobByte ( image ) ; //<S2SV> a1 = ( unsigned char ) ReadBlobByte ( image ) ; //<S2SV> alpha_bits = ( MagickSizeType ) ReadBlobLSBLong ( image ) ; //<S2SV> alpha_bits = alpha_bits | ( ( MagickSizeType ) ReadBlobLSBShort ( image ) << 32 ) ; //<S2SV> c0 = ReadBlobLSBShort ( image ) ; //<S2SV> c1 = ReadBlobLSBShort ( image ) ; //<S2SV> bits = ReadBlobLSBLong ( image ) ; //<S2SV> CalculateColors ( c0 , c1 , & colors , MagickTrue ) ; //<S2SV> for ( j = 0 ; j < 4 ; j ++ ) //<S2SV> { //<S2SV> for ( i = 0 ; i < 4 ; i ++ ) //<S2SV> { //<S2SV> if ( ( x + i ) < ( ssize_t ) dds_info -> width && ( y + j ) < ( ssize_t ) dds_info -> height ) //<S2SV> { //<S2SV> code = ( bits >> ( ( 4 * j + i ) * 2 ) ) & 0x3 ; //<S2SV> SetPixelRed ( q , ScaleCharToQuantum ( colors . r [ code ] ) ) ; //<S2SV> SetPixelGreen ( q , ScaleCharToQuantum ( colors . g [ code ] ) ) ; //<S2SV> SetPixelBlue ( q , ScaleCharToQuantum ( colors . b [ code ] ) ) ; //<S2SV> alpha_code = ( size_t ) ( alpha_bits >> ( 3 * ( 4 * j + i ) ) ) & 0x7 ; //<S2SV> if ( alpha_code == 0 ) //<S2SV> alpha = a0 ; //<S2SV> else if ( alpha_code == 1 ) //<S2SV> alpha = a1 ; //<S2SV> else if ( a0 > a1 ) //<S2SV> alpha = ( ( 8 - alpha_code ) * a0 + ( alpha_code - 1 ) * a1 ) / 7 ; //<S2SV> else if ( alpha_code == 6 ) //<S2SV> alpha = 0 ; //<S2SV> else if ( alpha_code == 7 ) //<S2SV> alpha = 255 ; //<S2SV> else //<S2SV> alpha = ( ( ( 6 - alpha_code ) * a0 + ( alpha_code - 1 ) * a1 ) / 5 ) ; //<S2SV> SetPixelAlpha ( q , ScaleCharToQuantum ( ( unsigned char ) //<S2SV> alpha ) ) ; //<S2SV> q ++ ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> if ( SyncAuthenticPixels ( image , exception ) == MagickFalse ) //<S2SV> return MagickFalse ; //<S2SV> } //<S2SV> } //<S2SV> return ( SkipDXTMipmaps ( image , dds_info , 16 , exception ) ) ; //<S2SV> } //<S2SV> 