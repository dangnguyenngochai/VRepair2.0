BOOL security_decrypt ( BYTE * data , int length , rdpRdp * rdp ) //<S2SV> { //<S2SV> if ( rdp -> decrypt_use_count >= 4096 ) //<S2SV> { //<S2SV> security_key_update ( rdp -> decrypt_key , rdp -> decrypt_update_key , rdp -> rc4_key_len ) ; //<S2SV> crypto_rc4_free ( rdp -> rc4_decrypt_key ) ; //<S2SV> rdp -> rc4_decrypt_key = crypto_rc4_init ( rdp -> decrypt_key , rdp -> rc4_key_len ) ; //<S2SV> rdp -> decrypt_use_count = 0 ; //<S2SV> } //<S2SV> crypto_rc4 ( rdp -> rc4_decrypt_key , length , data , data ) ; //<S2SV> rdp -> decrypt_use_count += 1 ; //<S2SV> rdp -> decrypt_checksum_use_count ++ ; //<S2SV> return TRUE ; //<S2SV> } //<S2SV> 