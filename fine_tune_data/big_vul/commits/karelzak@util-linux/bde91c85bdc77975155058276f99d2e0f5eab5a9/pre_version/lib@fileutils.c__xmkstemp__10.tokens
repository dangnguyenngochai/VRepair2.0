int xmkstemp ( char * * tmpname , char * dir ) //<S2SV> { //<S2SV> char * localtmp ; //<S2SV> char * tmpenv ; //<S2SV> mode_t old_mode ; //<S2SV> int fd , rc ; //<S2SV> if ( dir != NULL ) //<S2SV> tmpenv = dir ; //<S2SV> else //<S2SV> tmpenv = getenv ( "TMPDIR" ) ; //<S2SV> if ( tmpenv ) //<S2SV> rc = asprintf ( & localtmp , "%s/%s.XXXXXX" , tmpenv , //<S2SV> program_invocation_short_name ) ; //<S2SV> else //<S2SV> rc = asprintf ( & localtmp , "%s/%s.XXXXXX" , _PATH_TMP , //<S2SV> program_invocation_short_name ) ; //<S2SV> if ( rc < 0 ) //<S2SV> return - 1 ; //<S2SV> old_mode = umask ( 077 ) ; //<S2SV> fd = mkostemp ( localtmp , O_RDWR | O_CREAT | O_EXCL | O_CLOEXEC ) ; //<S2SV> umask ( old_mode ) ; //<S2SV> if ( fd == - 1 ) { //<S2SV> free ( localtmp ) ; //<S2SV> localtmp = NULL ; //<S2SV> } //<S2SV> * tmpname = localtmp ; //<S2SV> return fd ; //<S2SV> } //<S2SV> 