bool_t auth_gssapi_unwrap_data ( //<S2SV> OM_uint32 * major , //<S2SV> OM_uint32 * minor , //<S2SV> gss_ctx_id_t context , //<S2SV> uint32_t seq_num , //<S2SV> XDR * in_xdrs , //<S2SV> bool_t ( * xdr_func ) ( ) , //<S2SV> caddr_t xdr_ptr ) //<S2SV> { //<S2SV> gss_buffer_desc in_buf , out_buf ; //<S2SV> XDR temp_xdrs ; //<S2SV> uint32_t verf_seq_num ; //<S2SV> int conf , qop ; //<S2SV> unsigned int length ; //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>starting\\n" ) ) ; //<S2SV> * major = GSS_S_COMPLETE ; //<S2SV> * minor = 0 ; //<S2SV> in_buf . value = NULL ; //<S2SV> out_buf . value = NULL ; //<S2SV> if ( ! xdr_bytes ( in_xdrs , ( char * * ) & in_buf . value , //<S2SV> & length , ( unsigned int ) - 1 ) ) { //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>deserializing<S2SV_blank>encrypted<S2SV_blank>data<S2SV_blank>failed\\n" ) ) ; //<S2SV> temp_xdrs . x_op = XDR_FREE ; //<S2SV> ( void ) xdr_bytes ( & temp_xdrs , ( char * * ) & in_buf . value , & length , //<S2SV> ( unsigned int ) - 1 ) ; //<S2SV> return FALSE ; //<S2SV> } //<S2SV> in_buf . length = length ; //<S2SV> * major = gss_unseal ( minor , context , & in_buf , & out_buf , & conf , //<S2SV> & qop ) ; //<S2SV> free ( in_buf . value ) ; //<S2SV> if ( * major != GSS_S_COMPLETE ) //<S2SV> return FALSE ; //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>%llu<S2SV_blank>bytes<S2SV_blank>data,<S2SV_blank>%llu<S2SV_blank>bytes<S2SV_blank>sealed\\n" , //<S2SV> ( unsigned long long ) out_buf . length , //<S2SV> ( unsigned long long ) in_buf . length ) ) ; //<S2SV> xdrmem_create ( & temp_xdrs , out_buf . value , out_buf . length , XDR_DECODE ) ; //<S2SV> if ( ! xdr_u_int32 ( & temp_xdrs , & verf_seq_num ) ) { //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>deserializing<S2SV_blank>verf_seq_num<S2SV_blank>failed\\n" ) ) ; //<S2SV> gss_release_buffer ( minor , & out_buf ) ; //<S2SV> XDR_DESTROY ( & temp_xdrs ) ; //<S2SV> return FALSE ; //<S2SV> } //<S2SV> if ( verf_seq_num != seq_num ) { //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>seq<S2SV_blank>%d<S2SV_blank>specified,<S2SV_blank>read<S2SV_blank>%d\\n" , //<S2SV> seq_num , verf_seq_num ) ) ; //<S2SV> gss_release_buffer ( minor , & out_buf ) ; //<S2SV> XDR_DESTROY ( & temp_xdrs ) ; //<S2SV> return FALSE ; //<S2SV> } //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>unwrap<S2SV_blank>seq_num<S2SV_blank>%d<S2SV_blank>okay\\n" , verf_seq_num ) ) ; //<S2SV> if ( ! ( * xdr_func ) ( & temp_xdrs , xdr_ptr ) ) { //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>deserializing<S2SV_blank>arguments<S2SV_blank>failed\\n" ) ) ; //<S2SV> gss_release_buffer ( minor , & out_buf ) ; //<S2SV> XDR_DESTROY ( & temp_xdrs ) ; //<S2SV> return FALSE ; //<S2SV> } //<S2SV> PRINTF ( ( "gssapi_unwrap_data:<S2SV_blank>succeeding\\n\\n" ) ) ; //<S2SV> gss_release_buffer ( minor , & out_buf ) ; //<S2SV> XDR_DESTROY ( & temp_xdrs ) ; //<S2SV> return TRUE ; //<S2SV> } //<S2SV> 