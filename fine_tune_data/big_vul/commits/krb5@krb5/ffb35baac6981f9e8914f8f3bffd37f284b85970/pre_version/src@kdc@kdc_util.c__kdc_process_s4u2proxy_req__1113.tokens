krb5_error_code //<S2SV> kdc_process_s4u2proxy_req ( kdc_realm_t * kdc_active_realm , //<S2SV> krb5_kdc_req * request , //<S2SV> const krb5_enc_tkt_part * t2enc , //<S2SV> const krb5_db_entry * server , //<S2SV> krb5_const_principal server_princ , //<S2SV> krb5_const_principal proxy_princ , //<S2SV> const char * * status ) //<S2SV> { //<S2SV> krb5_error_code errcode ; //<S2SV> if ( request -> kdc_options & ( NON_TGT_OPTION | KDC_OPT_ENC_TKT_IN_SKEY ) ) { //<S2SV> return KRB5KDC_ERR_BADOPTION ; //<S2SV> } //<S2SV> if ( ! krb5_principal_compare ( kdc_context , //<S2SV> server -> princ , //<S2SV> server_princ ) ) { //<S2SV> return KRB5KDC_ERR_SERVER_NOMATCH ; //<S2SV> } //<S2SV> if ( ! isflagset ( t2enc -> flags , TKT_FLG_FORWARDABLE ) ) { //<S2SV> * status = "EVIDENCE_TKT_NOT_FORWARDABLE" ; //<S2SV> return KRB5_TKT_NOT_FORWARDABLE ; //<S2SV> } //<S2SV> errcode = check_allowed_to_delegate_to ( kdc_context , //<S2SV> t2enc -> client , //<S2SV> server , //<S2SV> proxy_princ ) ; //<S2SV> if ( errcode ) { //<S2SV> * status = "NOT_ALLOWED_TO_DELEGATE" ; //<S2SV> return errcode ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 