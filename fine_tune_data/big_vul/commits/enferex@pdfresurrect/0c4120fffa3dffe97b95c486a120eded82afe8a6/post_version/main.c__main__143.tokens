int main ( int argc , char * * argv ) //<S2SV> { //<S2SV> int i , n_valid , do_write , do_scrub ; //<S2SV> char * c , * dname , * name ; //<S2SV> DIR * dir ; //<S2SV> FILE * fp ; //<S2SV> pdf_t * pdf ; //<S2SV> pdf_flag_t flags ; //<S2SV> if ( argc < 2 ) //<S2SV> usage ( ) ; //<S2SV> do_write = do_scrub = flags = 0 ; //<S2SV> name = NULL ; //<S2SV> for ( i = 1 ; i < argc ; i ++ ) //<S2SV> { //<S2SV> if ( strncmp ( argv [ i ] , "-w" , 2 ) == 0 ) //<S2SV> do_write = 1 ; //<S2SV> else if ( strncmp ( argv [ i ] , "-i" , 2 ) == 0 ) //<S2SV> flags |= PDF_FLAG_DISP_CREATOR ; //<S2SV> else if ( strncmp ( argv [ i ] , "-q" , 2 ) == 0 ) //<S2SV> flags |= PDF_FLAG_QUIET ; //<S2SV> else if ( strncmp ( argv [ i ] , "-s" , 2 ) == 0 ) //<S2SV> do_scrub = 1 ; //<S2SV> else if ( argv [ i ] [ 0 ] != '-' ) //<S2SV> name = argv [ i ] ; //<S2SV> else if ( argv [ i ] [ 0 ] == '-' ) //<S2SV> usage ( ) ; //<S2SV> } //<S2SV> if ( ! name ) //<S2SV> usage ( ) ; //<S2SV> if ( ! ( fp = fopen ( name , "r" ) ) ) //<S2SV> { //<S2SV> ERR ( "Could<S2SV_blank>not<S2SV_blank>open<S2SV_blank>file<S2SV_blank>\'%s\'\\n" , argv [ 1 ] ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> else if ( ! pdf_is_pdf ( fp ) ) //<S2SV> { //<S2SV> ERR ( "\'%s\'<S2SV_blank>specified<S2SV_blank>is<S2SV_blank>not<S2SV_blank>a<S2SV_blank>valid<S2SV_blank>PDF\\n" , name ) ; //<S2SV> fclose ( fp ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> if ( ! ( pdf = init_pdf ( fp , name ) ) ) //<S2SV> { //<S2SV> fclose ( fp ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> for ( i = 0 , n_valid = 0 ; i < pdf -> n_xrefs ; i ++ ) //<S2SV> if ( pdf -> xrefs [ i ] . version ) //<S2SV> ++ n_valid ; //<S2SV> if ( n_valid < 2 ) //<S2SV> { //<S2SV> if ( ! ( flags & ( PDF_FLAG_QUIET | PDF_FLAG_DISP_CREATOR ) ) ) //<S2SV> printf ( "%s:<S2SV_blank>There<S2SV_blank>is<S2SV_blank>only<S2SV_blank>one<S2SV_blank>version<S2SV_blank>of<S2SV_blank>this<S2SV_blank>PDF\\n" , pdf -> name ) ; //<S2SV> if ( do_write ) //<S2SV> { //<S2SV> fclose ( fp ) ; //<S2SV> pdf_delete ( pdf ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> } //<S2SV> dname = NULL ; //<S2SV> if ( do_write ) //<S2SV> { //<S2SV> if ( ( c = strrchr ( name , '/' ) ) ) //<S2SV> name = c + 1 ; //<S2SV> if ( ( c = strrchr ( name , '.' ) ) ) //<S2SV> * c = '\\0' ; //<S2SV> dname = safe_calloc ( strlen ( name ) + 16 ) ; //<S2SV> sprintf ( dname , "%s-versions" , name ) ; //<S2SV> if ( ! ( dir = opendir ( dname ) ) ) //<S2SV> mkdir ( dname , S_IRWXU ) ; //<S2SV> else //<S2SV> { //<S2SV> ERR ( "This<S2SV_blank>directory<S2SV_blank>already<S2SV_blank>exists,<S2SV_blank>PDF<S2SV_blank>version<S2SV_blank>extraction<S2SV_blank>will<S2SV_blank>" //<S2SV> "not<S2SV_blank>occur.\\n" ) ; //<S2SV> fclose ( fp ) ; //<S2SV> closedir ( dir ) ; //<S2SV> free ( dname ) ; //<S2SV> pdf_delete ( pdf ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> for ( i = 0 ; i < pdf -> n_xrefs ; i ++ ) //<S2SV> if ( pdf -> xrefs [ i ] . version ) //<S2SV> write_version ( fp , name , dname , & pdf -> xrefs [ i ] ) ; //<S2SV> } //<S2SV> pdf_summarize ( fp , pdf , dname , flags ) ; //<S2SV> if ( do_scrub ) //<S2SV> scrub_document ( fp , pdf ) ; //<S2SV> if ( flags & PDF_FLAG_DISP_CREATOR ) //<S2SV> display_creator ( fp , pdf ) ; //<S2SV> fclose ( fp ) ; //<S2SV> free ( dname ) ; //<S2SV> pdf_delete ( pdf ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 