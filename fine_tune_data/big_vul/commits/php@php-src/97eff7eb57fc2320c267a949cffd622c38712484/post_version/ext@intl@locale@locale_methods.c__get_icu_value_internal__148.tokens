static char * get_icu_value_internal ( const char * loc_name , char * tag_name , int * result , int fromParseLocale ) //<S2SV> { //<S2SV> char * tag_value = NULL ; //<S2SV> int32_t tag_value_len = 512 ; //<S2SV> int singletonPos = 0 ; //<S2SV> char * mod_loc_name = NULL ; //<S2SV> int grOffset = 0 ; //<S2SV> int32_t buflen = 512 ; //<S2SV> UErrorCode status = U_ZERO_ERROR ; //<S2SV> if ( strcmp ( tag_name , LOC_CANONICALIZE_TAG ) != 0 ) { //<S2SV> grOffset = findOffset ( LOC_GRANDFATHERED , loc_name ) ; //<S2SV> if ( grOffset >= 0 ) { //<S2SV> if ( strcmp ( tag_name , LOC_LANG_TAG ) == 0 ) { //<S2SV> return estrdup ( loc_name ) ; //<S2SV> } else { //<S2SV> return NULL ; //<S2SV> } //<S2SV> } //<S2SV> if ( fromParseLocale == 1 ) { //<S2SV> if ( strcmp ( tag_name , LOC_LANG_TAG ) == 0 ) { //<S2SV> if ( strlen ( loc_name ) > 1 && ( isIDPrefix ( loc_name ) == 1 ) ) { //<S2SV> return estrdup ( loc_name ) ; //<S2SV> } //<S2SV> } //<S2SV> singletonPos = getSingletonPos ( loc_name ) ; //<S2SV> if ( singletonPos == 0 ) { //<S2SV> return NULL ; //<S2SV> } else if ( singletonPos > 0 ) { //<S2SV> mod_loc_name = estrndup ( loc_name , singletonPos - 1 ) ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> if ( mod_loc_name == NULL ) { //<S2SV> mod_loc_name = estrdup ( loc_name ) ; //<S2SV> } //<S2SV> do { //<S2SV> tag_value = erealloc ( tag_value , buflen ) ; //<S2SV> tag_value_len = buflen ; //<S2SV> if ( strcmp ( tag_name , LOC_SCRIPT_TAG ) == 0 ) { //<S2SV> buflen = uloc_getScript ( mod_loc_name , tag_value , tag_value_len , & status ) ; //<S2SV> } //<S2SV> if ( strcmp ( tag_name , LOC_LANG_TAG ) == 0 ) { //<S2SV> buflen = uloc_getLanguage ( mod_loc_name , tag_value , tag_value_len , & status ) ; //<S2SV> } //<S2SV> if ( strcmp ( tag_name , LOC_REGION_TAG ) == 0 ) { //<S2SV> buflen = uloc_getCountry ( mod_loc_name , tag_value , tag_value_len , & status ) ; //<S2SV> } //<S2SV> if ( strcmp ( tag_name , LOC_VARIANT_TAG ) == 0 ) { //<S2SV> buflen = uloc_getVariant ( mod_loc_name , tag_value , tag_value_len , & status ) ; //<S2SV> } //<S2SV> if ( strcmp ( tag_name , LOC_CANONICALIZE_TAG ) == 0 ) { //<S2SV> buflen = uloc_canonicalize ( mod_loc_name , tag_value , tag_value_len , & status ) ; //<S2SV> } //<S2SV> if ( U_FAILURE ( status ) ) { //<S2SV> if ( status == U_BUFFER_OVERFLOW_ERROR ) { //<S2SV> status = U_ZERO_ERROR ; //<S2SV> buflen ++ ; //<S2SV> continue ; //<S2SV> } //<S2SV> * result = 0 ; //<S2SV> if ( tag_value ) { //<S2SV> efree ( tag_value ) ; //<S2SV> } //<S2SV> if ( mod_loc_name ) { //<S2SV> efree ( mod_loc_name ) ; //<S2SV> } //<S2SV> return NULL ; //<S2SV> } //<S2SV> } while ( buflen > tag_value_len ) ; //<S2SV> if ( buflen == 0 ) { //<S2SV> * result = - 1 ; //<S2SV> if ( tag_value ) { //<S2SV> efree ( tag_value ) ; //<S2SV> } //<S2SV> if ( mod_loc_name ) { //<S2SV> efree ( mod_loc_name ) ; //<S2SV> } //<S2SV> return NULL ; //<S2SV> } else { //<S2SV> * result = 1 ; //<S2SV> } //<S2SV> if ( mod_loc_name ) { //<S2SV> efree ( mod_loc_name ) ; //<S2SV> } //<S2SV> return tag_value ; //<S2SV> } //<S2SV> 