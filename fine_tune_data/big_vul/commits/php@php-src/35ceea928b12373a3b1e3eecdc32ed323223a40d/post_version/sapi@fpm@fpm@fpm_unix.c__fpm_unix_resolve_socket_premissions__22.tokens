int fpm_unix_resolve_socket_premissions ( struct fpm_worker_pool_s * wp ) //<S2SV> { //<S2SV> struct fpm_worker_pool_config_s * c = wp -> config ; //<S2SV> wp -> socket_uid = - 1 ; //<S2SV> wp -> socket_gid = - 1 ; //<S2SV> wp -> socket_mode = 0660 ; //<S2SV> if ( ! c ) { //<S2SV> return 0 ; //<S2SV> } //<S2SV> if ( c -> listen_owner && * c -> listen_owner ) { //<S2SV> struct passwd * pwd ; //<S2SV> pwd = getpwnam ( c -> listen_owner ) ; //<S2SV> if ( ! pwd ) { //<S2SV> zlog ( ZLOG_SYSERROR , "[pool<S2SV_blank>%s]<S2SV_blank>cannot<S2SV_blank>get<S2SV_blank>uid<S2SV_blank>for<S2SV_blank>user<S2SV_blank>\'%s\'" , wp -> config -> name , c -> listen_owner ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> wp -> socket_uid = pwd -> pw_uid ; //<S2SV> wp -> socket_gid = pwd -> pw_gid ; //<S2SV> } //<S2SV> if ( c -> listen_group && * c -> listen_group ) { //<S2SV> struct group * grp ; //<S2SV> grp = getgrnam ( c -> listen_group ) ; //<S2SV> if ( ! grp ) { //<S2SV> zlog ( ZLOG_SYSERROR , "[pool<S2SV_blank>%s]<S2SV_blank>cannot<S2SV_blank>get<S2SV_blank>gid<S2SV_blank>for<S2SV_blank>group<S2SV_blank>\'%s\'" , wp -> config -> name , c -> listen_group ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> wp -> socket_gid = grp -> gr_gid ; //<S2SV> } //<S2SV> if ( c -> listen_mode && * c -> listen_mode ) { //<S2SV> wp -> socket_mode = strtoul ( c -> listen_mode , 0 , 8 ) ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 