void gdImageFillToBorder ( gdImagePtr im , int x , int y , int border , int color ) //<S2SV> { //<S2SV> int lastBorder ; //<S2SV> int leftLimit = - 1 , rightLimit ; //<S2SV> int i , restoreAlphaBlending = 0 ; //<S2SV> if ( border < 0 || color < 0 ) { //<S2SV> return ; //<S2SV> } //<S2SV> if ( ! im -> trueColor ) { //<S2SV> if ( ( color > ( im -> colorsTotal - 1 ) ) || ( border > ( im -> colorsTotal - 1 ) ) || ( color < 0 ) ) { //<S2SV> return ; //<S2SV> } //<S2SV> } //<S2SV> restoreAlphaBlending = im -> alphaBlendingFlag ; //<S2SV> im -> alphaBlendingFlag = 0 ; //<S2SV> if ( x >= im -> sx ) { //<S2SV> x = im -> sx - 1 ; //<S2SV> } else if ( x < 0 ) { //<S2SV> x = 0 ; //<S2SV> } //<S2SV> if ( y >= im -> sy ) { //<S2SV> y = im -> sy - 1 ; //<S2SV> } else if ( y < 0 ) { //<S2SV> y = 0 ; //<S2SV> } //<S2SV> for ( i = x ; i >= 0 ; i -- ) { //<S2SV> if ( gdImageGetPixel ( im , i , y ) == border ) { //<S2SV> break ; //<S2SV> } //<S2SV> gdImageSetPixel ( im , i , y , color ) ; //<S2SV> leftLimit = i ; //<S2SV> } //<S2SV> if ( leftLimit == - 1 ) { //<S2SV> im -> alphaBlendingFlag = restoreAlphaBlending ; //<S2SV> return ; //<S2SV> } //<S2SV> rightLimit = x ; //<S2SV> for ( i = ( x + 1 ) ; i < im -> sx ; i ++ ) { //<S2SV> if ( gdImageGetPixel ( im , i , y ) == border ) { //<S2SV> break ; //<S2SV> } //<S2SV> gdImageSetPixel ( im , i , y , color ) ; //<S2SV> rightLimit = i ; //<S2SV> } //<S2SV> if ( y > 0 ) { //<S2SV> lastBorder = 1 ; //<S2SV> for ( i = leftLimit ; i <= rightLimit ; i ++ ) { //<S2SV> int c = gdImageGetPixel ( im , i , y - 1 ) ; //<S2SV> if ( lastBorder ) { //<S2SV> if ( ( c != border ) && ( c != color ) ) { //<S2SV> gdImageFillToBorder ( im , i , y - 1 , border , color ) ; //<S2SV> lastBorder = 0 ; //<S2SV> } //<S2SV> } else if ( ( c == border ) || ( c == color ) ) { //<S2SV> lastBorder = 1 ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> if ( y < ( ( im -> sy ) - 1 ) ) { //<S2SV> lastBorder = 1 ; //<S2SV> for ( i = leftLimit ; i <= rightLimit ; i ++ ) { //<S2SV> int c = gdImageGetPixel ( im , i , y + 1 ) ; //<S2SV> if ( lastBorder ) { //<S2SV> if ( ( c != border ) && ( c != color ) ) { //<S2SV> gdImageFillToBorder ( im , i , y + 1 , border , color ) ; //<S2SV> lastBorder = 0 ; //<S2SV> } //<S2SV> } else if ( ( c == border ) || ( c == color ) ) { //<S2SV> lastBorder = 1 ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> im -> alphaBlendingFlag = restoreAlphaBlending ; //<S2SV> } //<S2SV> 