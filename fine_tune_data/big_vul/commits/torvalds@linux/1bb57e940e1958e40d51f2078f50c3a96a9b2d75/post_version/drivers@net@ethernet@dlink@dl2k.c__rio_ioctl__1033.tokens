static int //<S2SV> rio_ioctl ( struct net_device * dev , struct ifreq * rq , int cmd ) //<S2SV> { //<S2SV> int phy_addr ; //<S2SV> struct netdev_private * np = netdev_priv ( dev ) ; //<S2SV> struct mii_ioctl_data * miidata = if_mii ( rq ) ; //<S2SV> phy_addr = np -> phy_addr ; //<S2SV> switch ( cmd ) { //<S2SV> case SIOCGMIIPHY : //<S2SV> miidata -> phy_id = phy_addr ; //<S2SV> break ; //<S2SV> case SIOCGMIIREG : //<S2SV> miidata -> val_out = mii_read ( dev , phy_addr , miidata -> reg_num ) ; //<S2SV> break ; //<S2SV> case SIOCSMIIREG : //<S2SV> if ( ! capable ( CAP_NET_ADMIN ) ) //<S2SV> return - EPERM ; //<S2SV> mii_write ( dev , phy_addr , miidata -> reg_num , miidata -> val_in ) ; //<S2SV> break ; //<S2SV> default : //<S2SV> return - EOPNOTSUPP ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 