static int //<S2SV> SMB2_sess_establish_session ( struct SMB2_sess_data * sess_data ) //<S2SV> { //<S2SV> int rc = 0 ; //<S2SV> struct cifs_ses * ses = sess_data -> ses ; //<S2SV> mutex_lock ( & ses -> server -> srv_mutex ) ; //<S2SV> if ( ses -> server -> ops -> generate_signingkey ) { //<S2SV> rc = ses -> server -> ops -> generate_signingkey ( ses ) ; //<S2SV> if ( rc ) { //<S2SV> cifs_dbg ( FYI , //<S2SV> "SMB3<S2SV_blank>session<S2SV_blank>key<S2SV_blank>generation<S2SV_blank>failed\\n" ) ; //<S2SV> mutex_unlock ( & ses -> server -> srv_mutex ) ; //<S2SV> return rc ; //<S2SV> } //<S2SV> } //<S2SV> if ( ! ses -> server -> session_estab ) { //<S2SV> ses -> server -> sequence_number = 0x2 ; //<S2SV> ses -> server -> session_estab = true ; //<S2SV> } //<S2SV> mutex_unlock ( & ses -> server -> srv_mutex ) ; //<S2SV> cifs_dbg ( FYI , "SMB2/3<S2SV_blank>session<S2SV_blank>established<S2SV_blank>successfully\\n" ) ; //<S2SV> spin_lock ( & GlobalMid_Lock ) ; //<S2SV> ses -> status = CifsGood ; //<S2SV> ses -> need_reconnect = false ; //<S2SV> spin_unlock ( & GlobalMid_Lock ) ; //<S2SV> return rc ; //<S2SV> } //<S2SV> 