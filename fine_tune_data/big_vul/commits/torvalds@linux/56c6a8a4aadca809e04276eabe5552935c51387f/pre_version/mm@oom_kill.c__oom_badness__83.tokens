unsigned int oom_badness ( struct task_struct * p , struct mem_cgroup * mem , //<S2SV> const nodemask_t * nodemask , unsigned long totalpages ) //<S2SV> { //<S2SV> int points ; //<S2SV> if ( oom_unkillable_task ( p , mem , nodemask ) ) //<S2SV> return 0 ; //<S2SV> p = find_lock_task_mm ( p ) ; //<S2SV> if ( ! p ) //<S2SV> return 0 ; //<S2SV> if ( atomic_read ( & p -> mm -> oom_disable_count ) ) { //<S2SV> task_unlock ( p ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> if ( ! totalpages ) //<S2SV> totalpages = 1 ; //<S2SV> points = get_mm_rss ( p -> mm ) + p -> mm -> nr_ptes ; //<S2SV> points += get_mm_counter ( p -> mm , MM_SWAPENTS ) ; //<S2SV> points *= 1000 ; //<S2SV> points /= totalpages ; //<S2SV> task_unlock ( p ) ; //<S2SV> if ( has_capability_noaudit ( p , CAP_SYS_ADMIN ) ) //<S2SV> points -= 30 ; //<S2SV> points += p -> signal -> oom_score_adj ; //<S2SV> if ( points <= 0 ) //<S2SV> return 1 ; //<S2SV> return ( points < 1000 ) ? points : 1000 ; //<S2SV> } //<S2SV> 