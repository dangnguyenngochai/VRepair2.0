static void mark_screen_rdonly ( struct mm_struct * mm ) //<S2SV> { //<S2SV> pgd_t * pgd ; //<S2SV> pud_t * pud ; //<S2SV> pmd_t * pmd ; //<S2SV> pte_t * pte ; //<S2SV> spinlock_t * ptl ; //<S2SV> int i ; //<S2SV> pgd = pgd_offset ( mm , 0xA0000 ) ; //<S2SV> if ( pgd_none_or_clear_bad ( pgd ) ) //<S2SV> goto out ; //<S2SV> pud = pud_offset ( pgd , 0xA0000 ) ; //<S2SV> if ( pud_none_or_clear_bad ( pud ) ) //<S2SV> goto out ; //<S2SV> pmd = pmd_offset ( pud , 0xA0000 ) ; //<S2SV> split_huge_page_pmd ( mm , pmd ) ; //<S2SV> if ( pmd_none_or_clear_bad ( pmd ) ) //<S2SV> goto out ; //<S2SV> pte = pte_offset_map_lock ( mm , pmd , 0xA0000 , & ptl ) ; //<S2SV> for ( i = 0 ; i < 32 ; i ++ ) { //<S2SV> if ( pte_present ( * pte ) ) //<S2SV> set_pte ( pte , pte_wrprotect ( * pte ) ) ; //<S2SV> pte ++ ; //<S2SV> } //<S2SV> pte_unmap_unlock ( pte , ptl ) ; //<S2SV> out : //<S2SV> flush_tlb ( ) ; //<S2SV> } //<S2SV> 