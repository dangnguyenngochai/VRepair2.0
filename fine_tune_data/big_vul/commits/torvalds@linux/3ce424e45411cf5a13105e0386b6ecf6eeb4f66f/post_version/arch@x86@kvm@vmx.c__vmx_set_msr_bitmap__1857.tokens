static void vmx_set_msr_bitmap ( struct kvm_vcpu * vcpu ) //<S2SV> { //<S2SV> unsigned long * msr_bitmap ; //<S2SV> if ( is_guest_mode ( vcpu ) ) //<S2SV> msr_bitmap = vmx_msr_bitmap_nested ; //<S2SV> else if ( cpu_has_secondary_exec_ctrls ( ) && //<S2SV> ( vmcs_read32 ( SECONDARY_VM_EXEC_CONTROL ) & //<S2SV> SECONDARY_EXEC_VIRTUALIZE_X2APIC_MODE ) ) { //<S2SV> if ( is_long_mode ( vcpu ) ) //<S2SV> msr_bitmap = vmx_msr_bitmap_longmode_x2apic ; //<S2SV> else //<S2SV> msr_bitmap = vmx_msr_bitmap_legacy_x2apic ; //<S2SV> } else { //<S2SV> if ( is_long_mode ( vcpu ) ) //<S2SV> msr_bitmap = vmx_msr_bitmap_longmode ; //<S2SV> else //<S2SV> msr_bitmap = vmx_msr_bitmap_legacy ; //<S2SV> } //<S2SV> vmcs_write64 ( MSR_BITMAP , __pa ( msr_bitmap ) ) ; //<S2SV> } //<S2SV> 