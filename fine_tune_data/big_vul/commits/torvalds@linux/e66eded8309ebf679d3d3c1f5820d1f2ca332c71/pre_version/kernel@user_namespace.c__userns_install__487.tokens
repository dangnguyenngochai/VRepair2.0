static int userns_install ( struct nsproxy * nsproxy , void * ns ) //<S2SV> { //<S2SV> struct user_namespace * user_ns = ns ; //<S2SV> struct cred * cred ; //<S2SV> if ( user_ns == current_user_ns ( ) ) //<S2SV> return - EINVAL ; //<S2SV> if ( atomic_read ( & current -> mm -> mm_users ) > 1 ) //<S2SV> return - EINVAL ; //<S2SV> if ( ! ns_capable ( user_ns , CAP_SYS_ADMIN ) ) //<S2SV> return - EPERM ; //<S2SV> cred = prepare_creds ( ) ; //<S2SV> if ( ! cred ) //<S2SV> return - ENOMEM ; //<S2SV> put_user_ns ( cred -> user_ns ) ; //<S2SV> set_cred_user_ns ( cred , get_user_ns ( user_ns ) ) ; //<S2SV> return commit_creds ( cred ) ; //<S2SV> } //<S2SV> 