STATIC int //<S2SV> xfs_attr_calc_size ( //<S2SV> struct xfs_inode * ip , //<S2SV> int namelen , //<S2SV> int valuelen , //<S2SV> int * local ) //<S2SV> { //<S2SV> struct xfs_mount * mp = ip -> i_mount ; //<S2SV> int size ; //<S2SV> int nblks ; //<S2SV> size = xfs_attr_leaf_newentsize ( namelen , valuelen , //<S2SV> mp -> m_sb . sb_blocksize , local ) ; //<S2SV> nblks = XFS_DAENTER_SPACE_RES ( mp , XFS_ATTR_FORK ) ; //<S2SV> if ( * local ) { //<S2SV> if ( size > ( mp -> m_sb . sb_blocksize >> 1 ) ) { //<S2SV> nblks *= 2 ; //<S2SV> } //<S2SV> } else { //<S2SV> uint dblocks = xfs_attr3_rmt_blocks ( mp , valuelen ) ; //<S2SV> nblks += dblocks ; //<S2SV> nblks += XFS_NEXTENTADD_SPACE_RES ( mp , dblocks , XFS_ATTR_FORK ) ; //<S2SV> } //<S2SV> return nblks ; //<S2SV> } //<S2SV> 