void __detach_mounts ( struct dentry * dentry ) //<S2SV> { //<S2SV> struct mountpoint * mp ; //<S2SV> struct mount * mnt ; //<S2SV> namespace_lock ( ) ; //<S2SV> mp = lookup_mountpoint ( dentry ) ; //<S2SV> if ( ! mp ) //<S2SV> goto out_unlock ; //<S2SV> lock_mount_hash ( ) ; //<S2SV> while ( ! hlist_empty ( & mp -> m_list ) ) { //<S2SV> mnt = hlist_entry ( mp -> m_list . first , struct mount , mnt_mp_list ) ; //<S2SV> if ( mnt -> mnt . mnt_flags & MNT_UMOUNT ) { //<S2SV> struct mount * p , * tmp ; //<S2SV> list_for_each_entry_safe ( p , tmp , & mnt -> mnt_mounts , mnt_child ) { //<S2SV> hlist_add_head ( & p -> mnt_umount . s_list , & unmounted ) ; //<S2SV> umount_mnt ( p ) ; //<S2SV> } //<S2SV> } //<S2SV> else umount_tree ( mnt , 0 ) ; //<S2SV> } //<S2SV> unlock_mount_hash ( ) ; //<S2SV> put_mountpoint ( mp ) ; //<S2SV> out_unlock : //<S2SV> namespace_unlock ( ) ; //<S2SV> } //<S2SV> 