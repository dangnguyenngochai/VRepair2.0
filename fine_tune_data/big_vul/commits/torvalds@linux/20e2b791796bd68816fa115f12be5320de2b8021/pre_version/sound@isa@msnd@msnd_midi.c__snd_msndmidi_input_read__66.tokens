void snd_msndmidi_input_read ( void * mpuv ) //<S2SV> { //<S2SV> unsigned long flags ; //<S2SV> struct snd_msndmidi * mpu = mpuv ; //<S2SV> void * pwMIDQData = mpu -> dev -> mappedbase + MIDQ_DATA_BUFF ; //<S2SV> spin_lock_irqsave ( & mpu -> input_lock , flags ) ; //<S2SV> while ( readw ( mpu -> dev -> MIDQ + JQS_wTail ) != //<S2SV> readw ( mpu -> dev -> MIDQ + JQS_wHead ) ) { //<S2SV> u16 wTmp , val ; //<S2SV> val = readw ( pwMIDQData + 2 * readw ( mpu -> dev -> MIDQ + JQS_wHead ) ) ; //<S2SV> if ( test_bit ( MSNDMIDI_MODE_BIT_INPUT_TRIGGER , //<S2SV> & mpu -> mode ) ) //<S2SV> snd_rawmidi_receive ( mpu -> substream_input , //<S2SV> ( unsigned char * ) & val , 1 ) ; //<S2SV> wTmp = readw ( mpu -> dev -> MIDQ + JQS_wHead ) + 1 ; //<S2SV> if ( wTmp > readw ( mpu -> dev -> MIDQ + JQS_wSize ) ) //<S2SV> writew ( 0 , mpu -> dev -> MIDQ + JQS_wHead ) ; //<S2SV> else //<S2SV> writew ( wTmp , mpu -> dev -> MIDQ + JQS_wHead ) ; //<S2SV> } //<S2SV> spin_unlock_irqrestore ( & mpu -> input_lock , flags ) ; //<S2SV> } //<S2SV> 