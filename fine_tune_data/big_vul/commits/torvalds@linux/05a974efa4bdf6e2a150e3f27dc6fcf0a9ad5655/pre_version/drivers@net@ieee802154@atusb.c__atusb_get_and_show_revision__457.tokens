static int atusb_get_and_show_revision ( struct atusb * atusb ) //<S2SV> { //<S2SV> struct usb_device * usb_dev = atusb -> usb_dev ; //<S2SV> unsigned char buffer [ 3 ] ; //<S2SV> int ret ; //<S2SV> ret = atusb_control_msg ( atusb , usb_rcvctrlpipe ( usb_dev , 0 ) , //<S2SV> ATUSB_ID , ATUSB_REQ_FROM_DEV , 0 , 0 , //<S2SV> buffer , 3 , 1000 ) ; //<S2SV> if ( ret >= 0 ) { //<S2SV> atusb -> fw_ver_maj = buffer [ 0 ] ; //<S2SV> atusb -> fw_ver_min = buffer [ 1 ] ; //<S2SV> atusb -> fw_hw_type = buffer [ 2 ] ; //<S2SV> dev_info ( & usb_dev -> dev , //<S2SV> "Firmware:<S2SV_blank>major:<S2SV_blank>%u,<S2SV_blank>minor:<S2SV_blank>%u,<S2SV_blank>hardware<S2SV_blank>type:<S2SV_blank>%u\\n" , //<S2SV> atusb -> fw_ver_maj , atusb -> fw_ver_min , atusb -> fw_hw_type ) ; //<S2SV> } //<S2SV> if ( atusb -> fw_ver_maj == 0 && atusb -> fw_ver_min < 2 ) { //<S2SV> dev_info ( & usb_dev -> dev , //<S2SV> "Firmware<S2SV_blank>version<S2SV_blank>(%u.%u)<S2SV_blank>predates<S2SV_blank>our<S2SV_blank>first<S2SV_blank>public<S2SV_blank>release." , //<S2SV> atusb -> fw_ver_maj , atusb -> fw_ver_min ) ; //<S2SV> dev_info ( & usb_dev -> dev , "Please<S2SV_blank>update<S2SV_blank>to<S2SV_blank>version<S2SV_blank>0.2<S2SV_blank>or<S2SV_blank>newer" ) ; //<S2SV> } //<S2SV> return ret ; //<S2SV> } //<S2SV> 