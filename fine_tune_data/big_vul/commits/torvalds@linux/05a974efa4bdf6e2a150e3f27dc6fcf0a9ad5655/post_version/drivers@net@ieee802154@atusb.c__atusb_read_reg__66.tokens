static int atusb_read_reg ( struct atusb * atusb , uint8_t reg ) //<S2SV> { //<S2SV> struct usb_device * usb_dev = atusb -> usb_dev ; //<S2SV> int ret ; //<S2SV> uint8_t * buffer ; //<S2SV> uint8_t value ; //<S2SV> buffer = kmalloc ( 1 , GFP_KERNEL ) ; //<S2SV> if ( ! buffer ) //<S2SV> return - ENOMEM ; //<S2SV> dev_dbg ( & usb_dev -> dev , "atusb:<S2SV_blank>reg<S2SV_blank>=<S2SV_blank>0x%x\\n" , reg ) ; //<S2SV> ret = atusb_control_msg ( atusb , usb_rcvctrlpipe ( usb_dev , 0 ) , //<S2SV> ATUSB_REG_READ , ATUSB_REQ_FROM_DEV , //<S2SV> 0 , reg , buffer , 1 , 1000 ) ; //<S2SV> if ( ret >= 0 ) { //<S2SV> value = buffer [ 0 ] ; //<S2SV> kfree ( buffer ) ; //<S2SV> return value ; //<S2SV> } else { //<S2SV> kfree ( buffer ) ; //<S2SV> return ret ; //<S2SV> } //<S2SV> } //<S2SV> 