int hugepage_madvise ( struct vm_area_struct * vma , //<S2SV> unsigned long * vm_flags , int advice ) //<S2SV> { //<S2SV> switch ( advice ) { //<S2SV> case MADV_HUGEPAGE : //<S2SV> if ( * vm_flags & ( VM_HUGEPAGE | //<S2SV> VM_SHARED | VM_MAYSHARE | //<S2SV> VM_PFNMAP | VM_IO | VM_DONTEXPAND | //<S2SV> VM_RESERVED | VM_HUGETLB | VM_INSERTPAGE | //<S2SV> VM_MIXEDMAP | VM_SAO ) ) //<S2SV> return - EINVAL ; //<S2SV> * vm_flags &= ~ VM_NOHUGEPAGE ; //<S2SV> * vm_flags |= VM_HUGEPAGE ; //<S2SV> if ( unlikely ( khugepaged_enter_vma_merge ( vma ) ) ) //<S2SV> return - ENOMEM ; //<S2SV> break ; //<S2SV> case MADV_NOHUGEPAGE : //<S2SV> if ( * vm_flags & ( VM_NOHUGEPAGE | //<S2SV> VM_SHARED | VM_MAYSHARE | //<S2SV> VM_PFNMAP | VM_IO | VM_DONTEXPAND | //<S2SV> VM_RESERVED | VM_HUGETLB | VM_INSERTPAGE | //<S2SV> VM_MIXEDMAP | VM_SAO ) ) //<S2SV> return - EINVAL ; //<S2SV> * vm_flags &= ~ VM_HUGEPAGE ; //<S2SV> * vm_flags |= VM_NOHUGEPAGE ; //<S2SV> break ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 