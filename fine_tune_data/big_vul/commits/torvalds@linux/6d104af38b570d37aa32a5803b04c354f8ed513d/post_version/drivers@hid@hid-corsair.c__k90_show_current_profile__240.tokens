static ssize_t k90_show_current_profile ( struct device * dev , //<S2SV> struct device_attribute * attr , //<S2SV> char * buf ) //<S2SV> { //<S2SV> int ret ; //<S2SV> struct usb_interface * usbif = to_usb_interface ( dev -> parent ) ; //<S2SV> struct usb_device * usbdev = interface_to_usbdev ( usbif ) ; //<S2SV> int current_profile ; //<S2SV> char * data ; //<S2SV> data = kmalloc ( 8 , GFP_KERNEL ) ; //<S2SV> if ( ! data ) //<S2SV> return - ENOMEM ; //<S2SV> ret = usb_control_msg ( usbdev , usb_rcvctrlpipe ( usbdev , 0 ) , //<S2SV> K90_REQUEST_STATUS , //<S2SV> USB_DIR_IN | USB_TYPE_VENDOR | //<S2SV> USB_RECIP_DEVICE , 0 , 0 , data , 8 , //<S2SV> USB_CTRL_SET_TIMEOUT ) ; //<S2SV> if ( ret < 0 ) { //<S2SV> dev_warn ( dev , "Failed<S2SV_blank>to<S2SV_blank>get<S2SV_blank>K90<S2SV_blank>initial<S2SV_blank>state<S2SV_blank>(error<S2SV_blank>%d).\\n" , //<S2SV> ret ) ; //<S2SV> ret = - EIO ; //<S2SV> goto out ; //<S2SV> } //<S2SV> current_profile = data [ 7 ] ; //<S2SV> if ( current_profile < 1 || current_profile > 3 ) { //<S2SV> dev_warn ( dev , "Read<S2SV_blank>invalid<S2SV_blank>current<S2SV_blank>profile:<S2SV_blank>%02hhx.\\n" , //<S2SV> data [ 7 ] ) ; //<S2SV> ret = - EIO ; //<S2SV> goto out ; //<S2SV> } //<S2SV> ret = snprintf ( buf , PAGE_SIZE , "%d\\n" , current_profile ) ; //<S2SV> out : //<S2SV> kfree ( data ) ; //<S2SV> return ret ; //<S2SV> } //<S2SV> 