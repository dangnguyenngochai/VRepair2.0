static int add_ballooned_pages ( int nr_pages ) //<S2SV> { //<S2SV> enum bp_state st ; //<S2SV> if ( xen_hotplug_unpopulated ) { //<S2SV> st = reserve_additional_memory ( ) ; //<S2SV> if ( st != BP_ECANCELED ) { //<S2SV> mutex_unlock ( & balloon_mutex ) ; //<S2SV> wait_event ( balloon_wq , //<S2SV> ! list_empty ( & ballooned_pages ) ) ; //<S2SV> mutex_lock ( & balloon_mutex ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> } //<S2SV> if ( si_mem_available ( ) < nr_pages ) //<S2SV> return - ENOMEM ; //<S2SV> st = decrease_reservation ( nr_pages , GFP_USER ) ; //<S2SV> if ( st != BP_DONE ) //<S2SV> return - ENOMEM ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 