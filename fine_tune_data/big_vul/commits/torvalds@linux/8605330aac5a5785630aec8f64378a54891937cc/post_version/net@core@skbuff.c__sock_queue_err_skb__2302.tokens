int sock_queue_err_skb ( struct sock * sk , struct sk_buff * skb ) //<S2SV> { //<S2SV> if ( atomic_read ( & sk -> sk_rmem_alloc ) + skb -> truesize >= //<S2SV> ( unsigned int ) sk -> sk_rcvbuf ) //<S2SV> return - ENOMEM ; //<S2SV> skb_orphan ( skb ) ; //<S2SV> skb -> sk = sk ; //<S2SV> skb -> destructor = sock_rmem_free ; //<S2SV> atomic_add ( skb -> truesize , & sk -> sk_rmem_alloc ) ; //<S2SV> skb_set_err_queue ( skb ) ; //<S2SV> skb_dst_force ( skb ) ; //<S2SV> skb_queue_tail ( & sk -> sk_error_queue , skb ) ; //<S2SV> if ( ! sock_flag ( sk , SOCK_DEAD ) ) //<S2SV> sk -> sk_data_ready ( sk ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 