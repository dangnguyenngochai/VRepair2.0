int utf8s_to_utf16s ( const u8 * s , int len , wchar_t * pwcs ) //<S2SV> { //<S2SV> u16 * op ; //<S2SV> int size ; //<S2SV> unicode_t u ; //<S2SV> op = pwcs ; //<S2SV> while ( * s && len > 0 ) { //<S2SV> if ( * s & 0x80 ) { //<S2SV> size = utf8_to_utf32 ( s , len , & u ) ; //<S2SV> if ( size < 0 ) //<S2SV> return - EINVAL ; //<S2SV> if ( u >= PLANE_SIZE ) { //<S2SV> u -= PLANE_SIZE ; //<S2SV> * op ++ = ( wchar_t ) ( SURROGATE_PAIR | //<S2SV> ( ( u >> 10 ) & SURROGATE_BITS ) ) ; //<S2SV> * op ++ = ( wchar_t ) ( SURROGATE_PAIR | //<S2SV> SURROGATE_LOW | //<S2SV> ( u & SURROGATE_BITS ) ) ; //<S2SV> } else { //<S2SV> * op ++ = ( wchar_t ) u ; //<S2SV> } //<S2SV> s += size ; //<S2SV> len -= size ; //<S2SV> } else { //<S2SV> * op ++ = * s ++ ; //<S2SV> len -- ; //<S2SV> } //<S2SV> } //<S2SV> return op - pwcs ; //<S2SV> } //<S2SV> 