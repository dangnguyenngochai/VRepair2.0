STATIC int //<S2SV> xfs_attr_shortform_addname ( xfs_da_args_t * args ) //<S2SV> { //<S2SV> int newsize , forkoff , retval ; //<S2SV> trace_xfs_attr_sf_addname ( args ) ; //<S2SV> retval = xfs_attr_shortform_lookup ( args ) ; //<S2SV> if ( ( args -> flags & ATTR_REPLACE ) && ( retval == - ENOATTR ) ) { //<S2SV> return retval ; //<S2SV> } else if ( retval == - EEXIST ) { //<S2SV> if ( args -> flags & ATTR_CREATE ) //<S2SV> return retval ; //<S2SV> retval = xfs_attr_shortform_remove ( args ) ; //<S2SV> ASSERT ( retval == 0 ) ; //<S2SV> } //<S2SV> if ( args -> namelen >= XFS_ATTR_SF_ENTSIZE_MAX || //<S2SV> args -> valuelen >= XFS_ATTR_SF_ENTSIZE_MAX ) //<S2SV> return - ENOSPC ; //<S2SV> newsize = XFS_ATTR_SF_TOTSIZE ( args -> dp ) ; //<S2SV> newsize += XFS_ATTR_SF_ENTSIZE_BYNAME ( args -> namelen , args -> valuelen ) ; //<S2SV> forkoff = xfs_attr_shortform_bytesfit ( args -> dp , newsize ) ; //<S2SV> if ( ! forkoff ) //<S2SV> return - ENOSPC ; //<S2SV> xfs_attr_shortform_add ( args , forkoff ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 