static int rfcomm_sock_recvmsg ( struct kiocb * iocb , struct socket * sock , //<S2SV> struct msghdr * msg , size_t size , int flags ) //<S2SV> { //<S2SV> struct sock * sk = sock -> sk ; //<S2SV> struct rfcomm_dlc * d = rfcomm_pi ( sk ) -> dlc ; //<S2SV> int len ; //<S2SV> if ( test_and_clear_bit ( RFCOMM_DEFER_SETUP , & d -> flags ) ) { //<S2SV> rfcomm_dlc_accept ( d ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> len = bt_sock_stream_recvmsg ( iocb , sock , msg , size , flags ) ; //<S2SV> lock_sock ( sk ) ; //<S2SV> if ( ! ( flags & MSG_PEEK ) && len > 0 ) //<S2SV> atomic_sub ( len , & sk -> sk_rmem_alloc ) ; //<S2SV> if ( atomic_read ( & sk -> sk_rmem_alloc ) <= ( sk -> sk_rcvbuf >> 2 ) ) //<S2SV> rfcomm_dlc_unthrottle ( rfcomm_pi ( sk ) -> dlc ) ; //<S2SV> release_sock ( sk ) ; //<S2SV> return len ; //<S2SV> } //<S2SV> 