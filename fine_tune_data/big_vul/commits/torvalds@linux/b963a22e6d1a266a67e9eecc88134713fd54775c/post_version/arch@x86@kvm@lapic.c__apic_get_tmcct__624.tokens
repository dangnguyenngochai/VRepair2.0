static u32 apic_get_tmcct ( struct kvm_lapic * apic ) //<S2SV> { //<S2SV> ktime_t remaining ; //<S2SV> s64 ns ; //<S2SV> u32 tmcct ; //<S2SV> ASSERT ( apic != NULL ) ; //<S2SV> if ( kvm_apic_get_reg ( apic , APIC_TMICT ) == 0 || //<S2SV> apic -> lapic_timer . period == 0 ) //<S2SV> return 0 ; //<S2SV> remaining = hrtimer_get_remaining ( & apic -> lapic_timer . timer ) ; //<S2SV> if ( ktime_to_ns ( remaining ) < 0 ) //<S2SV> remaining = ktime_set ( 0 , 0 ) ; //<S2SV> ns = mod_64 ( ktime_to_ns ( remaining ) , apic -> lapic_timer . period ) ; //<S2SV> tmcct = div64_u64 ( ns , //<S2SV> ( APIC_BUS_CYCLE_NS * apic -> divide_count ) ) ; //<S2SV> return tmcct ; //<S2SV> } //<S2SV> 