SYSCALL_DEFINE4 ( osf_wait4 , pid_t , pid , int __user * , ustatus , int , options , //<S2SV> struct rusage32 __user * , ur ) //<S2SV> { //<S2SV> struct rusage r ; //<S2SV> long ret , err ; //<S2SV> mm_segment_t old_fs ; //<S2SV> if ( ! ur ) //<S2SV> return sys_wait4 ( pid , ustatus , options , NULL ) ; //<S2SV> old_fs = get_fs ( ) ; //<S2SV> set_fs ( KERNEL_DS ) ; //<S2SV> ret = sys_wait4 ( pid , ustatus , options , ( struct rusage __user * ) & r ) ; //<S2SV> set_fs ( old_fs ) ; //<S2SV> if ( ! access_ok ( VERIFY_WRITE , ur , sizeof ( * ur ) ) ) //<S2SV> return - EFAULT ; //<S2SV> err = 0 ; //<S2SV> err |= __put_user ( r . ru_utime . tv_sec , & ur -> ru_utime . tv_sec ) ; //<S2SV> err |= __put_user ( r . ru_utime . tv_usec , & ur -> ru_utime . tv_usec ) ; //<S2SV> err |= __put_user ( r . ru_stime . tv_sec , & ur -> ru_stime . tv_sec ) ; //<S2SV> err |= __put_user ( r . ru_stime . tv_usec , & ur -> ru_stime . tv_usec ) ; //<S2SV> err |= __put_user ( r . ru_maxrss , & ur -> ru_maxrss ) ; //<S2SV> err |= __put_user ( r . ru_ixrss , & ur -> ru_ixrss ) ; //<S2SV> err |= __put_user ( r . ru_idrss , & ur -> ru_idrss ) ; //<S2SV> err |= __put_user ( r . ru_isrss , & ur -> ru_isrss ) ; //<S2SV> err |= __put_user ( r . ru_minflt , & ur -> ru_minflt ) ; //<S2SV> err |= __put_user ( r . ru_majflt , & ur -> ru_majflt ) ; //<S2SV> err |= __put_user ( r . ru_nswap , & ur -> ru_nswap ) ; //<S2SV> err |= __put_user ( r . ru_inblock , & ur -> ru_inblock ) ; //<S2SV> err |= __put_user ( r . ru_oublock , & ur -> ru_oublock ) ; //<S2SV> err |= __put_user ( r . ru_msgsnd , & ur -> ru_msgsnd ) ; //<S2SV> err |= __put_user ( r . ru_msgrcv , & ur -> ru_msgrcv ) ; //<S2SV> err |= __put_user ( r . ru_nsignals , & ur -> ru_nsignals ) ; //<S2SV> err |= __put_user ( r . ru_nvcsw , & ur -> ru_nvcsw ) ; //<S2SV> err |= __put_user ( r . ru_nivcsw , & ur -> ru_nivcsw ) ; //<S2SV> return err ? err : ret ; //<S2SV> } //<S2SV> 