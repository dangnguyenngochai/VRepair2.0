int snd_ctl_add ( struct snd_card * card , struct snd_kcontrol * kcontrol ) //<S2SV> { //<S2SV> struct snd_ctl_elem_id id ; //<S2SV> unsigned int idx ; //<S2SV> int err = - EINVAL ; //<S2SV> if ( ! kcontrol ) //<S2SV> return err ; //<S2SV> if ( snd_BUG_ON ( ! card || ! kcontrol -> info ) ) //<S2SV> goto error ; //<S2SV> id = kcontrol -> id ; //<S2SV> down_write ( & card -> controls_rwsem ) ; //<S2SV> if ( snd_ctl_find_id ( card , & id ) ) { //<S2SV> up_write ( & card -> controls_rwsem ) ; //<S2SV> dev_err ( card -> dev , "control<S2SV_blank>%i:%i:%i:%s:%i<S2SV_blank>is<S2SV_blank>already<S2SV_blank>present\\n" , //<S2SV> id . iface , //<S2SV> id . device , //<S2SV> id . subdevice , //<S2SV> id . name , //<S2SV> id . index ) ; //<S2SV> err = - EBUSY ; //<S2SV> goto error ; //<S2SV> } //<S2SV> if ( snd_ctl_find_hole ( card , kcontrol -> count ) < 0 ) { //<S2SV> up_write ( & card -> controls_rwsem ) ; //<S2SV> err = - ENOMEM ; //<S2SV> goto error ; //<S2SV> } //<S2SV> list_add_tail ( & kcontrol -> list , & card -> controls ) ; //<S2SV> card -> controls_count += kcontrol -> count ; //<S2SV> kcontrol -> id . numid = card -> last_numid + 1 ; //<S2SV> card -> last_numid += kcontrol -> count ; //<S2SV> up_write ( & card -> controls_rwsem ) ; //<S2SV> for ( idx = 0 ; idx < kcontrol -> count ; idx ++ , id . index ++ , id . numid ++ ) //<S2SV> snd_ctl_notify ( card , SNDRV_CTL_EVENT_MASK_ADD , & id ) ; //<S2SV> return 0 ; //<S2SV> error : //<S2SV> snd_ctl_free_one ( kcontrol ) ; //<S2SV> return err ; //<S2SV> } //<S2SV> 