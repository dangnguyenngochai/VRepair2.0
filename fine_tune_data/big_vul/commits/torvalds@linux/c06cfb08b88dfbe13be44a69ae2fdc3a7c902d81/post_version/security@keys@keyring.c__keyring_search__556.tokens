key_ref_t keyring_search ( key_ref_t keyring , //<S2SV> struct key_type * type , //<S2SV> const char * description ) //<S2SV> { //<S2SV> struct keyring_search_context ctx = { //<S2SV> . index_key . type = type , //<S2SV> . index_key . description = description , //<S2SV> . cred = current_cred ( ) , //<S2SV> . match_data . cmp = key_default_cmp , //<S2SV> . match_data . raw_data = description , //<S2SV> . match_data . lookup_type = KEYRING_SEARCH_LOOKUP_DIRECT , //<S2SV> . flags = KEYRING_SEARCH_DO_STATE_CHECK , //<S2SV> } ; //<S2SV> key_ref_t key ; //<S2SV> int ret ; //<S2SV> if ( type -> match_preparse ) { //<S2SV> ret = type -> match_preparse ( & ctx . match_data ) ; //<S2SV> if ( ret < 0 ) //<S2SV> return ERR_PTR ( ret ) ; //<S2SV> } //<S2SV> key = keyring_search_aux ( keyring , & ctx ) ; //<S2SV> if ( type -> match_free ) //<S2SV> type -> match_free ( & ctx . match_data ) ; //<S2SV> return key ; //<S2SV> } //<S2SV> 