static int unix_attach_fds ( struct scm_cookie * scm , struct sk_buff * skb ) //<S2SV> { //<S2SV> int i ; //<S2SV> unsigned char max_level = 0 ; //<S2SV> int unix_sock_count = 0 ; //<S2SV> if ( too_many_unix_fds ( current ) ) //<S2SV> return - ETOOMANYREFS ; //<S2SV> for ( i = scm -> fp -> count - 1 ; i >= 0 ; i -- ) { //<S2SV> struct sock * sk = unix_get_socket ( scm -> fp -> fp [ i ] ) ; //<S2SV> if ( sk ) { //<S2SV> unix_sock_count ++ ; //<S2SV> max_level = max ( max_level , //<S2SV> unix_sk ( sk ) -> recursion_level ) ; //<S2SV> } //<S2SV> } //<S2SV> if ( unlikely ( max_level > MAX_RECURSION_LEVEL ) ) //<S2SV> return - ETOOMANYREFS ; //<S2SV> UNIXCB ( skb ) . fp = scm_fp_dup ( scm -> fp ) ; //<S2SV> if ( ! UNIXCB ( skb ) . fp ) //<S2SV> return - ENOMEM ; //<S2SV> for ( i = scm -> fp -> count - 1 ; i >= 0 ; i -- ) //<S2SV> unix_inflight ( scm -> fp -> fp [ i ] ) ; //<S2SV> return max_level ; //<S2SV> } //<S2SV> 