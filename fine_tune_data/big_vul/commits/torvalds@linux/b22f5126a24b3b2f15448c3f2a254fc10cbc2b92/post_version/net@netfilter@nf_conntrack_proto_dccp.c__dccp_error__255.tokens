static int dccp_error ( struct net * net , struct nf_conn * tmpl , //<S2SV> struct sk_buff * skb , unsigned int dataoff , //<S2SV> enum ip_conntrack_info * ctinfo , //<S2SV> u_int8_t pf , unsigned int hooknum ) //<S2SV> { //<S2SV> struct dccp_hdr _dh , * dh ; //<S2SV> unsigned int dccp_len = skb -> len - dataoff ; //<S2SV> unsigned int cscov ; //<S2SV> const char * msg ; //<S2SV> dh = skb_header_pointer ( skb , dataoff , sizeof ( _dh ) , & _dh ) ; //<S2SV> if ( dh == NULL ) { //<S2SV> msg = "nf_ct_dccp:<S2SV_blank>short<S2SV_blank>packet<S2SV_blank>" ; //<S2SV> goto out_invalid ; //<S2SV> } //<S2SV> if ( dh -> dccph_doff * 4 < sizeof ( struct dccp_hdr ) || //<S2SV> dh -> dccph_doff * 4 > dccp_len ) { //<S2SV> msg = "nf_ct_dccp:<S2SV_blank>truncated/malformed<S2SV_blank>packet<S2SV_blank>" ; //<S2SV> goto out_invalid ; //<S2SV> } //<S2SV> cscov = dccp_len ; //<S2SV> if ( dh -> dccph_cscov ) { //<S2SV> cscov = ( dh -> dccph_cscov - 1 ) * 4 ; //<S2SV> if ( cscov > dccp_len ) { //<S2SV> msg = "nf_ct_dccp:<S2SV_blank>bad<S2SV_blank>checksum<S2SV_blank>coverage<S2SV_blank>" ; //<S2SV> goto out_invalid ; //<S2SV> } //<S2SV> } //<S2SV> if ( net -> ct . sysctl_checksum && hooknum == NF_INET_PRE_ROUTING && //<S2SV> nf_checksum_partial ( skb , hooknum , dataoff , cscov , IPPROTO_DCCP , //<S2SV> pf ) ) { //<S2SV> msg = "nf_ct_dccp:<S2SV_blank>bad<S2SV_blank>checksum<S2SV_blank>" ; //<S2SV> goto out_invalid ; //<S2SV> } //<S2SV> if ( dh -> dccph_type >= DCCP_PKT_INVALID ) { //<S2SV> msg = "nf_ct_dccp:<S2SV_blank>reserved<S2SV_blank>packet<S2SV_blank>type<S2SV_blank>" ; //<S2SV> goto out_invalid ; //<S2SV> } //<S2SV> return NF_ACCEPT ; //<S2SV> out_invalid : //<S2SV> if ( LOG_INVALID ( net , IPPROTO_DCCP ) ) //<S2SV> nf_log_packet ( net , pf , 0 , skb , NULL , NULL , NULL , "%s" , msg ) ; //<S2SV> return - NF_ACCEPT ; //<S2SV> } //<S2SV> 