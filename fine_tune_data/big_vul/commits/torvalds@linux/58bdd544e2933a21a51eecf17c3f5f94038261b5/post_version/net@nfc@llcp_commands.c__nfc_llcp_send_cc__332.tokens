int nfc_llcp_send_cc ( struct nfc_llcp_sock * sock ) //<S2SV> { //<S2SV> struct nfc_llcp_local * local ; //<S2SV> struct sk_buff * skb ; //<S2SV> u8 * miux_tlv = NULL , miux_tlv_length ; //<S2SV> u8 * rw_tlv = NULL , rw_tlv_length , rw ; //<S2SV> int err ; //<S2SV> u16 size = 0 ; //<S2SV> __be16 miux ; //<S2SV> pr_debug ( "Sending<S2SV_blank>CC\\n" ) ; //<S2SV> local = sock -> local ; //<S2SV> if ( local == NULL ) //<S2SV> return - ENODEV ; //<S2SV> miux = be16_to_cpu ( sock -> miux ) > LLCP_MAX_MIUX ? //<S2SV> local -> miux : sock -> miux ; //<S2SV> rw = sock -> rw > LLCP_MAX_RW ? local -> rw : sock -> rw ; //<S2SV> miux_tlv = nfc_llcp_build_tlv ( LLCP_TLV_MIUX , ( u8 * ) & miux , 0 , //<S2SV> & miux_tlv_length ) ; //<S2SV> if ( ! miux_tlv ) { //<S2SV> err = - ENOMEM ; //<S2SV> goto error_tlv ; //<S2SV> } //<S2SV> size += miux_tlv_length ; //<S2SV> rw_tlv = nfc_llcp_build_tlv ( LLCP_TLV_RW , & rw , 0 , & rw_tlv_length ) ; //<S2SV> if ( ! rw_tlv ) { //<S2SV> err = - ENOMEM ; //<S2SV> goto error_tlv ; //<S2SV> } //<S2SV> size += rw_tlv_length ; //<S2SV> skb = llcp_allocate_pdu ( sock , LLCP_PDU_CC , size ) ; //<S2SV> if ( skb == NULL ) { //<S2SV> err = - ENOMEM ; //<S2SV> goto error_tlv ; //<S2SV> } //<S2SV> llcp_add_tlv ( skb , miux_tlv , miux_tlv_length ) ; //<S2SV> llcp_add_tlv ( skb , rw_tlv , rw_tlv_length ) ; //<S2SV> skb_queue_tail ( & local -> tx_queue , skb ) ; //<S2SV> err = 0 ; //<S2SV> error_tlv : //<S2SV> if ( err ) //<S2SV> pr_err ( "error<S2SV_blank>%d\\n" , err ) ; //<S2SV> kfree ( miux_tlv ) ; //<S2SV> kfree ( rw_tlv ) ; //<S2SV> return err ; //<S2SV> } //<S2SV> 