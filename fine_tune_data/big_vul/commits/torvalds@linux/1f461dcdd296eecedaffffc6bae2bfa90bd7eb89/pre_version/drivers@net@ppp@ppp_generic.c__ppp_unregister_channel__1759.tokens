void //<S2SV> ppp_unregister_channel ( struct ppp_channel * chan ) //<S2SV> { //<S2SV> struct channel * pch = chan -> ppp ; //<S2SV> struct ppp_net * pn ; //<S2SV> if ( ! pch ) //<S2SV> return ; //<S2SV> chan -> ppp = NULL ; //<S2SV> down_write ( & pch -> chan_sem ) ; //<S2SV> spin_lock_bh ( & pch -> downl ) ; //<S2SV> pch -> chan = NULL ; //<S2SV> spin_unlock_bh ( & pch -> downl ) ; //<S2SV> up_write ( & pch -> chan_sem ) ; //<S2SV> ppp_disconnect_channel ( pch ) ; //<S2SV> pn = ppp_pernet ( pch -> chan_net ) ; //<S2SV> spin_lock_bh ( & pn -> all_channels_lock ) ; //<S2SV> list_del ( & pch -> list ) ; //<S2SV> spin_unlock_bh ( & pn -> all_channels_lock ) ; //<S2SV> pch -> file . dead = 1 ; //<S2SV> wake_up_interruptible ( & pch -> file . rwait ) ; //<S2SV> if ( atomic_dec_and_test ( & pch -> file . refcnt ) ) //<S2SV> ppp_destroy_channel ( pch ) ; //<S2SV> } //<S2SV> 