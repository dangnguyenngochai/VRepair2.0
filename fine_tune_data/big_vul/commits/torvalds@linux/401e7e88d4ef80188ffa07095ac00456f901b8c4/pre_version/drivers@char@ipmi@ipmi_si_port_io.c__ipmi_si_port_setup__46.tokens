int ipmi_si_port_setup ( struct si_sm_io * io ) //<S2SV> { //<S2SV> unsigned int addr = io -> addr_data ; //<S2SV> int idx ; //<S2SV> if ( ! addr ) //<S2SV> return - ENODEV ; //<S2SV> io -> io_cleanup = port_cleanup ; //<S2SV> switch ( io -> regsize ) { //<S2SV> case 1 : //<S2SV> io -> inputb = port_inb ; //<S2SV> io -> outputb = port_outb ; //<S2SV> break ; //<S2SV> case 2 : //<S2SV> io -> inputb = port_inw ; //<S2SV> io -> outputb = port_outw ; //<S2SV> break ; //<S2SV> case 4 : //<S2SV> io -> inputb = port_inl ; //<S2SV> io -> outputb = port_outl ; //<S2SV> break ; //<S2SV> default : //<S2SV> dev_warn ( io -> dev , "Invalid<S2SV_blank>register<S2SV_blank>size:<S2SV_blank>%d\\n" , //<S2SV> io -> regsize ) ; //<S2SV> return - EINVAL ; //<S2SV> } //<S2SV> for ( idx = 0 ; idx < io -> io_size ; idx ++ ) { //<S2SV> if ( request_region ( addr + idx * io -> regspacing , //<S2SV> io -> regsize , DEVICE_NAME ) == NULL ) { //<S2SV> while ( idx -- ) //<S2SV> release_region ( addr + idx * io -> regspacing , //<S2SV> io -> regsize ) ; //<S2SV> return - EIO ; //<S2SV> } //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 