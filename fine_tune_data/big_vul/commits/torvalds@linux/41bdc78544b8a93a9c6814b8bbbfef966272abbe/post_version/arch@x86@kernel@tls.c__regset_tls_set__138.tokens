int regset_tls_set ( struct task_struct * target , const struct user_regset * regset , //<S2SV> unsigned int pos , unsigned int count , //<S2SV> const void * kbuf , const void __user * ubuf ) //<S2SV> { //<S2SV> struct user_desc infobuf [ GDT_ENTRY_TLS_ENTRIES ] ; //<S2SV> const struct user_desc * info ; //<S2SV> int i ; //<S2SV> if ( pos >= GDT_ENTRY_TLS_ENTRIES * sizeof ( struct user_desc ) || //<S2SV> ( pos % sizeof ( struct user_desc ) ) != 0 || //<S2SV> ( count % sizeof ( struct user_desc ) ) != 0 ) //<S2SV> return - EINVAL ; //<S2SV> if ( kbuf ) //<S2SV> info = kbuf ; //<S2SV> else if ( __copy_from_user ( infobuf , ubuf , count ) ) //<S2SV> return - EFAULT ; //<S2SV> else //<S2SV> info = infobuf ; //<S2SV> for ( i = 0 ; i < count / sizeof ( struct user_desc ) ; i ++ ) //<S2SV> if ( ! tls_desc_okay ( info + i ) ) //<S2SV> return - EINVAL ; //<S2SV> set_tls_desc ( target , //<S2SV> GDT_ENTRY_TLS_MIN + ( pos / sizeof ( struct user_desc ) ) , //<S2SV> info , count / sizeof ( struct user_desc ) ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 