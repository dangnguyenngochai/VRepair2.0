int do_set_thread_area ( struct task_struct * p , int idx , //<S2SV> struct user_desc __user * u_info , //<S2SV> int can_allocate ) //<S2SV> { //<S2SV> struct user_desc info ; //<S2SV> if ( copy_from_user ( & info , u_info , sizeof ( info ) ) ) //<S2SV> return - EFAULT ; //<S2SV> if ( idx == - 1 ) //<S2SV> idx = info . entry_number ; //<S2SV> if ( idx == - 1 && can_allocate ) { //<S2SV> idx = get_free_idx ( ) ; //<S2SV> if ( idx < 0 ) //<S2SV> return idx ; //<S2SV> if ( put_user ( idx , & u_info -> entry_number ) ) //<S2SV> return - EFAULT ; //<S2SV> } //<S2SV> if ( idx < GDT_ENTRY_TLS_MIN || idx > GDT_ENTRY_TLS_MAX ) //<S2SV> return - EINVAL ; //<S2SV> set_tls_desc ( p , idx , & info , 1 ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 