static int encrypt ( struct blkcipher_desc * desc , //<S2SV> struct scatterlist * dst , struct scatterlist * src , //<S2SV> unsigned int nbytes ) //<S2SV> { //<S2SV> struct blkcipher_walk walk ; //<S2SV> struct crypto_blkcipher * tfm = desc -> tfm ; //<S2SV> struct salsa20_ctx * ctx = crypto_blkcipher_ctx ( tfm ) ; //<S2SV> int err ; //<S2SV> blkcipher_walk_init ( & walk , dst , src , nbytes ) ; //<S2SV> err = blkcipher_walk_virt_block ( desc , & walk , 64 ) ; //<S2SV> salsa20_ivsetup ( ctx , walk . iv ) ; //<S2SV> while ( walk . nbytes >= 64 ) { //<S2SV> salsa20_encrypt_bytes ( ctx , walk . dst . virt . addr , //<S2SV> walk . src . virt . addr , //<S2SV> walk . nbytes - ( walk . nbytes % 64 ) ) ; //<S2SV> err = blkcipher_walk_done ( desc , & walk , walk . nbytes % 64 ) ; //<S2SV> } //<S2SV> if ( walk . nbytes ) { //<S2SV> salsa20_encrypt_bytes ( ctx , walk . dst . virt . addr , //<S2SV> walk . src . virt . addr , walk . nbytes ) ; //<S2SV> err = blkcipher_walk_done ( desc , & walk , 0 ) ; //<S2SV> } //<S2SV> return err ; //<S2SV> } //<S2SV> 