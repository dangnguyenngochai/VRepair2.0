static int pppol2tp_recvmsg ( struct kiocb * iocb , struct socket * sock , //<S2SV> struct msghdr * msg , size_t len , //<S2SV> int flags ) //<S2SV> { //<S2SV> int err ; //<S2SV> struct sk_buff * skb ; //<S2SV> struct sock * sk = sock -> sk ; //<S2SV> err = - EIO ; //<S2SV> if ( sk -> sk_state & PPPOX_BOUND ) //<S2SV> goto end ; //<S2SV> msg -> msg_namelen = 0 ; //<S2SV> err = 0 ; //<S2SV> skb = skb_recv_datagram ( sk , flags & ~ MSG_DONTWAIT , //<S2SV> flags & MSG_DONTWAIT , & err ) ; //<S2SV> if ( ! skb ) //<S2SV> goto end ; //<S2SV> if ( len > skb -> len ) //<S2SV> len = skb -> len ; //<S2SV> else if ( len < skb -> len ) //<S2SV> msg -> msg_flags |= MSG_TRUNC ; //<S2SV> err = skb_copy_datagram_iovec ( skb , 0 , msg -> msg_iov , len ) ; //<S2SV> if ( likely ( err == 0 ) ) //<S2SV> err = len ; //<S2SV> kfree_skb ( skb ) ; //<S2SV> end : //<S2SV> return err ; //<S2SV> } //<S2SV> 