static int pppoe_recvmsg ( struct kiocb * iocb , struct socket * sock , //<S2SV> struct msghdr * m , size_t total_len , int flags ) //<S2SV> { //<S2SV> struct sock * sk = sock -> sk ; //<S2SV> struct sk_buff * skb ; //<S2SV> int error = 0 ; //<S2SV> if ( sk -> sk_state & PPPOX_BOUND ) { //<S2SV> error = - EIO ; //<S2SV> goto end ; //<S2SV> } //<S2SV> skb = skb_recv_datagram ( sk , flags & ~ MSG_DONTWAIT , //<S2SV> flags & MSG_DONTWAIT , & error ) ; //<S2SV> if ( error < 0 ) //<S2SV> goto end ; //<S2SV> if ( skb ) { //<S2SV> total_len = min_t ( size_t , total_len , skb -> len ) ; //<S2SV> error = skb_copy_datagram_iovec ( skb , 0 , m -> msg_iov , total_len ) ; //<S2SV> if ( error == 0 ) { //<S2SV> consume_skb ( skb ) ; //<S2SV> return total_len ; //<S2SV> } //<S2SV> } //<S2SV> kfree_skb ( skb ) ; //<S2SV> end : //<S2SV> return error ; //<S2SV> } //<S2SV> 