static int rawsock_recvmsg ( struct kiocb * iocb , struct socket * sock , //<S2SV> struct msghdr * msg , size_t len , int flags ) //<S2SV> { //<S2SV> int noblock = flags & MSG_DONTWAIT ; //<S2SV> struct sock * sk = sock -> sk ; //<S2SV> struct sk_buff * skb ; //<S2SV> int copied ; //<S2SV> int rc ; //<S2SV> pr_debug ( "sock=%p<S2SV_blank>sk=%p<S2SV_blank>len=%zu<S2SV_blank>flags=%d\\n" , sock , sk , len , flags ) ; //<S2SV> skb = skb_recv_datagram ( sk , flags , noblock , & rc ) ; //<S2SV> if ( ! skb ) //<S2SV> return rc ; //<S2SV> copied = skb -> len ; //<S2SV> if ( len < copied ) { //<S2SV> msg -> msg_flags |= MSG_TRUNC ; //<S2SV> copied = len ; //<S2SV> } //<S2SV> rc = skb_copy_datagram_iovec ( skb , 0 , msg -> msg_iov , copied ) ; //<S2SV> skb_free_datagram ( sk , skb ) ; //<S2SV> return rc ? : copied ; //<S2SV> } //<S2SV> 