static int dn_create ( struct net * net , struct socket * sock , int protocol , //<S2SV> int kern ) //<S2SV> { //<S2SV> struct sock * sk ; //<S2SV> if ( ! net_eq ( net , & init_net ) ) //<S2SV> return - EAFNOSUPPORT ; //<S2SV> switch ( sock -> type ) { //<S2SV> case SOCK_SEQPACKET : //<S2SV> if ( protocol != DNPROTO_NSP ) //<S2SV> return - EPROTONOSUPPORT ; //<S2SV> break ; //<S2SV> case SOCK_STREAM : //<S2SV> break ; //<S2SV> default : //<S2SV> return - ESOCKTNOSUPPORT ; //<S2SV> } //<S2SV> if ( ( sk = dn_alloc_sock ( net , sock , GFP_KERNEL , kern ) ) == NULL ) //<S2SV> return - ENOBUFS ; //<S2SV> sk -> sk_protocol = protocol ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 