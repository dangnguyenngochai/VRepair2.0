static bool new_idmap_permitted ( const struct file * file , //<S2SV> struct user_namespace * ns , int cap_setid , //<S2SV> struct uid_gid_map * new_map ) //<S2SV> { //<S2SV> if ( ( new_map -> nr_extents == 1 ) && ( new_map -> extent [ 0 ] . count == 1 ) ) { //<S2SV> u32 id = new_map -> extent [ 0 ] . lower_first ; //<S2SV> if ( cap_setid == CAP_SETUID ) { //<S2SV> kuid_t uid = make_kuid ( ns -> parent , id ) ; //<S2SV> if ( uid_eq ( uid , current_fsuid ( ) ) ) //<S2SV> return true ; //<S2SV> } //<S2SV> else if ( cap_setid == CAP_SETGID ) { //<S2SV> kgid_t gid = make_kgid ( ns -> parent , id ) ; //<S2SV> if ( gid_eq ( gid , current_fsgid ( ) ) ) //<S2SV> return true ; //<S2SV> } //<S2SV> } //<S2SV> if ( ! cap_valid ( cap_setid ) ) //<S2SV> return true ; //<S2SV> if ( ns_capable ( ns -> parent , cap_setid ) && //<S2SV> file_ns_capable ( file , ns -> parent , cap_setid ) ) //<S2SV> return true ; //<S2SV> return false ; //<S2SV> } //<S2SV> 