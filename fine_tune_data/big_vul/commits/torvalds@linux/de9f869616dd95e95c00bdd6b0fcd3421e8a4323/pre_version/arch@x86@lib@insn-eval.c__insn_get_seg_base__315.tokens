unsigned long insn_get_seg_base ( struct pt_regs * regs , int seg_reg_idx ) //<S2SV> { //<S2SV> struct desc_struct * desc ; //<S2SV> short sel ; //<S2SV> sel = get_segment_selector ( regs , seg_reg_idx ) ; //<S2SV> if ( sel < 0 ) //<S2SV> return - 1L ; //<S2SV> if ( v8086_mode ( regs ) ) //<S2SV> return ( unsigned long ) ( sel << 4 ) ; //<S2SV> if ( user_64bit_mode ( regs ) ) { //<S2SV> unsigned long base ; //<S2SV> if ( seg_reg_idx == INAT_SEG_REG_FS ) //<S2SV> rdmsrl ( MSR_FS_BASE , base ) ; //<S2SV> else if ( seg_reg_idx == INAT_SEG_REG_GS ) //<S2SV> rdmsrl ( MSR_KERNEL_GS_BASE , base ) ; //<S2SV> else //<S2SV> base = 0 ; //<S2SV> return base ; //<S2SV> } //<S2SV> if ( ! sel ) //<S2SV> return - 1L ; //<S2SV> desc = get_desc ( sel ) ; //<S2SV> if ( ! desc ) //<S2SV> return - 1L ; //<S2SV> return get_desc_base ( desc ) ; //<S2SV> } //<S2SV> 