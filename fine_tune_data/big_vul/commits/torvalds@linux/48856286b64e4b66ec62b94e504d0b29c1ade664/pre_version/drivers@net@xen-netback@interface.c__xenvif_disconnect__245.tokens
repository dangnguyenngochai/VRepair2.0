void xenvif_disconnect ( struct xenvif * vif ) //<S2SV> { //<S2SV> struct net_device * dev = vif -> dev ; //<S2SV> if ( netif_carrier_ok ( dev ) ) { //<S2SV> rtnl_lock ( ) ; //<S2SV> netif_carrier_off ( dev ) ; //<S2SV> if ( netif_running ( dev ) ) //<S2SV> xenvif_down ( vif ) ; //<S2SV> rtnl_unlock ( ) ; //<S2SV> xenvif_put ( vif ) ; //<S2SV> } //<S2SV> atomic_dec ( & vif -> refcnt ) ; //<S2SV> wait_event ( vif -> waiting_to_free , atomic_read ( & vif -> refcnt ) == 0 ) ; //<S2SV> del_timer_sync ( & vif -> credit_timeout ) ; //<S2SV> if ( vif -> irq ) //<S2SV> unbind_from_irqhandler ( vif -> irq , vif ) ; //<S2SV> unregister_netdev ( vif -> dev ) ; //<S2SV> xen_netbk_unmap_frontend_rings ( vif ) ; //<S2SV> free_netdev ( vif -> dev ) ; //<S2SV> } //<S2SV> 