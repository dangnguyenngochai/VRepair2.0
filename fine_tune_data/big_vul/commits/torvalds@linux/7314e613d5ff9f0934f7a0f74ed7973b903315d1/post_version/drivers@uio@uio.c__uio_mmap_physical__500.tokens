static int uio_mmap_physical ( struct vm_area_struct * vma ) //<S2SV> { //<S2SV> struct uio_device * idev = vma -> vm_private_data ; //<S2SV> int mi = uio_find_mem_index ( vma ) ; //<S2SV> struct uio_mem * mem ; //<S2SV> if ( mi < 0 ) //<S2SV> return - EINVAL ; //<S2SV> mem = idev -> info -> mem + mi ; //<S2SV> if ( vma -> vm_end - vma -> vm_start > mem -> size ) //<S2SV> return - EINVAL ; //<S2SV> vma -> vm_ops = & uio_physical_vm_ops ; //<S2SV> vma -> vm_page_prot = pgprot_noncached ( vma -> vm_page_prot ) ; //<S2SV> return remap_pfn_range ( vma , //<S2SV> vma -> vm_start , //<S2SV> mem -> addr >> PAGE_SHIFT , //<S2SV> vma -> vm_end - vma -> vm_start , //<S2SV> vma -> vm_page_prot ) ; //<S2SV> } //<S2SV> 