char * suhosin_decrypt_single_cookie ( char * name , int name_len , char * value , int value_len , char * key , char * * where TSRMLS_DC ) //<S2SV> { //<S2SV> int o_name_len = name_len ; //<S2SV> char * buf , * buf2 , * d , * d_url ; //<S2SV> int l ; //<S2SV> buf = estrndup ( name , name_len ) ; //<S2SV> name_len = php_url_decode ( buf , name_len ) ; //<S2SV> normalize_varname ( buf ) ; //<S2SV> name_len = strlen ( buf ) ; //<S2SV> if ( SUHOSIN_G ( cookie_plainlist ) ) { //<S2SV> if ( zend_hash_exists ( SUHOSIN_G ( cookie_plainlist ) , buf , name_len + 1 ) ) { //<S2SV> decrypt_return_plain : //<S2SV> efree ( buf ) ; //<S2SV> memcpy ( * where , name , o_name_len ) ; //<S2SV> * where += o_name_len ; //<S2SV> * * where = '=' ; * where += 1 ; //<S2SV> memcpy ( * where , value , value_len ) ; //<S2SV> * where += value_len ; //<S2SV> return * where ; //<S2SV> } //<S2SV> } else if ( SUHOSIN_G ( cookie_cryptlist ) ) { //<S2SV> if ( ! zend_hash_exists ( SUHOSIN_G ( cookie_cryptlist ) , buf , name_len + 1 ) ) { //<S2SV> goto decrypt_return_plain ; //<S2SV> } //<S2SV> } //<S2SV> buf2 = estrndup ( value , value_len ) ; //<S2SV> value_len = php_url_decode ( buf2 , value_len ) ; //<S2SV> d = suhosin_decrypt_string ( buf2 , value_len , buf , name_len , key , & l , SUHOSIN_G ( cookie_checkraddr ) TSRMLS_CC ) ; //<S2SV> if ( d == NULL ) { //<S2SV> goto skip_cookie ; //<S2SV> } //<S2SV> d_url = php_url_encode ( d , l , & l ) ; //<S2SV> efree ( d ) ; //<S2SV> memcpy ( * where , name , o_name_len ) ; //<S2SV> * where += o_name_len ; //<S2SV> * * where = '=' ; * where += 1 ; //<S2SV> memcpy ( * where , d_url , l ) ; //<S2SV> * where += l ; //<S2SV> efree ( d_url ) ; //<S2SV> skip_cookie : //<S2SV> efree ( buf ) ; //<S2SV> efree ( buf2 ) ; //<S2SV> return * where ; //<S2SV> } //<S2SV> 