static void start_auth_request ( PgSocket * client , const char * username ) //<S2SV> { //<S2SV> int res ; //<S2SV> PktBuf * buf ; //<S2SV> client -> pool = get_pool ( client -> db , client -> db -> auth_user ) ; //<S2SV> if ( ! find_server ( client ) ) { //<S2SV> client -> wait_for_user_conn = true ; //<S2SV> return ; //<S2SV> } //<S2SV> slog_noise ( client , "Doing<S2SV_blank>auth_conn<S2SV_blank>query" ) ; //<S2SV> client -> wait_for_user_conn = false ; //<S2SV> client -> wait_for_user = true ; //<S2SV> if ( ! sbuf_pause ( & client -> sbuf ) ) { //<S2SV> release_server ( client -> link ) ; //<S2SV> disconnect_client ( client , true , "pause<S2SV_blank>failed" ) ; //<S2SV> return ; //<S2SV> } //<S2SV> client -> link -> ready = 0 ; //<S2SV> res = 0 ; //<S2SV> buf = pktbuf_dynamic ( 512 ) ; //<S2SV> if ( buf ) { //<S2SV> pktbuf_write_ExtQuery ( buf , cf_auth_query , 1 , username ) ; //<S2SV> res = pktbuf_send_immediate ( buf , client -> link ) ; //<S2SV> pktbuf_free ( buf ) ; //<S2SV> } //<S2SV> if ( ! res ) //<S2SV> disconnect_server ( client -> link , false , "unable<S2SV_blank>to<S2SV_blank>send<S2SV_blank>login<S2SV_blank>query" ) ; //<S2SV> } //<S2SV> 