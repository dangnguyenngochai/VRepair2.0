static int r_core_cmd_subst_i ( RCore * core , char * cmd , char * colon , bool * tmpseek ) { //<S2SV> RList * tmpenvs = r_list_newf ( tmpenvs_free ) ; //<S2SV> const char * quotestr = "`" ; //<S2SV> const char * tick = NULL ; //<S2SV> char * ptr , * ptr2 , * str ; //<S2SV> char * arroba = NULL ; //<S2SV> char * grep = NULL ; //<S2SV> RIODesc * tmpdesc = NULL ; //<S2SV> int pamode = ! core -> io -> va ; //<S2SV> int i , ret = 0 , pipefd ; //<S2SV> bool usemyblock = false ; //<S2SV> int scr_html = - 1 ; //<S2SV> int scr_color = - 1 ; //<S2SV> bool eos = false ; //<S2SV> bool haveQuote = false ; //<S2SV> bool oldfixedarch = core -> fixedarch ; //<S2SV> bool oldfixedbits = core -> fixedbits ; //<S2SV> bool cmd_tmpseek = false ; //<S2SV> ut64 tmpbsz = core -> blocksize ; //<S2SV> int cmd_ignbithints = - 1 ; //<S2SV> if ( ! cmd ) { //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> cmd = r_str_trim_head_tail ( cmd ) ; //<S2SV> char * $0 = strstr ( cmd , "$(" ) ; //<S2SV> if ( $0 ) { //<S2SV> char * $1 = strchr ( $0 + 2 , ')' ) ; //<S2SV> if ( $1 ) { //<S2SV> * $0 = '`' ; //<S2SV> * $1 = '`' ; //<S2SV> memmove ( $0 + 1 , $0 + 2 , strlen ( $0 + 2 ) + 1 ) ; //<S2SV> } else { //<S2SV> eprintf ( "Unterminated<S2SV_blank>$()<S2SV_blank>block\\n" ) ; //<S2SV> } //<S2SV> } //<S2SV> switch ( * cmd ) { //<S2SV> case '.' : //<S2SV> if ( cmd [ 1 ] == \'"\' ) { //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return r_cmd_call ( core -> rcmd , cmd ) ; //<S2SV> } //<S2SV> break ; //<S2SV> case \'"\' : //<S2SV> for ( ; * cmd ; ) { //<S2SV> int pipefd = - 1 ; //<S2SV> ut64 oseek = UT64_MAX ; //<S2SV> char * line , * p ; //<S2SV> haveQuote = * cmd == \'"\' ; //<S2SV> if ( haveQuote ) { //<S2SV> cmd ++ ; //<S2SV> p = * cmd ? find_eoq ( cmd ) : NULL ; //<S2SV> if ( ! p || ! * p ) { //<S2SV> eprintf ( "Missing<S2SV_blank>\\"<S2SV_blank>in<S2SV_blank>(%s)." , cmd ) ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return false ; //<S2SV> } //<S2SV> * p ++ = 0 ; //<S2SV> if ( ! * p ) { //<S2SV> eos = true ; //<S2SV> } //<S2SV> } else { //<S2SV> char * sc = strchr ( cmd , ';' ) ; //<S2SV> if ( sc ) { //<S2SV> * sc = 0 ; //<S2SV> } //<S2SV> r_core_cmd0 ( core , cmd ) ; //<S2SV> if ( ! sc ) { //<S2SV> break ; //<S2SV> } //<S2SV> cmd = sc + 1 ; //<S2SV> continue ; //<S2SV> } //<S2SV> if ( * p ) { //<S2SV> if ( p [ 0 ] == '@' ) { //<S2SV> p -- ; //<S2SV> } //<S2SV> while ( p [ 1 ] == ';' || IS_WHITESPACE ( p [ 1 ] ) ) { //<S2SV> p ++ ; //<S2SV> } //<S2SV> if ( p [ 1 ] == '@' || ( p [ 1 ] && p [ 2 ] == '@' ) ) { //<S2SV> char * q = strchr ( p + 1 , \'"\' ) ; //<S2SV> if ( q ) { //<S2SV> * q = 0 ; //<S2SV> } //<S2SV> haveQuote = q != NULL ; //<S2SV> oseek = core -> offset ; //<S2SV> r_core_seek ( core , r_num_math ( core -> num , p + 2 ) , 1 ) ; //<S2SV> if ( q ) { //<S2SV> * p = \'"\' ; //<S2SV> p = q ; //<S2SV> } else { //<S2SV> p = strchr ( p + 1 , ';' ) ; //<S2SV> } //<S2SV> } //<S2SV> if ( p && * p && p [ 1 ] == '>' ) { //<S2SV> str = p + 2 ; //<S2SV> while ( * str == '>' ) { //<S2SV> str ++ ; //<S2SV> } //<S2SV> str = ( char * ) r_str_trim_ro ( str ) ; //<S2SV> r_cons_flush ( ) ; //<S2SV> const bool append = p [ 2 ] == '>' ; //<S2SV> pipefd = r_cons_pipe_open ( str , 1 , append ) ; //<S2SV> } //<S2SV> } //<S2SV> line = strdup ( cmd ) ; //<S2SV> line = r_str_replace ( line , "\\\\\\"" , "\\"" , true ) ; //<S2SV> if ( p && * p && p [ 1 ] == '|' ) { //<S2SV> str = p + 2 ; //<S2SV> while ( IS_WHITESPACE ( * str ) ) { //<S2SV> str ++ ; //<S2SV> } //<S2SV> r_core_cmd_pipe ( core , cmd , str ) ; //<S2SV> } else { //<S2SV> r_cmd_call ( core -> rcmd , line ) ; //<S2SV> } //<S2SV> free ( line ) ; //<S2SV> if ( oseek != UT64_MAX ) { //<S2SV> r_core_seek ( core , oseek , 1 ) ; //<S2SV> } //<S2SV> if ( pipefd != - 1 ) { //<S2SV> r_cons_flush ( ) ; //<S2SV> r_cons_pipe_close ( pipefd ) ; //<S2SV> } //<S2SV> if ( ! p ) { //<S2SV> break ; //<S2SV> } //<S2SV> if ( eos ) { //<S2SV> break ; //<S2SV> } //<S2SV> if ( haveQuote ) { //<S2SV> if ( * p == ';' ) { //<S2SV> cmd = p + 1 ; //<S2SV> } else { //<S2SV> if ( * p == \'"\' ) { //<S2SV> cmd = p + 1 ; //<S2SV> } else { //<S2SV> * p = \'"\' ; //<S2SV> cmd = p ; //<S2SV> } //<S2SV> } //<S2SV> } else { //<S2SV> cmd = p + 1 ; //<S2SV> } //<S2SV> } //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return true ; //<S2SV> case '(' : //<S2SV> if ( cmd [ 1 ] != '*' && ! strstr ( cmd , ")()" ) ) { //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return r_cmd_call ( core -> rcmd , cmd ) ; //<S2SV> } //<S2SV> break ; //<S2SV> case '?' : //<S2SV> if ( cmd [ 1 ] == '>' ) { //<S2SV> r_core_cmd_help ( core , help_msg_greater_sign ) ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return true ; //<S2SV> } //<S2SV> } //<S2SV> if ( * cmd != '#' ) { //<S2SV> ptr = ( char * ) r_str_firstbut ( cmd , '#' , "`\\"" ) ; //<S2SV> if ( ptr && ( ptr [ 1 ] == '<S2SV_blank>' || ptr [ 1 ] == '\\t' ) ) { //<S2SV> * ptr = '\\0' ; //<S2SV> } //<S2SV> } //<S2SV> if ( * cmd != '#' ) { //<S2SV> ptr = ( char * ) r_str_lastbut ( cmd , ';' , quotestr ) ; //<S2SV> if ( colon && ptr ) { //<S2SV> int ret ; //<S2SV> * ptr = '\\0' ; //<S2SV> if ( r_core_cmd_subst ( core , cmd ) == - 1 ) { //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> cmd = ptr + 1 ; //<S2SV> ret = r_core_cmd_subst ( core , cmd ) ; //<S2SV> * ptr = ';' ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return ret ; //<S2SV> } //<S2SV> } //<S2SV> ptr = ( char * ) r_str_lastbut ( cmd , '|' , quotestr ) ; //<S2SV> if ( ptr ) { //<S2SV> if ( ptr > cmd ) { //<S2SV> char * ch = ptr - 1 ; //<S2SV> if ( * ch == '\\\\' ) { //<S2SV> memmove ( ch , ptr , strlen ( ptr ) + 1 ) ; //<S2SV> goto escape_pipe ; //<S2SV> } //<S2SV> } //<S2SV> char * ptr2 = strchr ( cmd , '`' ) ; //<S2SV> if ( ! ptr2 || ( ptr2 && ptr2 > ptr ) ) { //<S2SV> if ( ! tick || ( tick && tick > ptr ) ) { //<S2SV> * ptr = '\\0' ; //<S2SV> cmd = r_str_trim_nc ( cmd ) ; //<S2SV> if ( ! strcmp ( ptr + 1 , "?" ) ) { //<S2SV> r_core_cmd_help ( core , help_msg_vertical_bar ) ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return ret ; //<S2SV> } else if ( ! strncmp ( ptr + 1 , "H" , 1 ) ) { //<S2SV> scr_html = r_config_get_i ( core -> config , "scr.html" ) ; //<S2SV> r_config_set_i ( core -> config , "scr.html" , true ) ; //<S2SV> } else if ( ! strcmp ( ptr + 1 , "T" ) ) { //<S2SV> scr_color = r_config_get_i ( core -> config , "scr.color" ) ; //<S2SV> r_config_set_i ( core -> config , "scr.color" , COLOR_MODE_DISABLED ) ; //<S2SV> core -> cons -> use_tts = true ; //<S2SV> } else if ( ! strcmp ( ptr + 1 , "." ) ) { //<S2SV> ret = * cmd ? r_core_cmdf ( core , ".%s" , cmd ) : 0 ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return ret ; //<S2SV> } else if ( ptr [ 1 ] ) { //<S2SV> int value = core -> num -> value ; //<S2SV> if ( * cmd ) { //<S2SV> r_core_cmd_pipe ( core , cmd , ptr + 1 ) ; //<S2SV> } else { //<S2SV> char * res = r_io_system ( core -> io , ptr + 1 ) ; //<S2SV> if ( res ) { //<S2SV> r_cons_printf ( "%s\\n" , res ) ; //<S2SV> free ( res ) ; //<S2SV> } //<S2SV> } //<S2SV> core -> num -> value = value ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return 0 ; //<S2SV> } else { //<S2SV> scr_html = r_config_get_i ( core -> config , "scr.html" ) ; //<S2SV> r_config_set_i ( core -> config , "scr.html" , 0 ) ; //<S2SV> scr_color = r_config_get_i ( core -> config , "scr.color" ) ; //<S2SV> r_config_set_i ( core -> config , "scr.color" , COLOR_MODE_DISABLED ) ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> escape_pipe : //<S2SV> ptr = ( char * ) r_str_lastbut ( cmd , '&' , quotestr ) ; //<S2SV> while ( ptr && * ptr && ptr [ 1 ] == '&' ) { //<S2SV> * ptr = '\\0' ; //<S2SV> ret = r_cmd_call ( core -> rcmd , cmd ) ; //<S2SV> if ( ret == - 1 ) { //<S2SV> eprintf ( "command<S2SV_blank>error(%s)\\n" , cmd ) ; //<S2SV> if ( scr_html != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.html" , scr_html ) ; //<S2SV> } //<S2SV> if ( scr_color != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.color" , scr_color ) ; //<S2SV> } //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return ret ; //<S2SV> } //<S2SV> for ( cmd = ptr + 2 ; cmd && * cmd == '<S2SV_blank>' ; cmd ++ ) { //<S2SV> ; //<S2SV> } //<S2SV> ptr = strchr ( cmd , '&' ) ; //<S2SV> } //<S2SV> R_FREE ( core -> oobi ) ; //<S2SV> ptr = strstr ( cmd , "?*" ) ; //<S2SV> if ( ptr && ( ptr == cmd || ptr [ - 1 ] != '~' ) ) { //<S2SV> ptr [ 0 ] = 0 ; //<S2SV> if ( * cmd != '#' ) { //<S2SV> int detail = 0 ; //<S2SV> if ( cmd < ptr && ptr [ - 1 ] == '?' ) { //<S2SV> detail ++ ; //<S2SV> if ( cmd < ptr - 1 && ptr [ - 2 ] == '?' ) { //<S2SV> detail ++ ; //<S2SV> } //<S2SV> } //<S2SV> r_cons_break_push ( NULL , NULL ) ; //<S2SV> recursive_help ( core , detail , cmd ) ; //<S2SV> r_cons_break_pop ( ) ; //<S2SV> r_cons_grep_parsecmd ( ptr + 2 , "`" ) ; //<S2SV> if ( scr_html != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.html" , scr_html ) ; //<S2SV> } //<S2SV> if ( scr_color != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.color" , scr_color ) ; //<S2SV> } //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> } //<S2SV> # if 0 //<S2SV> ptr = strchr ( cmd , '<' ) ; //<S2SV> if ( ptr ) { //<S2SV> ptr [ 0 ] = '\\0' ; //<S2SV> if ( r_cons_singleton ( ) -> is_interactive ) { //<S2SV> if ( ptr [ 1 ] == '<' ) { //<S2SV> for ( str = ptr + 2 ; str [ 0 ] == '<S2SV_blank>' ; str ++ ) { //<S2SV> } //<S2SV> eprintf ( "==><S2SV_blank>Reading<S2SV_blank>from<S2SV_blank>stdin<S2SV_blank>until<S2SV_blank>\'%s\'\\n" , str ) ; //<S2SV> free ( core -> oobi ) ; //<S2SV> core -> oobi = malloc ( 1 ) ; //<S2SV> if ( core -> oobi ) { //<S2SV> core -> oobi [ 0 ] = '\\0' ; //<S2SV> } //<S2SV> core -> oobi_len = 0 ; //<S2SV> for ( ; ; ) { //<S2SV> char buf [ 1024 ] ; //<S2SV> int ret ; //<S2SV> write ( 1 , "><S2SV_blank>" , 2 ) ; //<S2SV> fgets ( buf , sizeof ( buf ) - 1 , stdin ) ; //<S2SV> if ( feof ( stdin ) ) { //<S2SV> break ; //<S2SV> } //<S2SV> if ( * buf ) buf [ strlen ( buf ) - 1 ] = '\\0' ; //<S2SV> ret = strlen ( buf ) ; //<S2SV> core -> oobi_len += ret ; //<S2SV> core -> oobi = realloc ( core -> oobi , core -> oobi_len + 1 ) ; //<S2SV> if ( core -> oobi ) { //<S2SV> if ( ! strcmp ( buf , str ) ) { //<S2SV> break ; //<S2SV> } //<S2SV> strcat ( ( char * ) core -> oobi , buf ) ; //<S2SV> } //<S2SV> } //<S2SV> } else { //<S2SV> for ( str = ptr + 1 ; * str == '<S2SV_blank>' ; str ++ ) { //<S2SV> } //<S2SV> if ( ! * str ) { //<S2SV> goto next ; //<S2SV> } //<S2SV> eprintf ( "Slurping<S2SV_blank>file<S2SV_blank>\'%s\'\\n" , str ) ; //<S2SV> free ( core -> oobi ) ; //<S2SV> core -> oobi = ( ut8 * ) r_file_slurp ( str , & core -> oobi_len ) ; //<S2SV> if ( ! core -> oobi ) { //<S2SV> eprintf ( "cannot<S2SV_blank>open<S2SV_blank>file\\n" ) ; //<S2SV> } else if ( ptr == cmd ) { //<S2SV> return r_core_cmd_buffer ( core , ( const char * ) core -> oobi ) ; //<S2SV> } //<S2SV> } //<S2SV> } else { //<S2SV> eprintf ( "Cannot<S2SV_blank>slurp<S2SV_blank>with<S2SV_blank><<<S2SV_blank>in<S2SV_blank>non-interactive<S2SV_blank>mode\\n" ) ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> } //<S2SV> next : //<S2SV> # endif //<S2SV> ptr = ( char * ) r_str_firstbut ( cmd , '>' , "\\"" ) ; //<S2SV> if ( ptr ) { //<S2SV> if ( ptr > cmd ) { //<S2SV> char * ch = ptr - 1 ; //<S2SV> if ( * ch == '\\\\' ) { //<S2SV> memmove ( ch , ptr , strlen ( ptr ) + 1 ) ; //<S2SV> goto escape_redir ; //<S2SV> } //<S2SV> } //<S2SV> if ( ptr [ 0 ] && ptr [ 1 ] == '?' ) { //<S2SV> r_core_cmd_help ( core , help_msg_greater_sign ) ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return true ; //<S2SV> } //<S2SV> int fdn = 1 ; //<S2SV> int pipecolor = r_config_get_i ( core -> config , "scr.color.pipe" ) ; //<S2SV> int use_editor = false ; //<S2SV> int ocolor = r_config_get_i ( core -> config , "scr.color" ) ; //<S2SV> * ptr = '\\0' ; //<S2SV> str = r_str_trim_head_tail ( ptr + 1 + ( ptr [ 1 ] == '>' ) ) ; //<S2SV> if ( ! * str ) { //<S2SV> eprintf ( "No<S2SV_blank>output?\\n" ) ; //<S2SV> goto next2 ; //<S2SV> } //<S2SV> if ( ptr > ( cmd + 1 ) && IS_WHITECHAR ( ptr [ - 2 ] ) ) { //<S2SV> char * fdnum = ptr - 1 ; //<S2SV> if ( * fdnum == 'H' ) { //<S2SV> scr_html = r_config_get_i ( core -> config , "scr.html" ) ; //<S2SV> r_config_set_i ( core -> config , "scr.html" , true ) ; //<S2SV> pipecolor = true ; //<S2SV> * fdnum = 0 ; //<S2SV> } else { //<S2SV> if ( IS_DIGIT ( * fdnum ) ) { //<S2SV> fdn = * fdnum - '0' ; //<S2SV> } //<S2SV> * fdnum = 0 ; //<S2SV> } //<S2SV> } //<S2SV> r_cons_set_interactive ( false ) ; //<S2SV> if ( ! strcmp ( str , "-" ) ) { //<S2SV> use_editor = true ; //<S2SV> str = r_file_temp ( "dumpedit" ) ; //<S2SV> r_config_set_i ( core -> config , "scr.color" , COLOR_MODE_DISABLED ) ; //<S2SV> } //<S2SV> const bool appendResult = ( ptr [ 1 ] == '>' ) ; //<S2SV> if ( * str == '$' ) { //<S2SV> char * o = r_core_cmd_str ( core , cmd ) ; //<S2SV> if ( appendResult ) { //<S2SV> char * oldText = r_cmd_alias_get ( core -> rcmd , str , 1 ) ; //<S2SV> if ( oldText ) { //<S2SV> char * two = r_str_newf ( "%s%s" , oldText , o ) ; //<S2SV> if ( two ) { //<S2SV> r_cmd_alias_set ( core -> rcmd , str , two , 1 ) ; //<S2SV> free ( two ) ; //<S2SV> } //<S2SV> } else { //<S2SV> char * n = r_str_newf ( "$%s" , o ) ; //<S2SV> r_cmd_alias_set ( core -> rcmd , str , n , 1 ) ; //<S2SV> free ( n ) ; //<S2SV> } //<S2SV> } else { //<S2SV> char * n = r_str_newf ( "$%s" , o ) ; //<S2SV> r_cmd_alias_set ( core -> rcmd , str , n , 1 ) ; //<S2SV> free ( n ) ; //<S2SV> } //<S2SV> ret = 0 ; //<S2SV> free ( o ) ; //<S2SV> } else if ( fdn > 0 ) { //<S2SV> pipefd = r_cons_pipe_open ( str , fdn , appendResult ) ; //<S2SV> if ( pipefd != - 1 ) { //<S2SV> if ( ! pipecolor ) { //<S2SV> r_config_set_i ( core -> config , "scr.color" , COLOR_MODE_DISABLED ) ; //<S2SV> } //<S2SV> ret = r_core_cmd_subst ( core , cmd ) ; //<S2SV> r_cons_flush ( ) ; //<S2SV> r_cons_pipe_close ( pipefd ) ; //<S2SV> } //<S2SV> } //<S2SV> r_cons_set_last_interactive ( ) ; //<S2SV> if ( ! pipecolor ) { //<S2SV> r_config_set_i ( core -> config , "scr.color" , ocolor ) ; //<S2SV> } //<S2SV> if ( use_editor ) { //<S2SV> const char * editor = r_config_get ( core -> config , "cfg.editor" ) ; //<S2SV> if ( editor && * editor ) { //<S2SV> r_sys_cmdf ( "%s<S2SV_blank>\'%s\'" , editor , str ) ; //<S2SV> r_file_rm ( str ) ; //<S2SV> } else { //<S2SV> eprintf ( "No<S2SV_blank>cfg.editor<S2SV_blank>configured\\n" ) ; //<S2SV> } //<S2SV> r_config_set_i ( core -> config , "scr.color" , ocolor ) ; //<S2SV> free ( str ) ; //<S2SV> } //<S2SV> if ( scr_html != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.html" , scr_html ) ; //<S2SV> } //<S2SV> if ( scr_color != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.color" , scr_color ) ; //<S2SV> } //<S2SV> core -> cons -> use_tts = false ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return ret ; //<S2SV> } //<S2SV> escape_redir : //<S2SV> next2 : //<S2SV> ptr = strchr ( cmd , '`' ) ; //<S2SV> if ( ptr ) { //<S2SV> if ( ptr > cmd ) { //<S2SV> char * ch = ptr - 1 ; //<S2SV> if ( * ch == '\\\\' ) { //<S2SV> memmove ( ch , ptr , strlen ( ptr ) + 1 ) ; //<S2SV> goto escape_backtick ; //<S2SV> } //<S2SV> } //<S2SV> bool empty = false ; //<S2SV> int oneline = 1 ; //<S2SV> if ( ptr [ 1 ] == '`' ) { //<S2SV> memmove ( ptr , ptr + 1 , strlen ( ptr ) ) ; //<S2SV> oneline = 0 ; //<S2SV> empty = true ; //<S2SV> } //<S2SV> ptr2 = strchr ( ptr + 1 , '`' ) ; //<S2SV> if ( empty ) { //<S2SV> } else if ( ! ptr2 ) { //<S2SV> eprintf ( "parse:<S2SV_blank>Missing<S2SV_blank>backtick<S2SV_blank>in<S2SV_blank>expression.\\n" ) ; //<S2SV> goto fail ; //<S2SV> } else { //<S2SV> int value = core -> num -> value ; //<S2SV> * ptr = '\\0' ; //<S2SV> * ptr2 = '\\0' ; //<S2SV> if ( ptr [ 1 ] == '!' ) { //<S2SV> str = r_core_cmd_str_pipe ( core , ptr + 1 ) ; //<S2SV> } else { //<S2SV> int ocolor = r_config_get_i ( core -> config , "scr.color" ) ; //<S2SV> r_config_set_i ( core -> config , "scr.color" , 0 ) ; //<S2SV> core -> cmd_in_backticks = true ; //<S2SV> str = r_core_cmd_str ( core , ptr + 1 ) ; //<S2SV> core -> cmd_in_backticks = false ; //<S2SV> r_config_set_i ( core -> config , "scr.color" , ocolor ) ; //<S2SV> } //<S2SV> if ( ! str ) { //<S2SV> goto fail ; //<S2SV> } //<S2SV> if ( * str == '|' || * str == '*' ) { //<S2SV> eprintf ( "r_core_cmd_subst_i:<S2SV_blank>invalid<S2SV_blank>backticked<S2SV_blank>command\\n" ) ; //<S2SV> free ( str ) ; //<S2SV> goto fail ; //<S2SV> } //<S2SV> if ( oneline && str ) { //<S2SV> for ( i = 0 ; str [ i ] ; i ++ ) { //<S2SV> if ( str [ i ] == '\\n' ) { //<S2SV> str [ i ] = '<S2SV_blank>' ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> str = r_str_append ( str , ptr2 + 1 ) ; //<S2SV> cmd = r_str_append ( strdup ( cmd ) , str ) ; //<S2SV> core -> num -> value = value ; //<S2SV> ret = r_core_cmd_subst ( core , cmd ) ; //<S2SV> free ( cmd ) ; //<S2SV> if ( scr_html != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.html" , scr_html ) ; //<S2SV> } //<S2SV> free ( str ) ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return ret ; //<S2SV> } //<S2SV> } //<S2SV> escape_backtick : //<S2SV> if ( * cmd != \'"\' && * cmd ) { //<S2SV> const char * s = strstr ( cmd , "~?" ) ; //<S2SV> if ( s ) { //<S2SV> bool showHelp = false ; //<S2SV> if ( cmd == s ) { //<S2SV> showHelp = true ; //<S2SV> } else { //<S2SV> if ( ! strcmp ( s , "~??" ) ) { //<S2SV> showHelp = true ; //<S2SV> } //<S2SV> } //<S2SV> if ( showHelp ) { //<S2SV> r_cons_grep_help ( ) ; //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> return true ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> if ( * cmd != '.' ) { //<S2SV> grep = r_cons_grep_strip ( cmd , quotestr ) ; //<S2SV> } //<S2SV> if ( * cmd != \'"\' ) { //<S2SV> ptr = strchr ( cmd , '@' ) ; //<S2SV> if ( ptr == cmd + 1 && * cmd == '?' ) { //<S2SV> ptr = NULL ; //<S2SV> } //<S2SV> } else { //<S2SV> ptr = NULL ; //<S2SV> } //<S2SV> cmd_tmpseek = core -> tmpseek = ptr ? true : false ; //<S2SV> int rc = 0 ; //<S2SV> if ( ptr ) { //<S2SV> char * f , * ptr2 = strchr ( ptr + 1 , '!' ) ; //<S2SV> ut64 addr = core -> offset ; //<S2SV> bool addr_is_set = false ; //<S2SV> char * tmpbits = NULL ; //<S2SV> const char * offstr = NULL ; //<S2SV> bool is_bits_set = false ; //<S2SV> bool is_arch_set = false ; //<S2SV> char * tmpeval = NULL ; //<S2SV> char * tmpasm = NULL ; //<S2SV> bool flgspc_changed = false ; //<S2SV> int tmpfd = - 1 ; //<S2SV> int sz , len ; //<S2SV> ut8 * buf ; //<S2SV> * ptr ++ = '\\0' ; //<S2SV> repeat_arroba : //<S2SV> arroba = ( ptr [ 0 ] && ptr [ 1 ] && ptr [ 2 ] ) ? //<S2SV> strchr ( ptr + 2 , '@' ) : NULL ; //<S2SV> if ( arroba ) { //<S2SV> * arroba = 0 ; //<S2SV> } //<S2SV> for ( ; * ptr == '<S2SV_blank>' ; ptr ++ ) { //<S2SV> } //<S2SV> if ( * ptr && ptr [ 1 ] == ':' ) { //<S2SV> } else { //<S2SV> ptr -- ; //<S2SV> } //<S2SV> ptr = r_str_trim_tail ( ptr ) ; //<S2SV> if ( ptr [ 1 ] == '?' ) { //<S2SV> r_core_cmd_help ( core , help_msg_at ) ; //<S2SV> } else if ( ptr [ 1 ] == '%' ) { //<S2SV> char * k = strdup ( ptr + 2 ) ; //<S2SV> char * v = strchr ( k , '=' ) ; //<S2SV> if ( v ) { //<S2SV> * v ++ = 0 ; //<S2SV> r_sys_setenv ( k , v ) ; //<S2SV> r_list_append ( tmpenvs , k ) ; //<S2SV> } else { //<S2SV> free ( k ) ; //<S2SV> } //<S2SV> } else if ( ptr [ 1 ] == '.' ) { //<S2SV> if ( ptr [ 2 ] == '.' ) { //<S2SV> if ( ptr [ 3 ] == '.' ) { //<S2SV> ut64 addr = r_num_tail ( core -> num , core -> offset , ptr + 4 ) ; //<S2SV> r_core_block_size ( core , R_ABS ( ( st64 ) addr - ( st64 ) core -> offset ) ) ; //<S2SV> goto fuji ; //<S2SV> } else { //<S2SV> addr = r_num_tail ( core -> num , core -> offset , ptr + 3 ) ; //<S2SV> r_core_seek ( core , addr , 1 ) ; //<S2SV> cmd_tmpseek = core -> tmpseek = true ; //<S2SV> goto fuji ; //<S2SV> } //<S2SV> } else { //<S2SV> eprintf ( "TODO:<S2SV_blank>what<S2SV_blank>do<S2SV_blank>you<S2SV_blank>expect<S2SV_blank>for<S2SV_blank>@.<S2SV_blank>import<S2SV_blank>offset<S2SV_blank>from<S2SV_blank>file<S2SV_blank>maybe?\\n" ) ; //<S2SV> } //<S2SV> } else if ( ptr [ 0 ] && ptr [ 1 ] == ':' && ptr [ 2 ] ) { //<S2SV> switch ( ptr [ 0 ] ) { //<S2SV> case 'F' : //<S2SV> flgspc_changed = r_flag_space_push ( core -> flags , ptr + 2 ) ; //<S2SV> break ; //<S2SV> case 'B' : //<S2SV> { //<S2SV> int index = ( int ) r_num_math ( core -> num , ptr + 2 ) ; //<S2SV> RAnalBlock * bb = r_anal_bb_from_offset ( core -> anal , core -> offset ) ; //<S2SV> if ( bb ) { //<S2SV> if ( index < 0 ) { //<S2SV> index = bb -> ninstr + index ; //<S2SV> } //<S2SV> if ( index >= 0 && index < bb -> ninstr ) { //<S2SV> ut16 inst_off = r_anal_bb_offset_inst ( bb , index ) ; //<S2SV> r_core_seek ( core , bb -> addr + inst_off , 1 ) ; //<S2SV> cmd_tmpseek = core -> tmpseek = true ; //<S2SV> } else { //<S2SV> eprintf ( "The<S2SV_blank>current<S2SV_blank>basic<S2SV_blank>block<S2SV_blank>has<S2SV_blank>%d<S2SV_blank>instructions\\n" , bb -> ninstr ) ; //<S2SV> } //<S2SV> } else { //<S2SV> eprintf ( "Can\'t<S2SV_blank>find<S2SV_blank>a<S2SV_blank>basic<S2SV_blank>block<S2SV_blank>for<S2SV_blank>0x%08" PFMT64x "\\n" , core -> offset ) ; //<S2SV> } //<S2SV> break ; //<S2SV> } //<S2SV> break ; //<S2SV> case 'f' : //<S2SV> f = r_file_slurp ( ptr + 2 , & sz ) ; //<S2SV> if ( f ) { //<S2SV> { //<S2SV> RBuffer * b = r_buf_new_with_bytes ( ( const ut8 * ) f , sz ) ; //<S2SV> RIODesc * d = r_io_open_buffer ( core -> io , b , R_PERM_RWX , 0 ) ; //<S2SV> if ( d ) { //<S2SV> if ( tmpdesc ) { //<S2SV> r_io_desc_close ( tmpdesc ) ; //<S2SV> } //<S2SV> tmpdesc = d ; //<S2SV> if ( pamode ) { //<S2SV> r_config_set_i ( core -> config , "io.va" , 1 ) ; //<S2SV> } //<S2SV> r_io_map_new ( core -> io , d -> fd , d -> perm , 0 , core -> offset , r_buf_size ( b ) ) ; //<S2SV> } //<S2SV> } //<S2SV> # if 0 //<S2SV> buf = malloc ( sz ) ; //<S2SV> if ( buf ) { //<S2SV> free ( core -> block ) ; //<S2SV> core -> block = buf ; //<S2SV> core -> blocksize = sz ; //<S2SV> memcpy ( core -> block , f , sz ) ; //<S2SV> usemyblock = true ; //<S2SV> } else { //<S2SV> eprintf ( "cannot<S2SV_blank>alloc<S2SV_blank>%d" , sz ) ; //<S2SV> } //<S2SV> free ( f ) ; //<S2SV> # endif //<S2SV> } else { //<S2SV> eprintf ( "cannot<S2SV_blank>open<S2SV_blank>\'%s\'\\n" , ptr + 3 ) ; //<S2SV> } //<S2SV> break ; //<S2SV> case 'r' : //<S2SV> if ( ptr [ 1 ] == ':' ) { //<S2SV> ut64 regval ; //<S2SV> char * mander = strdup ( ptr + 2 ) ; //<S2SV> char * sep = findSeparator ( mander ) ; //<S2SV> if ( sep ) { //<S2SV> char ch = * sep ; //<S2SV> * sep = 0 ; //<S2SV> regval = r_debug_reg_get ( core -> dbg , mander ) ; //<S2SV> * sep = ch ; //<S2SV> char * numexpr = r_str_newf ( "0x%" PFMT64x "%s" , regval , sep ) ; //<S2SV> regval = r_num_math ( core -> num , numexpr ) ; //<S2SV> free ( numexpr ) ; //<S2SV> } else { //<S2SV> regval = r_debug_reg_get ( core -> dbg , ptr + 2 ) ; //<S2SV> } //<S2SV> r_core_seek ( core , regval , 1 ) ; //<S2SV> cmd_tmpseek = core -> tmpseek = true ; //<S2SV> free ( mander ) ; //<S2SV> } //<S2SV> break ; //<S2SV> case 'b' : //<S2SV> is_bits_set = set_tmp_bits ( core , r_num_math ( core -> num , ptr + 2 ) , & tmpbits ) ; //<S2SV> cmd_ignbithints = r_config_get_i ( core -> config , "anal.ignbithints" ) ; //<S2SV> r_config_set_i ( core -> config , "anal.ignbithints" , 1 ) ; //<S2SV> break ; //<S2SV> case 'i' : //<S2SV> { //<S2SV> ut64 addr = r_num_math ( core -> num , ptr + 2 ) ; //<S2SV> if ( addr ) { //<S2SV> r_core_cmdf ( core , "so<S2SV_blank>%s" , ptr + 2 ) ; //<S2SV> cmd_tmpseek = core -> tmpseek = true ; //<S2SV> } //<S2SV> } //<S2SV> break ; //<S2SV> case 'e' : //<S2SV> { //<S2SV> char * cmd = parse_tmp_evals ( core , ptr + 2 ) ; //<S2SV> if ( ! tmpeval ) { //<S2SV> tmpeval = cmd ; //<S2SV> } else { //<S2SV> tmpeval = r_str_prepend ( tmpeval , cmd ) ; //<S2SV> free ( cmd ) ; //<S2SV> } //<S2SV> } //<S2SV> break ; //<S2SV> case 'x' : //<S2SV> if ( ptr [ 1 ] == ':' ) { //<S2SV> buf = malloc ( strlen ( ptr + 2 ) + 1 ) ; //<S2SV> if ( buf ) { //<S2SV> len = r_hex_str2bin ( ptr + 2 , buf ) ; //<S2SV> r_core_block_size ( core , R_ABS ( len ) ) ; //<S2SV> if ( len > 0 ) { //<S2SV> RBuffer * b = r_buf_new_with_bytes ( buf , len ) ; //<S2SV> RIODesc * d = r_io_open_buffer ( core -> io , b , R_PERM_RWX , 0 ) ; //<S2SV> if ( d ) { //<S2SV> if ( tmpdesc ) { //<S2SV> r_io_desc_close ( tmpdesc ) ; //<S2SV> } //<S2SV> tmpdesc = d ; //<S2SV> if ( pamode ) { //<S2SV> r_config_set_i ( core -> config , "io.va" , 1 ) ; //<S2SV> } //<S2SV> r_io_map_new ( core -> io , d -> fd , d -> perm , 0 , core -> offset , r_buf_size ( b ) ) ; //<S2SV> r_core_block_size ( core , len ) ; //<S2SV> r_core_block_read ( core ) ; //<S2SV> } //<S2SV> } else { //<S2SV> eprintf ( "Error:<S2SV_blank>Invalid<S2SV_blank>hexpairs<S2SV_blank>for<S2SV_blank>@x:\\n" ) ; //<S2SV> } //<S2SV> free ( buf ) ; //<S2SV> } else { //<S2SV> eprintf ( "cannot<S2SV_blank>allocate\\n" ) ; //<S2SV> } //<S2SV> } else { //<S2SV> eprintf ( "Invalid<S2SV_blank>@x:<S2SV_blank>syntax\\n" ) ; //<S2SV> } //<S2SV> break ; //<S2SV> case 'k' : //<S2SV> { //<S2SV> char * out = sdb_querys ( core -> sdb , NULL , 0 , ptr + ( ( ptr [ 1 ] ) ? 2 : 1 ) ) ; //<S2SV> if ( out ) { //<S2SV> r_core_seek ( core , r_num_math ( core -> num , out ) , 1 ) ; //<S2SV> free ( out ) ; //<S2SV> usemyblock = true ; //<S2SV> } //<S2SV> } //<S2SV> break ; //<S2SV> case 'o' : //<S2SV> if ( ptr [ 1 ] == ':' ) { //<S2SV> tmpfd = core -> io -> desc ? core -> io -> desc -> fd : - 1 ; //<S2SV> r_io_use_fd ( core -> io , atoi ( ptr + 2 ) ) ; //<S2SV> } //<S2SV> break ; //<S2SV> case 'a' : //<S2SV> if ( ptr [ 1 ] == ':' ) { //<S2SV> char * q = strchr ( ptr + 2 , ':' ) ; //<S2SV> if ( q ) { //<S2SV> * q ++ = 0 ; //<S2SV> int bits = r_num_math ( core -> num , q ) ; //<S2SV> is_bits_set = set_tmp_bits ( core , bits , & tmpbits ) ; //<S2SV> } //<S2SV> is_arch_set = set_tmp_arch ( core , ptr + 2 , & tmpasm ) ; //<S2SV> } else { //<S2SV> eprintf ( "Usage:<S2SV_blank>pd<S2SV_blank>10<S2SV_blank>@a:arm:32\\n" ) ; //<S2SV> } //<S2SV> break ; //<S2SV> case 's' : //<S2SV> { //<S2SV> len = strlen ( ptr + 2 ) ; //<S2SV> r_core_block_size ( core , len ) ; //<S2SV> const ut8 * buf = ( const ut8 * ) r_str_trim_ro ( ptr + 2 ) ; //<S2SV> if ( len > 0 ) { //<S2SV> RBuffer * b = r_buf_new_with_bytes ( buf , len ) ; //<S2SV> RIODesc * d = r_io_open_buffer ( core -> io , b , R_PERM_RWX , 0 ) ; //<S2SV> if ( ! core -> io -> va ) { //<S2SV> r_config_set_i ( core -> config , "io.va" , 1 ) ; //<S2SV> } //<S2SV> if ( d ) { //<S2SV> if ( tmpdesc ) { //<S2SV> r_io_desc_close ( tmpdesc ) ; //<S2SV> } //<S2SV> tmpdesc = d ; //<S2SV> if ( pamode ) { //<S2SV> r_config_set_i ( core -> config , "io.va" , 1 ) ; //<S2SV> } //<S2SV> r_io_map_new ( core -> io , d -> fd , d -> perm , 0 , core -> offset , r_buf_size ( b ) ) ; //<S2SV> r_core_block_size ( core , len ) ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> break ; //<S2SV> default : //<S2SV> goto ignore ; //<S2SV> } //<S2SV> * ptr = '@' ; //<S2SV> char * trim = ptr - 2 ; //<S2SV> while ( trim > cmd ) { //<S2SV> if ( ! IS_WHITESPACE ( * trim ) ) { //<S2SV> break ; //<S2SV> } //<S2SV> * trim = 0 ; //<S2SV> trim -- ; //<S2SV> } //<S2SV> goto next_arroba ; //<S2SV> } //<S2SV> ignore : //<S2SV> ptr = r_str_trim_head ( ptr + 1 ) - 1 ; //<S2SV> cmd = r_str_trim_nc ( cmd ) ; //<S2SV> if ( ptr2 ) { //<S2SV> if ( strlen ( ptr + 1 ) == 13 && strlen ( ptr2 + 1 ) == 6 && //<S2SV> ! memcmp ( ptr + 1 , "0x" , 2 ) && //<S2SV> ! memcmp ( ptr2 + 1 , "0x" , 2 ) ) { //<S2SV> } else if ( strlen ( ptr + 1 ) == 9 && strlen ( ptr2 + 1 ) == 4 ) { //<S2SV> } else { //<S2SV> * ptr2 = '\\0' ; //<S2SV> if ( ! ptr2 [ 1 ] ) { //<S2SV> goto fail ; //<S2SV> } //<S2SV> r_core_block_size ( //<S2SV> core , r_num_math ( core -> num , ptr2 + 1 ) ) ; //<S2SV> } //<S2SV> } //<S2SV> offstr = r_str_trim_head ( ptr + 1 ) ; //<S2SV> addr = r_num_math ( core -> num , offstr ) ; //<S2SV> addr_is_set = true ; //<S2SV> if ( isalpha ( ( ut8 ) ptr [ 1 ] ) && ! addr ) { //<S2SV> if ( ! r_flag_get ( core -> flags , ptr + 1 ) ) { //<S2SV> eprintf ( "Invalid<S2SV_blank>address<S2SV_blank>(%s)\\n" , ptr + 1 ) ; //<S2SV> goto fail ; //<S2SV> } //<S2SV> } else { //<S2SV> char ch = * offstr ; //<S2SV> if ( ch == '-' || ch == '+' ) { //<S2SV> addr = core -> offset + addr ; //<S2SV> } //<S2SV> } //<S2SV> if ( addr ) { //<S2SV> RIODesc * d = tmpdesc ; //<S2SV> if ( d ) { //<S2SV> r_io_map_new ( core -> io , d -> fd , d -> perm , 0 , addr , r_io_desc_size ( d ) ) ; //<S2SV> } //<S2SV> } //<S2SV> next_arroba : //<S2SV> if ( arroba ) { //<S2SV> ptr = arroba + 1 ; //<S2SV> * arroba = '@' ; //<S2SV> arroba = NULL ; //<S2SV> goto repeat_arroba ; //<S2SV> } //<S2SV> core -> fixedblock = ! ! tmpdesc ; //<S2SV> if ( core -> fixedblock ) { //<S2SV> r_core_block_read ( core ) ; //<S2SV> } //<S2SV> if ( ptr [ 1 ] == '@' ) { //<S2SV> if ( ptr [ 2 ] == '@' ) { //<S2SV> char * rule = ptr + 3 ; //<S2SV> while ( * rule && * rule == '<S2SV_blank>' ) { //<S2SV> rule ++ ; //<S2SV> } //<S2SV> ret = r_core_cmd_foreach3 ( core , cmd , rule ) ; //<S2SV> } else { //<S2SV> ret = r_core_cmd_foreach ( core , cmd , ptr + 2 ) ; //<S2SV> } //<S2SV> } else { //<S2SV> bool tmpseek = false ; //<S2SV> const char * fromvars [ ] = { "anal.from" , "diff.from" , "graph.from" , //<S2SV> "io.buffer.from" , "lines.from" , "search.from" , "zoom.from" , NULL } ; //<S2SV> const char * tovars [ ] = { "anal.to" , "diff.to" , "graph.to" , //<S2SV> "io.buffer.to" , "lines.to" , "search.to" , "zoom.to" , NULL } ; //<S2SV> ut64 curfrom [ R_ARRAY_SIZE ( fromvars ) - 1 ] , curto [ R_ARRAY_SIZE ( tovars ) - 1 ] ; //<S2SV> if ( ptr [ 1 ] == '(' ) { //<S2SV> char * range = ptr + 3 ; //<S2SV> char * p = strchr ( range , '<S2SV_blank>' ) ; //<S2SV> if ( ! p ) { //<S2SV> eprintf ( "Usage:<S2SV_blank>/<S2SV_blank>ABCD<S2SV_blank>@..0x1000<S2SV_blank>0x3000\\n" ) ; //<S2SV> free ( tmpeval ) ; //<S2SV> free ( tmpasm ) ; //<S2SV> free ( tmpbits ) ; //<S2SV> goto fail ; //<S2SV> } //<S2SV> * p = '\\x00' ; //<S2SV> ut64 from = r_num_math ( core -> num , range ) ; //<S2SV> ut64 to = r_num_math ( core -> num , p + 1 ) ; //<S2SV> for ( i = 0 ; fromvars [ i ] ; i ++ ) { //<S2SV> curfrom [ i ] = r_config_get_i ( core -> config , fromvars [ i ] ) ; //<S2SV> } //<S2SV> for ( i = 0 ; tovars [ i ] ; i ++ ) { //<S2SV> curto [ i ] = r_config_get_i ( core -> config , tovars [ i ] ) ; //<S2SV> } //<S2SV> for ( i = 0 ; fromvars [ i ] ; i ++ ) { //<S2SV> r_config_set_i ( core -> config , fromvars [ i ] , from ) ; //<S2SV> } //<S2SV> for ( i = 0 ; tovars [ i ] ; i ++ ) { //<S2SV> r_config_set_i ( core -> config , tovars [ i ] , to ) ; //<S2SV> } //<S2SV> tmpseek = true ; //<S2SV> } //<S2SV> if ( usemyblock ) { //<S2SV> if ( addr_is_set ) { //<S2SV> core -> offset = addr ; //<S2SV> } //<S2SV> ret = r_cmd_call ( core -> rcmd , r_str_trim_head ( cmd ) ) ; //<S2SV> } else { //<S2SV> if ( addr_is_set ) { //<S2SV> if ( ptr [ 1 ] ) { //<S2SV> r_core_seek ( core , addr , 1 ) ; //<S2SV> r_core_block_read ( core ) ; //<S2SV> } //<S2SV> } //<S2SV> ret = r_cmd_call ( core -> rcmd , r_str_trim_head ( cmd ) ) ; //<S2SV> } //<S2SV> if ( tmpseek ) { //<S2SV> for ( i = 0 ; fromvars [ i ] ; i ++ ) { //<S2SV> r_config_set_i ( core -> config , fromvars [ i ] , curfrom [ i ] ) ; //<S2SV> } //<S2SV> for ( i = 0 ; tovars [ i ] ; i ++ ) { //<S2SV> r_config_set_i ( core -> config , tovars [ i ] , curto [ i ] ) ; //<S2SV> } //<S2SV> } //<S2SV> } //<S2SV> if ( ptr2 ) { //<S2SV> * ptr2 = '!' ; //<S2SV> r_core_block_size ( core , tmpbsz ) ; //<S2SV> } //<S2SV> if ( is_arch_set ) { //<S2SV> core -> fixedarch = oldfixedarch ; //<S2SV> r_config_set ( core -> config , "asm.arch" , tmpasm ) ; //<S2SV> R_FREE ( tmpasm ) ; //<S2SV> } //<S2SV> if ( tmpfd != - 1 ) { //<S2SV> r_io_use_fd ( core -> io , tmpfd ) ; //<S2SV> } //<S2SV> if ( tmpdesc ) { //<S2SV> if ( pamode ) { //<S2SV> r_config_set_i ( core -> config , "io.va" , 0 ) ; //<S2SV> } //<S2SV> r_io_desc_close ( tmpdesc ) ; //<S2SV> tmpdesc = NULL ; //<S2SV> } //<S2SV> if ( is_bits_set ) { //<S2SV> r_config_set ( core -> config , "asm.bits" , tmpbits ) ; //<S2SV> core -> fixedbits = oldfixedbits ; //<S2SV> } //<S2SV> if ( tmpbsz != core -> blocksize ) { //<S2SV> r_core_block_size ( core , tmpbsz ) ; //<S2SV> } //<S2SV> if ( tmpeval ) { //<S2SV> r_core_cmd0 ( core , tmpeval ) ; //<S2SV> R_FREE ( tmpeval ) ; //<S2SV> } //<S2SV> if ( flgspc_changed ) { //<S2SV> r_flag_space_pop ( core -> flags ) ; //<S2SV> } //<S2SV> * ptr = '@' ; //<S2SV> rc = ret ; //<S2SV> goto beach ; //<S2SV> } //<S2SV> fuji : //<S2SV> rc = cmd ? r_cmd_call ( core -> rcmd , r_str_trim_head ( cmd ) ) : false ; //<S2SV> beach : //<S2SV> r_cons_grep_process ( grep ) ; //<S2SV> if ( scr_html != - 1 ) { //<S2SV> r_cons_flush ( ) ; //<S2SV> r_config_set_i ( core -> config , "scr.html" , scr_html ) ; //<S2SV> } //<S2SV> if ( scr_color != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "scr.color" , scr_color ) ; //<S2SV> } //<S2SV> r_list_free ( tmpenvs ) ; //<S2SV> if ( tmpdesc ) { //<S2SV> r_io_desc_close ( tmpdesc ) ; //<S2SV> tmpdesc = NULL ; //<S2SV> } //<S2SV> core -> fixedarch = oldfixedarch ; //<S2SV> core -> fixedbits = oldfixedbits ; //<S2SV> if ( tmpseek ) { //<S2SV> * tmpseek = cmd_tmpseek ; //<S2SV> } //<S2SV> if ( cmd_ignbithints != - 1 ) { //<S2SV> r_config_set_i ( core -> config , "anal.ignbithints" , cmd_ignbithints ) ; //<S2SV> } //<S2SV> return rc ; //<S2SV> fail : //<S2SV> rc = - 1 ; //<S2SV> goto beach ; //<S2SV> } //<S2SV> 