int main ( int argc , char * * argv ) //<S2SV> { //<S2SV> int fmtid ; //<S2SV> int id ; //<S2SV> char * infile ; //<S2SV> jas_stream_t * instream ; //<S2SV> jas_image_t * image ; //<S2SV> int width ; //<S2SV> int height ; //<S2SV> int depth ; //<S2SV> int numcmpts ; //<S2SV> int verbose ; //<S2SV> char * fmtname ; //<S2SV> int debug ; //<S2SV> size_t max_mem ; //<S2SV> size_t max_samples ; //<S2SV> char optstr [ 32 ] ; //<S2SV> if ( jas_init ( ) ) { //<S2SV> abort ( ) ; //<S2SV> } //<S2SV> cmdname = argv [ 0 ] ; //<S2SV> max_samples = 64 * JAS_MEBI ; //<S2SV> infile = 0 ; //<S2SV> verbose = 0 ; //<S2SV> debug = 0 ; //<S2SV> # if defined ( JAS_DEFAULT_MAX_MEM_USAGE ) //<S2SV> max_mem = JAS_DEFAULT_MAX_MEM_USAGE ; //<S2SV> # endif //<S2SV> while ( ( id = jas_getopt ( argc , argv , opts ) ) >= 0 ) { //<S2SV> switch ( id ) { //<S2SV> case OPT_VERBOSE : //<S2SV> verbose = 1 ; //<S2SV> break ; //<S2SV> case OPT_VERSION : //<S2SV> printf ( "%s\\n" , JAS_VERSION ) ; //<S2SV> exit ( EXIT_SUCCESS ) ; //<S2SV> break ; //<S2SV> case OPT_DEBUG : //<S2SV> debug = atoi ( jas_optarg ) ; //<S2SV> break ; //<S2SV> case OPT_INFILE : //<S2SV> infile = jas_optarg ; //<S2SV> break ; //<S2SV> case OPT_MAXSAMPLES : //<S2SV> max_samples = strtoull ( jas_optarg , 0 , 10 ) ; //<S2SV> break ; //<S2SV> case OPT_MAXMEM : //<S2SV> max_mem = strtoull ( jas_optarg , 0 , 10 ) ; //<S2SV> break ; //<S2SV> case OPT_HELP : //<S2SV> default : //<S2SV> usage ( ) ; //<S2SV> break ; //<S2SV> } //<S2SV> } //<S2SV> jas_setdbglevel ( debug ) ; //<S2SV> # if defined ( JAS_DEFAULT_MAX_MEM_USAGE ) //<S2SV> jas_set_max_mem_usage ( max_mem ) ; //<S2SV> # endif //<S2SV> if ( infile ) { //<S2SV> if ( ! ( instream = jas_stream_fopen ( infile , "rb" ) ) ) { //<S2SV> fprintf ( stderr , "cannot<S2SV_blank>open<S2SV_blank>input<S2SV_blank>image<S2SV_blank>file<S2SV_blank>%s\\n" , infile ) ; //<S2SV> exit ( EXIT_FAILURE ) ; //<S2SV> } //<S2SV> } else { //<S2SV> if ( ! ( instream = jas_stream_fdopen ( 0 , "rb" ) ) ) { //<S2SV> fprintf ( stderr , "cannot<S2SV_blank>open<S2SV_blank>standard<S2SV_blank>input\\n" ) ; //<S2SV> exit ( EXIT_FAILURE ) ; //<S2SV> } //<S2SV> } //<S2SV> if ( ( fmtid = jas_image_getfmt ( instream ) ) < 0 ) { //<S2SV> fprintf ( stderr , "unknown<S2SV_blank>image<S2SV_blank>format\\n" ) ; //<S2SV> } //<S2SV> snprintf ( optstr , sizeof ( optstr ) , "max_samples=%-zu" , max_samples ) ; //<S2SV> if ( ! ( image = jas_image_decode ( instream , fmtid , optstr ) ) ) { //<S2SV> jas_stream_close ( instream ) ; //<S2SV> fprintf ( stderr , "cannot<S2SV_blank>load<S2SV_blank>image\\n" ) ; //<S2SV> return EXIT_FAILURE ; //<S2SV> } //<S2SV> jas_stream_close ( instream ) ; //<S2SV> if ( ! ( fmtname = jas_image_fmttostr ( fmtid ) ) ) { //<S2SV> jas_eprintf ( "format<S2SV_blank>name<S2SV_blank>lookup<S2SV_blank>failed\\n" ) ; //<S2SV> return EXIT_FAILURE ; //<S2SV> } //<S2SV> if ( ! ( numcmpts = jas_image_numcmpts ( image ) ) ) { //<S2SV> fprintf ( stderr , "warning:<S2SV_blank>image<S2SV_blank>has<S2SV_blank>no<S2SV_blank>components\\n" ) ; //<S2SV> } //<S2SV> if ( numcmpts ) { //<S2SV> width = jas_image_cmptwidth ( image , 0 ) ; //<S2SV> height = jas_image_cmptheight ( image , 0 ) ; //<S2SV> depth = jas_image_cmptprec ( image , 0 ) ; //<S2SV> } else { //<S2SV> width = 0 ; //<S2SV> height = 0 ; //<S2SV> depth = 0 ; //<S2SV> } //<S2SV> printf ( "%s<S2SV_blank>%d<S2SV_blank>%d<S2SV_blank>%d<S2SV_blank>%d<S2SV_blank>%ld\\n" , fmtname , numcmpts , width , height , depth , //<S2SV> JAS_CAST ( long , jas_image_rawsize ( image ) ) ) ; //<S2SV> jas_image_destroy ( image ) ; //<S2SV> jas_image_clearfmts ( ) ; //<S2SV> return EXIT_SUCCESS ; //<S2SV> } //<S2SV> 