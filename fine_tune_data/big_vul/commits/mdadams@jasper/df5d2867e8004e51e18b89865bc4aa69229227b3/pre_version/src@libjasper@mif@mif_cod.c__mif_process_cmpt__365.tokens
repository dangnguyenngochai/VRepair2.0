static int mif_process_cmpt ( mif_hdr_t * hdr , char * buf ) //<S2SV> { //<S2SV> jas_tvparser_t * tvp ; //<S2SV> mif_cmpt_t * cmpt ; //<S2SV> int id ; //<S2SV> cmpt = 0 ; //<S2SV> tvp = 0 ; //<S2SV> if ( ! ( cmpt = mif_cmpt_create ( ) ) ) { //<S2SV> goto error ; //<S2SV> } //<S2SV> cmpt -> tlx = 0 ; //<S2SV> cmpt -> tly = 0 ; //<S2SV> cmpt -> sampperx = 0 ; //<S2SV> cmpt -> samppery = 0 ; //<S2SV> cmpt -> width = 0 ; //<S2SV> cmpt -> height = 0 ; //<S2SV> cmpt -> prec = 0 ; //<S2SV> cmpt -> sgnd = - 1 ; //<S2SV> cmpt -> data = 0 ; //<S2SV> if ( ! ( tvp = jas_tvparser_create ( buf ) ) ) { //<S2SV> goto error ; //<S2SV> } //<S2SV> while ( ! ( id = jas_tvparser_next ( tvp ) ) ) { //<S2SV> switch ( jas_taginfo_nonull ( jas_taginfos_lookup ( mif_tags , //<S2SV> jas_tvparser_gettag ( tvp ) ) ) -> id ) { //<S2SV> case MIF_TLX : //<S2SV> cmpt -> tlx = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_TLY : //<S2SV> cmpt -> tly = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_WIDTH : //<S2SV> cmpt -> width = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_HEIGHT : //<S2SV> cmpt -> height = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_HSAMP : //<S2SV> cmpt -> sampperx = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_VSAMP : //<S2SV> cmpt -> samppery = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_PREC : //<S2SV> cmpt -> prec = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_SGND : //<S2SV> cmpt -> sgnd = atoi ( jas_tvparser_getval ( tvp ) ) ; //<S2SV> break ; //<S2SV> case MIF_DATA : //<S2SV> if ( ! ( cmpt -> data = jas_strdup ( jas_tvparser_getval ( tvp ) ) ) ) { //<S2SV> return - 1 ; //<S2SV> } //<S2SV> break ; //<S2SV> } //<S2SV> } //<S2SV> jas_tvparser_destroy ( tvp ) ; //<S2SV> if ( ! cmpt -> sampperx || ! cmpt -> samppery ) { //<S2SV> goto error ; //<S2SV> } //<S2SV> if ( mif_hdr_addcmpt ( hdr , hdr -> numcmpts , cmpt ) ) { //<S2SV> goto error ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> error : //<S2SV> if ( cmpt ) { //<S2SV> mif_cmpt_destroy ( cmpt ) ; //<S2SV> } //<S2SV> if ( tvp ) { //<S2SV> jas_tvparser_destroy ( tvp ) ; //<S2SV> } //<S2SV> return - 1 ; //<S2SV> } //<S2SV> 