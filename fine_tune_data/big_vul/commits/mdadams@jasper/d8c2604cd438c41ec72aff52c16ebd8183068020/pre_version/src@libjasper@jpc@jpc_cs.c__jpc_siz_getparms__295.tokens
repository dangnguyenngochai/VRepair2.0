static int jpc_siz_getparms ( jpc_ms_t * ms , jpc_cstate_t * cstate , //<S2SV> jas_stream_t * in ) //<S2SV> { //<S2SV> jpc_siz_t * siz = & ms -> parms . siz ; //<S2SV> unsigned int i ; //<S2SV> uint_fast8_t tmp ; //<S2SV> cstate = 0 ; //<S2SV> if ( jpc_getuint16 ( in , & siz -> caps ) || //<S2SV> jpc_getuint32 ( in , & siz -> width ) || //<S2SV> jpc_getuint32 ( in , & siz -> height ) || //<S2SV> jpc_getuint32 ( in , & siz -> xoff ) || //<S2SV> jpc_getuint32 ( in , & siz -> yoff ) || //<S2SV> jpc_getuint32 ( in , & siz -> tilewidth ) || //<S2SV> jpc_getuint32 ( in , & siz -> tileheight ) || //<S2SV> jpc_getuint32 ( in , & siz -> tilexoff ) || //<S2SV> jpc_getuint32 ( in , & siz -> tileyoff ) || //<S2SV> jpc_getuint16 ( in , & siz -> numcomps ) ) { //<S2SV> return - 1 ; //<S2SV> } //<S2SV> if ( ! siz -> width || ! siz -> height || ! siz -> tilewidth || //<S2SV> ! siz -> tileheight || ! siz -> numcomps ) { //<S2SV> return - 1 ; //<S2SV> } //<S2SV> if ( ! ( siz -> comps = jas_alloc2 ( siz -> numcomps , sizeof ( jpc_sizcomp_t ) ) ) ) { //<S2SV> return - 1 ; //<S2SV> } //<S2SV> for ( i = 0 ; i < siz -> numcomps ; ++ i ) { //<S2SV> if ( jpc_getuint8 ( in , & tmp ) || //<S2SV> jpc_getuint8 ( in , & siz -> comps [ i ] . hsamp ) || //<S2SV> jpc_getuint8 ( in , & siz -> comps [ i ] . vsamp ) ) { //<S2SV> jas_free ( siz -> comps ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> siz -> comps [ i ] . sgnd = ( tmp >> 7 ) & 1 ; //<S2SV> siz -> comps [ i ] . prec = ( tmp & 0x7f ) + 1 ; //<S2SV> } //<S2SV> if ( jas_stream_eof ( in ) ) { //<S2SV> jas_free ( siz -> comps ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> return 0 ; //<S2SV> } //<S2SV> 