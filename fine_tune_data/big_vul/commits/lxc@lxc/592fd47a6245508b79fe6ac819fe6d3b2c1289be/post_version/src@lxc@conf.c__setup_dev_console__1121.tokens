static int setup_dev_console ( const struct lxc_rootfs * rootfs , //<S2SV> const struct lxc_console * console ) //<S2SV> { //<S2SV> char path [ MAXPATHLEN ] ; //<S2SV> struct stat s ; //<S2SV> int ret ; //<S2SV> ret = snprintf ( path , sizeof ( path ) , "%s/dev/console" , rootfs -> mount ) ; //<S2SV> if ( ret >= sizeof ( path ) ) { //<S2SV> ERROR ( "console<S2SV_blank>path<S2SV_blank>too<S2SV_blank>long" ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> if ( access ( path , F_OK ) ) { //<S2SV> WARN ( "rootfs<S2SV_blank>specified<S2SV_blank>but<S2SV_blank>no<S2SV_blank>console<S2SV_blank>found<S2SV_blank>at<S2SV_blank>\'%s\'" , path ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> if ( console -> master < 0 ) { //<S2SV> INFO ( "no<S2SV_blank>console" ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> if ( stat ( path , & s ) ) { //<S2SV> SYSERROR ( "failed<S2SV_blank>to<S2SV_blank>stat<S2SV_blank>\'%s\'" , path ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> if ( chmod ( console -> name , s . st_mode ) ) { //<S2SV> SYSERROR ( "failed<S2SV_blank>to<S2SV_blank>set<S2SV_blank>mode<S2SV_blank>\'0%o\'<S2SV_blank>to<S2SV_blank>\'%s\'" , //<S2SV> s . st_mode , console -> name ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> if ( safe_mount ( console -> name , path , "none" , MS_BIND , 0 , rootfs -> mount ) ) { //<S2SV> ERROR ( "failed<S2SV_blank>to<S2SV_blank>mount<S2SV_blank>\'%s\'<S2SV_blank>on<S2SV_blank>\'%s\'" , console -> name , path ) ; //<S2SV> return - 1 ; //<S2SV> } //<S2SV> INFO ( "console<S2SV_blank>has<S2SV_blank>been<S2SV_blank>setup" ) ; //<S2SV> return 0 ; //<S2SV> } //<S2SV> 